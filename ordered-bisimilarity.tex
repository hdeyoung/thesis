\chapter{Bisimilarity for ordered rewriting}\label{ch:ordered-bisimilarity}

With the shift from the global, state-transformation view of ordered rewriting put forth in \cref{ch:ordered-rewriting} to the local, formula-as-process view developed in the preceding \lcnamecref{ch:formula-as-process}, we are now in a position to examine how individual propositions and contexts behave and interact.%
\fixnote{Because each proposition has its own \emph{local} thread of control, we can describe a proposition's behavior only to the extent that that behavior can be witnessed by an external observer.}

According to the formula-as-process view, each proposition has its own \emph{local} thread of control.
This locality means that a proposition's\fixnote{or context's?} behavior can be described only to the extent that that behavior can be witnessed by an external observer.
Locality, together with the local interaction semantics of \cref{??}, also suggests\fixnote{dictates?} what may be observed:
A proposition's structure is opaque; only outward-directed atoms, which are viewed as output messages, are observable.
Thus

% (Implicit in the local interaction semantics of \cref{??} is the idea that atoms ought to be observable but that non-atomic propositions are opaque.
% A proposition's neighbors can discover its behavior only by sending it messages and observing the atoms that it sends as replies.)

Intuitively, for example, the contexts $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ and $\atmR{b}$ should have the same observable behavior: an internal reduction transforms $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ into $\atmR{b}$, and no other interactions -- reductions, input transitions, nor output transitions -- are possible from $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$.
In particular, the atom $\atmR{a}$ at the left edge of the context $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ cannot be observed because it is directed inward and therefore acting as an input to, not an output from, $\atmR{a} \limp \atmR{b}$.

As another example, $\atmR{a} \limp (\atmR{c} \pmir \atmL{b})$ and $(\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$ ought to be behaviorally equivalent, intuitively because they are logically equivalent\footnote{That is, $\oseq{\atmR{a} \limp (\atmR{c} \pmir \atmL{b}) \dashv|- (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}}$.}.

\newthought{Following the vast} literature on various forms of bisimilarity\footnote{See \textcite{??} for a survey.}, we will develop a notion of \emph{ordered rewriting bisimilarity} on ordered contexts, $\octx \osim \lctx$.
In \cref{sec:??}, we define rewriting bisimilarity and present a few examples of contexts that are \emph{not} bisimilar under this definition.

However, it will prove to be cumbersome to use rewriting bisimilarity's definition alone to establish that two contexts are bisimilar, a problem that is familiar from process calculi bisimilarities.
Therefore, in \cref{sec:ordered-bisimilarity:labeled-bisim}, we present \emph{labeled bisimilarity}, a sound proof technique for rewriting bisimilarity -- ordered contexts that are labeled bisimilar will also be rewriting bisimilar.
Unlike the $\pi$-calculus's labeled bisimilarity, our labeled bisimilarity is surprisingly complete for rewriting bisimilarity -- contexts that are rewriting bisimilar will also be labeled bisimilar.

This \lcnamecref{ch:ordered-bisimilarity} concludes with several applications of ordered rewriting bisimilarity to our now-familiar running examples, binary counters and \aclp*{NFA}.
\Cref{sec:ordered-bisimilarity:nfa} proves that \ac{NFA}-bisimilar states have rewriting-bisimilar encodings under the functional choreography described in \cref{sec:formula-as-process:nfa-functional}, which allows us to finally rephrase the choreography's adequacy in a clean and stratified form.
And \cref{sec:ordered-bisimilarity:counter} proves that binary counters are rewriting-bisimilar if, and only if, they have the same denotation.

Our rewriting bisimilarity is strongly inspired by the contextual bisimilarity for linear contexts put forth by \textcite{Deng+:MSCS16}.


\section{Toss?}

The previous \lcnamecref{ch:formula-as-process} introduced a formula-as-process view of the focused ordered rewriting framework, and showed how to use it to provide local, message-passing choreographies of the global, string rewriting specifications seen in \cref{ch:string-rewriting}.
The formula-as-process ordered rewriting framework brings (focused) ordered rewriting more in line with process calculi, such as the $\pi$-calculus.

Much more than functional programming, process calculi emphasize observational equivalence.
Owing to their distributed nature, processes are opaque -- only messages are observable.
A client can't peer inside a process to see its internal structure;
a client can only send the process messages and observe any messages that the process sends as a reply.

So far, the formula-as-process ordered rewriting framework does not enjoy a notion of observational equivalence.
In this \lcnamecref{ch:ordered-bisimilarity}, we resolve that deficiency.
In keeping with the large body of work on bisimilarity for message-passing processes\autocite{??}, we develop a notion of bisimilarity for ordered contexts.
Two contexts are judged to be bisimilar if there is no experiment that will eventually distinguish them.

In process calculi, processes are usually treated as opaque, being defined by their behavior rather than their internal structure.
(This emphasis differs from that of functional programming.)
A client can only observe

But process calculi are usually equipped with a notion of observational equivalence, which formula-as-process ordered rewriting does not yet enjoy.
In this \lcnamecref{ch:ordered-bisimilarity}, we develop an observational equivalence for ordered rewriting.
% This \lcnamecref{ch:ordered-bisimilarity} explores the question of when two propositions have equivalent behavior under this process-as-formula view.
In keeping with the large body of work on bisimilarity for message-passing processes\autocite{??}, we develop a notion of bisimilarity for ordered propositions.
This \vocab{ordered rewriting bisimilarity} treats the atomic propositions as the sole observables, in keeping with their interpretation as messages.

Messages are observable, but processes are opaque.



\section{Ordered rewriting bisimilarity}

% An ordered context $\octx$ may be composed when surrounded by ordered contexts $\octx_L$ and $\octx_R$.

% Thus, in $\octx_L \oc \octx \oc \octx_R$, we view $\octx$ as existing within the environment formed by its surrounding contexts, $\octx_L$ and $\octx_R$.
% The context $\octx$ then interacts with that environment along two interfaces: the left end of $\octx$ may interact with the right end of $\octx_L$, and, symmetrically, the right end of $\octx$ may interact with the left end of $\octx_R$.

An atom's location and direction are crucial to its observability.
For an atom to be observable, it must be possible for an external observer to receive that atom as a message.
In $\atmL{a} \oc \octx$ and $\octx \oc \atmR{b}$, the atoms $\atmL{a}$ and $\atmR{b}$, respectively, are observable, because $\octx_O \oc (\p{A} \pmir \atmL{a}) \oc \atmL{a} \oc \octx \reduces \octx_O \oc \p{A} \oc \octx$

But those same atoms are not observable in $\octx \oc \atmL{a}$ and $\atmR{b} \oc \octx$.

\begin{theorem}
  If $\octx = \atmL{a} \oc \octx_0 \reduces \octx'$, then $\octx' = \atmL{a} \oc \octx'_0$ for some $\octx'_0$ such that $\octx_0 \reduces \octx'_0$.
  Symmetrically, if $\octx = \octx_0 \oc \atmR{a} \reduces \octx'$, then $\octx' = \octx'_0 \oc \atmR{a}$ for some $\octx'_0$ such that $\octx_0 \reduces \octx'_0$.
\end{theorem}
\begin{proof}
  By inversion on the given reduction, making use of the fact that $\atmL{a} \limp \n{B}$ and $\n{B} \pmir \atmR{a}$ are not well-formed propositions.
\end{proof}

\newthought{Ordered rewriting} is asynchronous.
As a simple example, it takes two steps to achieve $\octx_L \oc (\up \p{A} \pmir \atmL{a}) \oc (\atmL{a} \fuse \p{B}) \oc \octx_R \Reduces \octx_L \oc \p{A} \oc \p{B} \oc \octx_R$:
first, $\atmL{a} \fuse \p{B}$ is decomposed into $\atmL{a}$ and $\p{B}$, and then that $\atmL{a}$ is used to decompose $\up \p{A} \pmir \atmL{a}$ into $\p{A}$.
The entire rewriting cannot occur in a single, synchronous step:
\begin{equation*}
  \octx_L \oc (\up \p{A} \pmir \atmL{a}) \oc (\atmL{a} \fuse \p{B}) \oc \octx_R
    \nreduces \octx_L \oc \p{A} \oc \p{B} \oc \octx_R
  \,.
\end{equation*}

Because ordered rewriting is asynchronous in this way, we should expect our notion of rewriting bisimilarity to have some analogy to the kinds of bisimilarities developed for asynchronous process calculi, such as the asynchronous $\pi$-calculus\autocite{Amadio+:TCS98} and asynchronous \acs*{CCS}\autocite{Boreale+:IC02}.

% \subsection{}

% Because outgoing atoms are observable at a context's edges, there is a built-in notion of (immediate) output transition: a context $\octx$ outputs $\atmL{a}$ to its left exactly when $\octx = \atmL{a} \oc \octx'$, for some $\octx'$.
% Symmetrically, a context $\octx$ outputs $\atmR{b}$ to its right exactly when $\octx = \octx' \oc \atmR{b}$.
% We could adopt a process-calculus--like labeled transition notation for these output transitions -- such as $\octx = \atmL{a} \oc \octx' \reduces[\atmL{a}] \octx'$ and $\octx = \octx' \oc \atmR{a} \reduces[\atmR{a}] \octx'$ -- but that 

% A weak output transition would then be
% So, in this setting, $\octx$ would have a weak output transition to $\octx'$ if there exists a context $\octx_0$ such that $\octx \Reduces \atmL{a} \oc \octx_0$ and $\octx_0 \Reduces \octx'$ -- or, more simply, if $\octx \Reduces \atmL{a} \oc \octx'$.



% \section{}

% This \lcnamecref{ch:ordered-bisimilarity} marks a change in our perspective on ordered rewriting.
% In the previous \lcnamecref{ch:ordered-rewriting}, we viewed ordered rewriting as an abstract framework for global specifications of concurrent systems, in the vein of previous work on [...].
% The emphasis was placed squarely on state transformation [...].

% Although useful for reasoning about abstract properties of concurrent systems, these global specifications do not immediately suggest [...].
% Therefore, in this [...], we instead refine ordered rewriting into a framework for message-passing concurrency among processes with independent threads of control.

% This message-passing view is obtained through a \vocab{process-as-formula}\autocite{??} reading of ordered propositions and contexts.
% The logical connectives are reinterpreted as process constructors, so that propositions are seen as processes; positive atomic propositions, as messages; and contexts, as process configurations.

% In this \lcnamecref{ch:ordered-bisimilarity}, we would instead like to decrease the level of abstraction and view ordered rewriting as a framework for message-passing concurrency.

%  -- specifically, message-passing among processes arranged in a chain\fixnote{linear?} topology.
% With their independent threads of control, processes bring a more local character to ordered rewriting, bringing it closer to a process calculus such as the $\pi$-calculus.

% This message-passing view is obtained through a \vocab{process-as-formula}\autocite{??} view of ordered propositions and contexts.
% The logical connectives are reinterpreted as process constructors, so that propositions are seen as processes; positive atomic propositions, as messages; and contexts, as process configurations.



% This \lcnamecref{ch:ordered-bisimilarity} marks a change in our perspective on ordered rewriting.
% In the previous \lcnamecref{ch:ordered-rewriting}, we viewed ordered rewriting as an abstract framework for concurrent state transformation, in the vein of previous work on multiset rewriting\autocite{??} [or even Petri nets\autocite{??}].
% With the emphasis on transformation of the entire state, our view of concurrent computation was inherently global.

% In this \lcnamecref{ch:ordered-bisimilarity}, we would instead like to view ordered rewriting as a framework for message-passing concurrency -- specifically, message-passing among processes arranged in a chain\fixnote{linear?} topology.
% With their independent threads of control, processes bring a more local character to ordered rewriting, bringing it closer to a process calculus such as the $\pi$-calculus.

% This message-passing view is obtained through a \vocab{process-as-formula}\autocite{??} view of ordered propositions and contexts.
% The logical connectives are reinterpreted as process constructors, so that propositions are seen as processes; positive atomic propositions, as messages; and contexts, as process configurations.


% % negative propositions can be seen as processes, positive atoms can be seen as messages, and ordered contexts can be seen as process configurations.

% % Accordingly, we take a \vocab{process-as-formula}\autocite{??} view, in which [...].
% % Specifically, uninterpreted positive atoms will act like messages and negative propositions will act like processes.
% % Owing to the conceptual introduction of processes with independent threads of control, this view of concurrency is more local in character and brings ordered rewriting closer to a process calculus, such as the $\pi$-calculus.

% Interestingly, this change in perspective necessitates very few formal changes to the ordered rewriting framework.
% The primary change is that left- and right-handed implications are restricted to positive atoms, corresponding to the common first-order restriction that input processes receive only messages.

% Despite the few formal changes, the new local [, message-passing] perspective does raise a new, important question: when do two processes have equivalent behavior?
% In keeping with the large body of work on bisimilarity\autocite{??}, we develop a notion of bisimilarity between ordered contexts.
% Several examples [...]

% Despite requiring only very few formal changes, the shift from global to local perspective does raise an important question: when do two processes have equivalent behavior?
% We answer this question by developing a notion of bisimilarity for ordered contexts.
% In keeping with the large body of work on bisimilarity\autocite{??}, we develop a notion of bisimilarity between ordered contexts.

% \begin{itemize}
% \item Assign direction to uninterpreted atoms so they act like messagesl
% \item Defined atoms are like processes
% \item Left and right implications are restricted to messages (compare with higher-order $\pi$ calculus)
% \end{itemize}


% \section{}

% \begin{equation*}
%   a \oc \dfa{q} \reduces \dfa{q}'_a
% \end{equation*}
% where $q \dfareduces[a] q'_a$, for each pair $(q, a) \in Q \times \ialph$; and 
% \begin{equation*}
%   \emp \oc \dfa{q} \reduces
%     \begin{cases*}
%       \one & if $q \in F$ \\
%       \top & if $q \notin F$
%     \end{cases*}
% \end{equation*}
% for each $q \in Q$.

% As a specification of \acp{DFA}, this works well.
% But as an implementation, it is significantly lacking.
% The rewriting axioms $a \oc \dfa{q} \reduces \dfa{q}'_a$ presume that a conductor orchestrates the interactions between input symbols and \ac{DFA} states, but a local\fixnote{distributed?} implementation 

% This specification could be choreographed in (at least) two ways.
% One choreography treats the input symbols $a$ as messages that are received by the states $\dfa{q}$, acting as processes.
% \begin{equation*}
%   \dfa{q} \defd (\emp \limp \dfa{F}(q)) \with \bigwith_{a \in \ialph}(\atmR{a} \limp \dfa{q}'_a)
% \end{equation*}
% Because the input word is delivered like data to the state, this choreography has a functional flavor.

% Another choreography of the same specification is dual, treating the input symbols as processes
% \begin{equation*}
%   a \defd \bigwith_{q \in Q}(\atmL{q}'_a \pmir \atmL{q})
%   \quad\text{and}\quad
%   \emp \defd \bigwith_{q \in Q}(\dfa{F}(q) \pmir \atmL{q})
% \end{equation*}

% \section{}

% To interpret polarized ordered propositions as processes, we adapt the \vocab{process-as-formula} view of logical connectives initiated by \textcite{??}.
% The logical connectives are read as process constructors, so that positive atomic propositions may be seen as messages; negative propositions, [may be seen] as processes; ordered contexts, [may be seen] as process configurations with a chain topology; and positive propositions, [may be seen] as processes that reify those configurations.

% To keep the interpretation as simple as possible, we introduce three syntactic restrictions on the ordered propositions.
% Each of these restrictions may be relaxed at the expense of some additional complexity, as we will discuss in \cref{??}.

% First, each positive atom is consistently assigned a direction, either left-directed, $\atmL{a}$, or right-directed, $\atmR{a}$.
% When positive atoms are viewed as messages, these directions indicate the message's sender and intended recipient.
% For example, in the context $\dn \n{C} \oc \atmL{a} \oc \p{B}$, the right-to-left direction of $\atmL{a}$ incicates that $\p{B}$ was the sender and $\dn \n{C}$ is the intended recipient.



% Second, recursively defined \emph{positive} propositions are disallowed.\fixnote{is this necessary?}

% Third, the left- and right-handed implications are restricted to accept only atoms with an incoming direction: $\atmR{a} \limp \n{B}$ and $\n{B} \pmir \atmL{a}$.
% [In conjunction with atoms' directions,] this acts as a mild form of typing -- an input process may receive only intended messages.
% Something like $\atmL{a} \oc (a \limp \up \p{B}) \reduces \p{B}$ should \emph{not} be possible, because its process-as-formula reading


% \begin{syntax*}
%   Ordered contexts &
%     \octx & \octx_1 \oc \octx_2 \mid \octxe \mid \p{A}
% \end{syntax*}
% Concatenation of contexts, $\octx_1 \oc \octx_2$, is viewed as end-to-end composition of process configurations;
% the empty context, $\octxe$, is the empty process configuration;
% and [...].

% To keep the interpretation as simple as possible, we introduce three syntactic restrictions on propositions.
% Each of these restrictions may be relaxed at the expense of some additional complexity, as we will discuss in \cref{??}.

% First, each positive atom is consistently assigned a direction, either left-directed, $\atmL{a}$, or right-directed, $\atmR{a}$.
% Because 
% Second, recursively defined \emph{positive} propositions are disallowed.
% Thus, the positive propositions are generated by the following grammar.
% \begin{syntax*}
%   Positive props. &
%     \p{A} & \atmL{a} \mid \atmR{a} \mid \p{A} \fuse \p{B} \mid \one \mid \dn \n{A}
% \end{syntax*}
% Atoms $\atmL{a}$ and $\atmR{a}$ are viewed as left- and right-directed messages; ordered conjunction, $\p{A} \fuse \p{B}$, denotes end-to-end composition of processes $\p{A}$ and $\p{B}$; $\one$ denotes the terminating 

% \begin{tabular}{@{}rl@{}}
%   $\octx_1 \oc \octx_2$ & end-to-end composition of configurations \\
%   $\octxe$ & empty configuration \\
%   $\p{A}$ & 
% \end{tabular}

% \begin{tabular}{@{}rl@{}}
%   $\atmR{a}$ & right-directed message \\
%   $\atmL{a}$ & left-directed message \\
%   $\p{A} \fuse \p{B}$ & process composition \\
%   $\one$ & terminating process \\
%   $\dn \n{A}$ & 
% \end{tabular}

% \begin{tabular}{@{}rl@{}}
%   $\n{\alpha} \defd \n{A}$ & recursively defined process \\
%   $\atmR{a} \limp \n{B}$ & receive $\atmR{a}$ from the left, then continue as $\n{B}$ \\
%   $\n{B} \pmir \atmL{a}$ & receive $\atmL{a}$ from the right, then continue as $\n{B}$ \\
%   $\n{A} \with \n{B}$ & nondeterministically choose to continue as $\n{A}$ or $\n{B}$ \\
%   $\top$ & \\
%   $\up \p{A}$ &
% \end{tabular}

% \begin{tabular}{@{}rl@{}}
%   $\octx_1 \oc \octx_2$ & composition of configurations $\octx_1$ and $\octx_2$ \\
%   $\octxe$ & empty configuration \\
%   $\p{A}$ & single process configuration
% \end{tabular}

% \begin{syntax*}
%   Positive props. &
%     \p{A} & \atmR{a} \mid \atmL{a} \mid \p{A} \fuse \p{B} \mid \one \mid \dn \n{A}
% \end{syntax*}

% Atoms' directions act as a very mild form of typing.
% The left- and right-handed implications are restricted to accept only atoms with an incoming direction: $\atmR{a} \limp \n{B}$ and $\n{B} \pmir \atmL{a}$.
% The full syntax of negative propositions is thus:
% \begin{syntax*}
%   Negative props. &
%     \n{A} & \n{\alpha} \mid \atmR{a} \limp \n{B} \mid \n{B} \pmir \atmL{a} \mid \n{A} \with \n{B} \mid \top \mid \up \p{A}
%   \,,
% \end{syntax*}
% with equirecursively defined negative propositions $\n{\alpha} \defd \n{A}$.


%  acting like recursively defined processes.

% In addition to fully general ordered contexts of positive propositions, it will also be useful to characterize two refinements: contexts that contain only atoms of one direction or the other.
% We use an arrow decoration to indicate the direction.
% \begin{syntax*}
%   Ordered contexts &
%     \octx & \octx_1 \oc \octx_2 \mid \octxe \mid \p{A}
%   \\[-2\jot]
%   Right-directed &
%     \atmR{\octx} & \atmR{\octx}_1 \oc \atmR{\octx}_2 \mid \octxe \mid \atmR{a}
%   \\[-2\jot]
%   Left-directed &
%     \atmL{\octx} & \atmL{\octx}_1 \oc \atmL{\octx}_2 \mid \octxe \mid \atmL{a}
% \end{syntax*}

% Having restricted the premises of left- and right-handed implications to incoming atoms, $\atmR{a}$ and $\atmL{a}$, respectively, the left focus judgment and its rules may be refined.
% The judgment is now $\lfocus{\atmR{\octx}_L}{\n{A}}{\atmL{\octx}_R}{\p{C}}$, because [...inputs can only be incoming messages...].
% Other than this refinement, the inference rules remain essentially the same as in \cref{??}.
% The revised 


% \begin{figure}
%   \begin{syntax*}
%     Positive props. &
%       \p{A} & \atmR{a} \mid \atmL{a} \mid \p{A} \fuse \p{B} \mid \one \mid \dn \n{A}
%     \\
%     Negative props. &
%       \n{A} & \n{\alpha} \mid
%                 \atmR{a} \limp \n{B} \mid \n{B} \pmir \atmL{a} \mid
%                 \n{A} \with \n{B} \mid \top \mid \up \p{A}
%     \\
%     Ordered contexts &
%         \octx & \octx_1 \oc \octx_2 \mid \octxe \mid \p{A} \\[-2\jot]
%       & \atmR{\octx} & \atmR{\octx}_1 \oc \atmR{\octx}_2 \mid \octxe \mid \atmR{a} \\[-2\jot]
%       & \atmL{\octx} & \atmL{\octx}_1 \oc \atmL{\octx}_2 \mid \octxe \mid \atmL{a}
%   \end{syntax*}
%   \begin{inferences}[Rewriting: $\octx \reduces \octx'$ and $\octx \Reduces \octx'$]
%     \infer[\jrule{$\dn$D}]{\atmR{\octx}_L \oc \dn \n{A} \oc \atmL{\octx}_R \reduces \p{C}}{
%       \lfocus{\atmR{\octx}_L}{\n{A}}{\atmL{\octx}_R}{\p{C}}}
%     \and
%     \infer[\jrule{$\fuse$D}]{\p{A} \fuse \p{B} \reduces \p{A} \oc \p{B}}{}
%     \and
%     \infer[\jrule{$\one$D}]{\one \reduces \octxe}{}
%     \\
%     \text{(no $\jrule{$\plus$D}$ and $\jrule{$\zero$D}$ rules)}
%     \\
%     \infer[\jrule{$\reduces$C}_{\jrule{L}}]{\octx_1 \oc \octx_2 \reduces \octx'_1 \oc \octx_2}{
%       \octx_1 \reduces \octx'_1}
%     \and
%     \infer[\jrule{$\reduces$C}_{\jrule{R}}]{\octx_1 \oc \octx_2 \reduces \octx'_1 \oc \octx_2}{
%       \octx_1 \reduces \octx'_1}
%   \end{inferences}
%   \begin{inferences}
%     \infer[\jrule{$\Reduces$R}]{\octx \Reduces \octx}{}
%     \and
%     \infer[\jrule{$\Reduces$T}]{\octx \Reduces \octx''}{
%       \octx \reduces \octx' & \octx' \Reduces \octx''}
%   \end{inferences}

%   \begin{inferences}[Left focus: $\lfocus{\atmR{\octx}_L}{\n{A}}{\atmL{\octx}_R}{\p{C}}$]
%     \infer[\lrule{\limp}']{\lfocus{\atmR{\octx}_L}{\atmR{a} \limp \n{B}}{\atmL{\octx}_R}{\p{C}}}{
%       \lfocus{\atmR{\octx}_L \oc \atmR{a}}{\n{B}}{\atmL{\octx}_R}{\p{C}}}
%     \and
%     \infer[\lrule{\pmir}']{\lfocus{\atmR{\octx}_L}{\n{B} \pmir \atmL{a}}{\atmL{\octx}_R}{\p{C}}}{
%       \lfocus{\atmR{\octx}_L}{\n{B}}{\atmL{a} \oc \atmL{\octx}_R}{\p{C}}}
%     \\
%     \infer[\lrule{\with}_1]{\lfocus{\atmR{\octx}_L}{\n{A} \with \n{B}}{\atmL{\octx}_R}{\p{C}}}{
%       \lfocus{\atmR{\octx}_L}{\n{A}}{\atmL{\octx}_R}{\p{C}}}
%     \and
%     \infer[\lrule{\with}_2]{\lfocus{\atmR{\octx}_L}{\n{A} \with \n{B}}{\atmL{\octx}_R}{\p{C}}}{
%       \lfocus{\atmR{\octx}_L}{\n{B}}{\atmL{\octx}_R}{\p{C}}}
%     \and
%     \text{(no $\lrule{\top}$ rule)}
%     \\
%     \infer[\lrule{\up}]{\lfocus{}{\up \p{A}}{}{\p{A}}}{}
%   \end{inferences}
%   \caption{A weakly focused ordered rewriting framework}
% \end{figure}

% \begin{figure}
%  \begin{inferences}[Input transition: $\ireduces{\atmR{\octx}_L \oc ##1 \oc \atmL{\octx}_R}{\octx}{\octx'}$]
%     \infer{\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\dn \n{A}}{\p{C}}}{
%       \lfocus{\atmR{\octx}_L}{\n{A}}{\atmL{\octx}_R}{\p{C}}}
%     \and
%     \infer{\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\atmR{a} \oc \octx}{\octx'}}{
%       \ireduces{\atmR{\octx}_L \oc \atmR{a} \oc #1 \oc \atmL{\octx}_R}{\octx}{\octx'}}
%     \and
%     \infer{\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\octx \oc \atmL{a}}{\octx'}}{
%       \ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{a} \oc \atmL{\octx}_R}{\octx}{\octx'}}
%     \\
%     \infer{\ireduces{#1 \oc \atmL{\octx}_R}{\p{A} \oc \octx}{\p{A} \oc \octx'}}{
%       \ireduces{#1 \oc \atmL{\octx}_R}{\octx}{\octx'}}
%     \and
%     \infer{\ireduces{\atmR{\octx}_L \oc #1}{\octx \oc \p{A}}{\octx' \oc \p{A}}}{
%       \ireduces{\atmR{\octx}_L \oc #1}{\octx}{\octx'}}
%   \end{inferences}
%   \caption{A weakly focused ordered rewriting framework}
% \end{figure}


% \section{Input transitions}

% With the above restriction of left- and right-handed implications to atomic premises of hte 

% \begin{inferences}
%   \infer{\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\dn \n{A}}{\p{C}}}{
%     \lfocus{\atmR{\octx}_L}{\n{A}}{\atmL{\octx}_R}{\p{C}}}
%   \\
%   \infer{\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\atmR{a} \oc \octx}{\octx'}}{
%     \ireduces{\atmR{\octx}_L \oc \atmR{a} \oc #1 \oc \atmL{\octx}_R}{\octx}{\octx'}}
%   \and
%   \infer{\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\octx \oc \atmL{a}}{\octx'}}{
%     \ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{a} \oc \atmL{\octx}_R}{\octx}{\octx'}}
%   \\
%   \infer{\ireduces{#1 \oc \atmL{\octx}_R}{\p{A} \oc \octx}{\p{A} \oc \octx'}}{
%     \ireduces{#1 \oc \atmL{\octx}_R}{\octx}{\octx'}}
%   \and
%   \infer{\ireduces{\atmR{\octx}_L \oc #1}{\octx \oc \p{A}}{\octx' \oc \p{A}}}{
%     \ireduces{\atmR{\octx}_L \oc #1}{\octx}{\octx'}}
% \end{inferences}

% In its most basic form, an input transition derives from the inputs required by [...].

% The following \lcnamecref{thm:input-transition-reduction} relates input transitions to reductions.
% \begin{theorem}\label{thm:input-transition-reduction}
%   If $\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\octx}{\octx'}$, then $\atmR{\octx}_L \oc \octx \oc \atmL{\octx}_R \reduces \octx'$.
%   Conversely, if $\octx \reduces \octx'$, then there exist $\octx_L$ and $\octx_R$ such that either:
%   \begin{itemize}
%   \item $\octx = \octx_L \oc \atmR{\lctx}_L \oc \octx_0 \oc \atmL{\lctx}_R \oc \octx_R$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\octx_0}{\octx'_0}$ and $\octx' = \octx_L \oc \octx'_0 \oc \octx_R$, for some $\atmR{\lctx}_L$, $\octx_0$, $\atmL{\lctx}_R$, and $\octx'_0$;
%   \item $\octx = \octx_L \oc (\p{A} \fuse \p{B}) \oc \octx_R$ and $\octx' = \octx_L \oc \p{A} \oc \p{B} \oc \octx_R$, for some $\p{A}$ and $\p{B}$; or
%   \item $\octx = \octx_L \oc \one \oc \octx_R$ and $\octx' = \octx_L \oc \octx_R$.
%   \end{itemize}
% \end{theorem}
% \begin{proof}
%   By structural induction on the given input transition or reduction, respectively.
% \end{proof}

% \begin{lemma}\label{lem:input-framing}
%   If $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\atmR{a} \oc \octx}{\octx'}$, then either:
%   \begin{itemize}[nosep]
%   \item $\atmR{a}$ satisfies an input demand -- \ie, $\ireduces{\atmR{\lctx}_L \oc \atmR{a} \oc #1 \oc \atmL{\lctx}_R}{\octx}{\octx'}$; or
%   \item $\atmR{a}$ does not participate in the input transition -- \ie, $\atmR{\lctx}_L = \octxe$ and $\octx' = \atmR{a} \oc \octx'_a$ for some $\octx'_a$ such that $\ireduces{#1 \oc \atmL{\lctx}_R}{\octx}{\octx'_a}$.
%   \end{itemize}
%   Symmetrically, if $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\octx \oc \atmL{a}}{\octx'}$, then either:
%   \begin{itemize}[nosep]
%   \item $\atmL{a}$ satisfies an input demand -- \ie, $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{a} \oc \atmL{\lctx}_R}{\octx}{\octx'}$; or
%   \item $\atmL{a}$ does not participate in the input transition -- \ie, $\atmL{\lctx}_R = \octxe$ and $\octx' = \octx'_a \oc \atmL{a}$ for some $\octx'_a$ such that $\ireduces{\atmR{\lctx}_L \oc #1}{\octx}{\octx'_a}$.
%   \end{itemize}
% \end{lemma}
% \begin{proof}
%   By structural induction on the given input transition.
% \end{proof}

\section{Rewriting bisimilarity}\label{sec:ordered-bisimilarity:rewriting-bisimilarity}

With the shift from a global, state transformation view of ordered rewriting to a local, \enquote{formula-as-process} view, it is now possible to consider how the individual \enquote{formula-as-process} -- or, more generally, \enquote{context-as-configuration} -- components behave and how they interact with each other.
Because each component has its own, local thread of control, we can describe its behavior only to the extent that its behavior is observable.
To the extent that its behavior can be witnessed by an external observer

Now that we can decompose concurrent systems into individual \enquote{formula-as-process} -- or \enquote{context-as-configuration} -- components, 

Intuitively, for example, the contexts\fixnote{configurations?} $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ and $\atmR{b}$ should be behaviorally equivalent: an internal reduction transforms $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ into $\atmR{b}$, and no other interactions -- reductions or input or output transitions -- are possible from $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$.
As another example, $\atmR{a} \limp (\atmR{c} \pmir \atmL{b})$ and $(\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$ should also be behaviorally equivalent, intuitively because they are logically equivalent.

Following the vast literature on various forms of bisimilarity\footnote{See \textcite{??} for a survey.}, we will develop a notion of \vocab{rewriting bisimilarity} on ordered contexts.
First, we need a few auxiliary definitions.

related to Deng et al.



In this \lcnamecref{sec:ordered-bisimilarity:rewriting-bisimilarity}, we define \emph{ordered rewriting bisimilarity}, a notion of observational equivalence for ordered contexts.
Before that, however, we must define a few auxiliary relations on contexts.
%
\begin{definition}[Framed binary relations]\label{def:ordered-bisimilarity:framed-relation}
  Let $\simu{R}$ be a binary relation on ordered contexts.
  Given ordered contexts $\lctx_L$ and $\lctx_R$, let $\lrframe{\lctx_L}{\simu{R}}{\lctx_R}$ be the least binary relation such that:
  \begin{inferences}
    \infer{\octx \lrframe{\lctx_L}{\simu{R}}{\lctx_R} \octx'}{
      \text{($\octx = \lctx_L \oc \octx_0 \oc \lctx_R$)} & 
      \octx_0 \simu{R} \octx'_0 &
      \text{($\lctx_L \oc \octx'_0 \oc \lctx_R = \octx'$)}}
  \end{inferences}
  In other words, $\lrframe{\lctx_L}{\simu{R}}{\lctx_R}$ relates contexts consisting of $\simu{R}$-related middles that are each surrounded by $\lctx_L$ and $\lctx_R$.

  Furthermore, let $\ctxc{\simu{R}}$ be the input contextual closure of $\simu{R}$ -- that is, $\ctxc{\simu{R}}$ is the least binary relation such that:
  \begin{inferences}
    \infer{\octx \ctxc{\simu{R}} \lctx}{
      \octx \simu{R} \lctx}
    \and
    \infer{\atmR{a} \oc \octx \ctxc{\simu{R}} \atmR{a} \oc \lctx}{
      \octx \ctxc{\simu{R}} \lctx}
    \and
    \infer{\octx \oc \atmL{a} \ctxc{\simu{R}} \lctx \oc \atmL{a}}{
      \octx \ctxc{\simu{R}} \lctx}
  \end{inferences}
  Equivalently, $\octx \ctxc{\simu{R}} \lctx$ if, and only if, there exist input contexts $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$ such that $\octx \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R} \lctx$.
\end{definition}
\noindent
With these auxiliary relations in hand, we can now turn to defining ordered rewriting bisimilarity.

\newthought{Contexts should be} equivalent only if they are not observably distinguishable by a single type of experiment: provide the contexts with some incoming messages (or none at all) and observe any outgoing messages that are eventually produced.%
% We take the position that outgoing messages are observable.
If two contexts may eventually produce different outgoing messages, then observing those messages will allow us to distinguish the two contexts.
% We may also perform simple experiments on contexts: provide the contexts with some incoming messages (or none at all) and observe any outgoing messages that are eventually produced.%
In particular, we do not allow the time or number of computational steps to be observed -- all that matters is whether the same outputs are eventually produced from the same inputs.
The resulting bisimilarity will therefore be a weak bisimilarity.
\footnote{We could equivalently combine these into one monolithic condition: If $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}\Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
  \begin{equation*}
    \begin{tikzcd}[ampersand replacement=\&, sep=large]
      \atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R
        \rar[relation, "\lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}"]
        \dar[Reduces, exists]
      \&
      \atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R
        \dar[Reduces]
      \\
      \atmL{\lctx}'_L \oc \octx' \oc \atmL{\lctx}'_R
        \rar[relation, exists, "\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmL{\lctx}'_R}"]
      \&
      \atmL{\lctx}'_L \oc \lctx' \oc \atmL{\lctx}'_R
    \end{tikzcd}
  \end{equation*}
  However, this formulation is unwieldy, so we prefer the separate output and input bisimulation conditions.}

 they have the same input and output behavior.
Based on this principle, we arrive at the following notion of rewriting bisimilarity.
We will state its definition first and then justify that definition on the basis of observable indistinguishability.
%
\begin{definition}\label{def:ordered-bisimilarity:bisim}
  A \vocab{rewriting bisimulation}, $\simu{R}$, is a symmetric binary relation among contexts that satisfies the following conditions.
  \begin{thmdescription}[nosep]
  \item[Output bisimulation]
    If $\octx \simu{R}\Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
  \item[Input bisimulation]
    If $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}\Reduces \lctx'$, then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R} \lctx'$.
  \end{thmdescription}
  \begin{marginfigure}
    \begin{center}
      \begin{tabular}{@{}c@{}}
        \begin{tikzcd}[sep=large]
          \octx
            \rar[relation, "\simu{R}"]
            \dar[Reduces, exists]
          &
          \lctx
            \dar[Reduces]
          \\
          \atmL{\lctx}'_L \oc \octx' \oc \atmR{\lctx}'_R
            \rar[relation, exists, "\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R}"]
          &
          \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R
        \end{tikzcd}
        \\
        \emph{Output bisimulation}
        \\[2ex]
        \begin{tikzcd}[sep=large]
          \atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R
            \rar[relation, "\lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}"]
            \dar[Reduces, exists]
          &
          \atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R
            \dar[Reduces]
          \\
          \octx\mathrlap{'}
            \rar[relation, exists, "\simu{R}"]
          &
          \lctx\mathrlap{'}
        \end{tikzcd}
        \\
        \emph{Input bisimulation}
      \end{tabular}
    \end{center}
    \caption{Rewriting bisimulation conditions, in diagrams}
  \end{marginfigure}
  Then \vocab{rewriting bisimilarity}, $\osim$, is the largest rewriting bisimulation.
\end{definition}
\noindent
Notice that a third, reduction bisimulation property is a trivial instance of the output and input bisimulation conditions -- namely when the output and input contexts, $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ and $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$, respectively, are empty:
\begin{theorem}\label{thm:bisim-reduction-closure}
  If $\simu{R}$ is a rewriting bisimulation, then $\simu{R}$ satisifies
  \begin{thmdescription}[nosep]
  \item[Reduction bisimulation]
    If $\octx \simu{R}\Reduces \lctx'$, then $\octx \Reduces\simu{R} \lctx'$.
  \end{thmdescription}
\end{theorem}

% Both the output and input bisimulation conditions serve to ensure that related contexts are not observably distinguishable.

The clauses of \cref{def:ordered-bisimilarity:bisim} could do with some explanation.
Let's begin with the output bisimulation condition.

Expanding slightly, we are given that there exists a context $\lctx$ such that $\octx \simu{R} \lctx \Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
Based on the local interaction semantics~\parencref{sec:formula-as-process:transition-semantics}, this means
\begin{enumerate*}[label=\emph{(\roman*)}]
\item that $\lctx$ can eventually output $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ and then continue as $\lctx'$; and
\item that $\octx$ is $\simu{R}$-related to $\lctx$
\end{enumerate*}.
For $\simu{R}$ to be a rewriting bisimulation, the context $\octx$ ought to be able to simulate $\lctx$'s eventual output of $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$, otherwise the $\simu{R}$-related contexts $\octx$ and $\lctx$ could be distinguished based on their (eventual) output behavior.
Moreover, the continuations ought to be $\simu{R}$-related as well.
Formally, we ought to have $\octx \Reduces \atmL{\lctx}'_L \oc \octx' \oc \atmR{\lctx}'_R$ (\ie, $\octx$ eventually outputs $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$) and $\octx' \simu{R} \lctx'$, for some context $\octx'$, which is all neatly packaged up as $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.

Input bisimulation is dual to output bisimulation.
For input bisimulation, we are given that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}\Reduces \lctx'$.
Expanding slightly, there exists a context $\lctx$ such that $\octx \simu{R} \lctx$ and $\atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R \Reduces \lctx'$.
In other words, once provided with the incoming messages $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$, the context $\lctx$ can eventually evolve to $\lctx'$.
Being $\simu{R}$-related to $\lctx$, the context $\octx$, when provided with the same incoming messages, must be able to evolve to a context that is $\simu{R}$-related to $\lctx'$, otherwise $\octx$ and $\lctx$ could be distinguished by how they react to $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$.
That is, we must have $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces \octx' \simu{R} \lctx'$ for some $\octx'$, which is neatly packaged as $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R} \lctx'$.


\newthought{The other way} to understand rewriting bisimilarity is by analogy with the asynchronous \ac{CCS}'s notion of weak bisimilarity.\autocites{Amadio+:TCS98}{Boreale+:IC02}
There, a weak bisimulation can be described as a symmetric relation $\simu{R}$ on processes that satisfies three conditions:%
\footnote{%
  The premises of these conditions are usually stated with strong transitions, but we prefer this phrasing for its similarity to rewriting bisimilarity.}
\begin{itemize}[noitemsep]% [label=\emph{(\roman*)}]
\item If $P \simu{R}\overset{\smash{\bar{c}}}{\Reduces} Q'$, then $P \overset{\smash{\bar{c}}}{\Reduces}\simu{R} Q'$.
\item If $P \simu{R}\overset{\tau}{\Reduces} Q'$, then $P \overset{\tau}{\Reduces}\simu{R} Q'$.
\item If $P \simu{R}\overset{c}{\Reduces} Q'$, then either $P \overset{c}{\Reduces}\simu{R} Q'$ or there exists a process $P'$ such that $P \overset{\tau}{\Reduces} P'$ and $\bar{c} \mid P' \simu{R} Q'$.
\end{itemize}
Weak bisimilarity for the asynchronous \ac{CCS} is then the largest such bisimulation.

The first of these three conditions corresponds to rewriting bisimilarity's output bisimulation condition with nonempty output contexts $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$.
As mentioned in \cref{sec:formula-as-process:transition-semantics}, $\lctx \Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ functions as an implicit weak output transition from $\lctx$ to $\lctx'$, with outputs $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$.
Similarly, $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ is analogous to $P \overset{\smash{\bar{c}}}{\Reduces}\simu{R} Q'$.

The second of the three conditions imposed by asynchronous \ac{CCS} weak bisimilarity corresponds to rewriting bisimilarity's reduction bisimulation property~\parencref{thm:bisim-reduction-closure}, which is really just either output or input bisimulation with empty output contexts $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ or input contexts $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$.

The third of the three conditions imposed by asynchronous \ac{CCS} weak bisimilarity corresponds to rewriting bisimilarity's input bisimulation condition.
% Rewriting bisimilarity's input bisimulation condition corresponds to the third of the asynchronous \ac{CCS} weak bisimilarity's conditions.
The \ac{CCS} condition is equivalent to \enquote{If $P \simu{R}\overset{c}{\reduces} Q'$, then $\bar{c} \mid P \overset{\tau}{\Reduces}\simu{R} Q'$.}
(In fact, it is typical to use this phrasing in the definition of asynchronous \ac{CCS} bisimilarity.)
Because asynchronous \ac{CCS} weak bisimilarity is a congruence, that condition can be rephrased as \enquote{If $P \simu{R} Q$ and $\bar{c} \mid Q \overset{\tau}{\reduces} Q'$, then $\bar{c} \mid P \overset{\tau}{\Reduces}\simu{R} Q'$} without affecting the resulting bisimilarity.%
\footnote{See \cref{app:ccs} for a proof sketch.}
And, in that form, the correspondence with rewriting bisimilarity's input bisimulation condition becomes apparent.




% As described in \cref{sec:??}, our formula-as-process rewriting framework does not use an explicit internal transition judgment, but instead relies on reduction, so that $\reduces$ and $\Reduces$ are analogous to the \ac{CCS} $\overset{\tau}{\reduces}$ and $\overset{\tau}{\Reduces}$ strong and weak internal transition relations, respectively.
% Thus, the above \cref{thm:bisim-reduction-closure} roughly plays the role of the condition imposed on an asynchronous \ac{CCS} bisimulation that $P \simu{R}\overset{\tau}{\reduces} Q'$ implies $P \overset{\tau}{\Reduces}\simu{R} Q'$.

% \Cref{sec:??} also describes how the formula-as-process rewriting framework uses context equality, like $\lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$


% In the asynchronous CCS, a weak bisimulation is a symmetric binary relation on processes that, among other conditions, satisfies:
% \begin{itemize}
% \item If $P \simu{R}\overset{\bar{c}}{\reduces} Q'$, then $P \overset{\bar{c}}{\Reduces}\simu{R} Q'$.
% \end{itemize}
% where $\overset{\bar{c}}{\reduces}$ and $\overset{\bar{c}}{\Reduces}$ are the strong and weak output transition relations on channel $c$.



% As described in \cref{sec:??}, our formula-as-process rewriting framework does not use an explicit output transition judgment, but instead handles output transitions implicitly with context equalities like $\lctx = \atmL{\lctx}'_L \oc \lctx'_0 \oc \atmR{\lctx}'_R$.
% In this implicit setting, there would be a weak output transition from $\lctx$ to $\atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ if $\lctx \Reduces \atmL{\lctx}'_L \oc \lctx'_0 \oc \atmR{\lctx}'_R$ and $\lctx'_0 \Reduces \lctx'$

% In the asynchronous CCS, a weak bisimulation is a symmetric binary relation on processes that satisfies:
% \begin{itemize}
% \item If $P \simu{R}\overset{\bar{c}}{\reduces} Q'$, then $P \overset{\bar{c}}{\Reduces}\simu{R} Q'$.
% \item If $P \simu{R}\overset{\tau}{\reduces} Q'$, then $P \overset{\tau}{\Reduces}\simu{R} Q'$.
% \item If $P \simu{R}\overset{c}{\reduces} Q'$, then $\bar{c} \mid P \overset{\tau}{\Reduces}\simu{R} Q'$.%
%   \footnote{Sometimes this is presented as the equivalent \enquote{If $P \simu{R}\overset{c}{\reduces} Q'$, then $P \overset{c}{\Reduces}\simu{R} Q'$ or there exists a process $P'$ such that $P \overset{\tau}{\Reduces} P'$ and $\bar{c} \mid P' \simu{R} Q'$.}}
% \end{itemize}
% In the presence of contextuality, the third condition is equivalent to 
% \begin{itemize}
% \item If $P \simu{R} Q$ and $\bar{c} \mid Q \overset{\tau}{\reduces} Q'$, then $\bar{c} \mid P \overset{\tau}{\Reduces}\simu{R} Q'$.
% \end{itemize}

% These correspond roughly to three conditions found in asynchronous CCS bisimilarity.
% \begin{itemize}
% \item If $P \simu{R}\overset{\bar{c}}{\reduces} Q'$, then $P \overset{\bar{c}}{\reduces}\simu{R} Q'$.
% \item If $P \simu{R}\overset{\bar{c}}{\reduces} Q'$, then $P \overset{\bar{c}}{\reduces}\simu{R} Q'$.
% \end{itemize}

% Allowing the local interaction semantics of \cref{sec:??}, an output of $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ on the left and right respectively occurs at context $\lctx$ if $\lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
% In $\pi$-calculus terms, $\lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ describes a strong output barb on the context $\lctx$.
% But because we are interested in a weak bisimilarity, we generalize this to a weak output barb: $\lctx \Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, \ie, after finitely many internal reductions, an output of $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ is eventually reached.
% Thus the above output bisimulation condition -- that $\octx \simu{R}\Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ implies $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ -- corresponds to the kind of (weak) output barb preservation familiar from asynchronous $\pi$-calculus bisimilarity.

% The above input bisimulation condition can be understood as merely the dual of the output bisimulation condition.
% But it can also be understood by analogy with asynchronous $\pi$-calculus bisimilarity.
% In the asynchronous $\pi$-calculus, 
% \begin{itemize}
% \item If $P \simu{R}\overset{\bar{c}}{\reduces} Q'$, then $P \overset{\bar{c}}{\reduces}\simu{R} Q'$.
% \item If $P \simu{R}\overset{c}{\reduces} Q'$, then either $P \overset{c}{\reduces} \simu{R} Q'$ or there exists $P'$ such that $P \overset{\tau}{\reduces} P'$ and $\bar{c} \mid P' \simu{R} Q'$.
% \item If $P \simu{R}\overset{c}{\reduces} Q'$, then $\bar{c} \mid P \overset{\tau}{\reduces}\simu{R} Q'$.
% \item If $P \simu{R} Q$ and $\bar{c} \mid Q \overset{\tau}{\reduces} Q'$, then $\bar{c} \mid P \overset{\tau}{\reduces}\simu{R} Q'$.
% \end{itemize}



% where $\overset{x(y)}{\Reduces}$ and $\overset{\tau}{\Reduces}$ are weak input and internal transitions, respectively.
% Because the judgment $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$ is a kind of input transition, we might adopt the condition that 
% \begin{itemize}
% \item If $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \#1 \oc \atmL{\lctx}_2}{\lctx}{\lctx'}$, then either: $\octx \Reduces \octx^*$ and $\ireduces{\atmR{\lctx}_L \#1 \oc \atmL{\lctx}_2}{\octx^'}{\octx'} \simu{R} \lctx'$; or there exists a process $P'$ such that $P \overset{\tau}{\Reduces} P'$ and $\bar{x}\langle y\rangle \mid P' \simu{R} Q'$.
% \end{itemize}


% Input barbs can also be described using

% $x(y).P' \simu{R} Q$ implies $\bar{x}\langle y\rangle \mid Q \Reduces Q' \simu{R}^{-1} P'$

% If $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$, then either: $\octx \Reduces \octx^*$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\octx^*}{\octx'} \Reduces\simu{R} \lctx'$; or $\octx \Reduces \octx'$ and $\atmR{\lctx}_L \oc \octx' \oc \atmL{\lctx}_R \simu{R} \lctx'$.

% If $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$, then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R} \lctx'$.



\newthought{Rewriting bisimilarity imposes} very strong conditions upon bisimilar contexts, quantifying over all traces % (not just individual rewriting steps) and also over
and
all output and input contexts.
Combined with the coinductive nature of bisimilarity, this results in a rather fine-grained equivalence.
Some contexts that might, at first glance, seem like they ought to be equivalent are, in fact, not bisimilar.
\begin{itemize}
\item The contexts $\atmL{a} \pmir \atmL{a}$ and $(\octxe)$ are \emph{not} bisimilar.
  Suppose, for the sake of contradiction, that they are bisimilar.
  Framing $\atmL{b}$ onto the right, we have $(\atmL{a} \pmir \atmL{a}) \oc \atmL{b} \rframe{\osim}{\atmL{b}} \atmL{b}$.
  Composing the input and ouput bisimulation conditions, $(\atmL{a} \pmir \atmL{a}) \oc \atmL{b} \Reduces\lframe{\atmL{b}}{\osim} \atmL{b}$ must follow.
  However, this is impossible: $(\atmL{a} \pmir \atmL{a}) \oc \atmL{b}$ is irreducible and does not expose $\atmL{b}$ at its left end.
  Therefore, $\atmL{a} \pmir \atmL{a}$ and $(\octxe)$ \emph{cannot} be bisimilar.

\item The contexts $\atmR{a}$ and $\atmR{a} \with \atmR{b}$ are not bisimilar.
  The context $\atmR{a} \with \atmR{b}$ can output $\atmR{b}$ at its right end: $\atmR{a} \with \atmR{b} \reduces \atmR{b}$.
  But $\atmR{a}$ cannot simulate that output -- the output bisimulation condition demands $\atmR{a} \Reduces\rframe{\osim}{\atmR{b}} \atmR{b}$, which is impossible.

\item If we were working in an unfocused framework, the contexts $\atmR{a}$ and $\atmR{a} \with \top$ would not be bisimilar.
  The context $\atmR{a} \with \top$ would reduce (\ie, $\atmR{a} \with \top \reduces \top$), and so the input bisimulation condition and the irreducibility of $\atmR{a}$ would imply $\atmR{a} \osim \top$.
  The output bisimulation condition would then demand that $\top$ expose $\atmL{a}$ at its left end, which is impossible.
  As we will see later, $\atmR{a}$ and $\atmR{a} \with \top$ are bisimilar in a focused framework.
\end{itemize}

Now we would like to confirm our earlier intuition about the equivalence of $\atmR{a} \oc (\atmR{a} \pmir \atmR{b})$ and $\atmR{b}$ by proving that $\atmR{a} \oc (\atmR{a} \pmir \atmR{b}) \osim \atmR{b}$.
Unfortunately, the definition of rewriting bisimilarity is not immediately suitable for establishing that two contexts are bisimilar.
The output and input bisimulation conditions are so strong that they become difficult to prove directly.
For instance, to establish $\atmR{a} \oc (\atmR{a} \limp \atmR{b}) \osim \atmR{b}$, we would need to prove that:
\begin{description}[noitemsep]% [leftmargin=0pt]
\item[Input bisimulation]% \leavevmode
 $\atmR{\lctx}_L \oc \atmR{a} \oc (\atmR{a} \limp \atmR{b}) \oc \atmL{\lctx}_R \Reduces \lctx'$ implies $\atmR{\lctx}_L \oc \atmR{b} \oc \atmL{\lctx}_R \osim \lctx'$; and % , for all $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$; and
 symmetrically, $\atmR{\lctx}_L \oc \atmR{b} \oc \atmL{\lctx}_R \Reduces \lctx'$ implies $\atmR{\lctx}_L \oc \atmR{a} \oc (\atmR{a} \limp \atmR{b}) \oc \atmL{\lctx}_R \osim \lctx'$; % , for all $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$; and
%  \end{itemize}
  
\item[Output bisimulation]% \leavevmode
 % \begin{itemize}[nosep]
   $\atmR{a} \oc (\atmR{a} \limp \atmR{b}) \Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ implies $\atmR{b} \Reduces\lrframe{\atmL{\lctx}'_L}{\osim}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$; and
   symmetrically, $\atmR{b} \Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ implies $\atmR{a} \oc (\atmR{a} \limp \atmR{b}) \Reduces\lrframe{\atmL{\lctx}'_L}{\osim}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
  % \end{itemize}
\end{description}
In this small example, it is possible to imagine tediously proving these statements -- after all, there are not that many traces involving $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$.
However, in general, a proof technique for rewriting bisimilarity is sorely needed.


% Simple examples of bisimilar (or non-bisimilar) contexts
% \begin{itemize}
% \item $\atmL{a} \pmir \atmL{a} \nosim \octxe$ because input bisimulation followed by output bisimulation demands that $\atmR{b} \oc (\atmL{a} \pmir \atmL{a}) \Reduces\lrframe{}{\osim}{\atmR{b}} \atmR{b}$, which is impossible because $\atmR{b} \oc (\atmL{a} \pmir \atmL{a})$ has no nontrivial reductions and does not expose $\atmR{b}$ at its right.
% \item $\atmR{a} \with \atmR{b} \nosim \atmR{a}$ because $\atmR{a} \Reduces\lrframe{}{\osim}{\atmR{b}} \atmR{b}$ is impossible.
% \item {[$\atmR{a} \with \top \osim \atmR{a}$, but only because rewriting is (weakly) focused.]}
% \item $\atmR{a} \oc (\atmR{a} \limp \atmR{b}) \osim \atmR{b}$ intuitively because $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ has no input transitions and reduces to $\atmR{b}$.
%   Need a proof technique to establish this.
% \item $\atmR{a} \limp (\atmR{c} \pmir \atmL{b}) \osim (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$ intuitively because the two propositions are logically equivalent.
%   Both have the same input transitions.
%   Also, $\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b}) \osim \up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$.
% \end{itemize}


\subsection{Labeled bisimilarity: A proof technique for rewriting bisimilarity}\label{sec:ordered-bisimilarity:labeled-bisim}

In \ac{CCS} and the $\pi$-calculus, bisimilarity is similarly too strong to be used directly in proving the equivalence of processes.
There, a sound proof technique for bisimilarity is built around a labeled transition system and a notion of labeled bisimulation.\autocite{Sangiorgi+Walker:CUP03}
Because the labeled transition system is image-finite, proving that two processes are labeled bisimilar is more tractable than directly proving them to be bisimilar.

In this \lcnamecref{sec:ordered-bisimilarity:labeled-bisim}, we follow that strategy and develop \vocab{labeled bisimilarity} as a sound -- and, surprisingly, also complete -- proof technique for rewriting bisimilarity.
Like its \ac{CCS} and $\pi$-calculus analogues, labeled bisimilarity is more tractable than rewriting bisimilarity because it uses individual input transitions in place of full rewriting sequences.

Instead of defining labeled bisimulations directly, we use a refactorization, standard in the study of up-to techniques\autocite{??}, in which we first define a notion of \emph{progression} and then characterize labeled bisimulations in terms of progression.
\begin{definition}
  A binary relation $\simu{R}$ on contexts \vocab{progresses} to binary relation $\simu{S}$ if $\simu{R}$ is symmetric and the two relations satisfy the following conditions.
  \begin{thmdescription}[nosep]
  \item[Immediate output bisim.]
    If $\octx \simu{R} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{S}}{\atmR{\lctx}'_R} \lctx$.
  \item[Immediate input bisimulation]
    If $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$, then\\$\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{S} \lctx'$.
  \item[Reduction bisimulation]
    If $\octx \simu{R}\reduces \lctx'$, then $\octx \Reduces\simu{S} \lctx'$.
  \item[Emptiness bisimulation]
    If $\octx \simu{R} (\octxe)$, then:
    \begin{itemize*}[label=, afterlabel=]
    \item $\atmR{\lctx} \oc \octx \Reduces\rframe{\simu{S}}{\atmR{\lctx}} \atmR{\lctx}$ for all $\atmR{\lctx}$; and
    \item $\octx \oc \atmL{\lctx} \Reduces\lframe{\atmL{\lctx}}{\simu{S}} \atmL{\lctx}$ for all $\atmL{\lctx}$.
    \end{itemize*}
  \end{thmdescription}
  A \vocab{labeled bisimulation} is a relation that progresses to itself, and \vocab{labeled bisimilarity} is the largest labeled bisimulation.
  \begin{marginfigure}
    \begin{center}
      \begin{tabular}{@{}c@{}}
        \begin{tikzcd}[sep=large]
          \octx
            \rar[relation, "\simu{R}"]
            \dar[Reduces, exists]
          &
          \lctx \mathrlap{{} = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R}
          \\
          \atmL{\lctx}'_L \oc \octx' \oc \atmR{\lctx}'_R
            \urar[relation, exists, "\lrframe{\atmL{\lctx}'_L}{\simu{S}}{\atmR{\lctx}'_R}" {sloped, below}]
        \end{tikzcd}%
        \phantom{${} = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$}
        \\
        \emph{Immediate output bisimulation}
        \\[2ex]
        \begin{tikzcd}[sep=large]
          \atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R
            \rar[relation, "\lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}"]
            \arrow[Reduces, exists]{dd}
          &
          \atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R
          \\[-6ex]
          &
          \atmR{\lctx}_L \oc [\lctx] \oc \atmL{\lctx}_R
            \dar[reduces]
          \\
          \octx\mathrlap{'}
            \rar[relation, exists]{\simu{S}}
          &
          \lctx\mathrlap{'}
        \end{tikzcd}
        \\
        \emph{Immediate input bisimulation}
        \\[2ex]
        \begin{tikzcd}[sep=large]
          \octx
            \rar[relation, "\simu{R}"]
            \dar[Reduces, exists]
          &
          \lctx
            \dar[reduces]
          \\
          \octx\mathrlap{'}
            \rar[relation, exists, "\simu{S}"]
          &
          \lctx\mathrlap{'}
        \end{tikzcd}
        \\
        \emph{Reduction bisimulation}
        \\[2ex]
        \begin{tikzcd}[sep=large]
          \atmR{\lctx} \oc \octx
            \rar[relation, "\lrframe{\atmR{\lctx}}{\simu{R}}{}"]
            \dar[Reduces, exists]
          &
          \atmR{\lctx}
          \\
          \octx' \oc \atmR{\lctx}
            \urar[relation, exists, "\lrframe{}{\simu{S}}{\atmR{\lctx}}" {sloped, below}]
        \end{tikzcd}
        \quad
        \begin{tikzcd}[sep=large]
          \octx \oc \atmL{\lctx}
            \rar[relation, "\lrframe{}{\simu{R}}{\atmL{\lctx}}"]
            \dar[Reduces, exists]
          &
          \atmL{\lctx}
          \\
          \atmL{\lctx} \oc \octx'
            \urar[relation, exists, "\lrframe{\atmL{\lctx}}{\simu{S}}{}" {sloped, below}]
        \end{tikzcd}
        \\
        \emph{Emptiness bisimulation}
      \end{tabular}
    \end{center}
    \caption{Labeled bisimulation conditions, in diagrams}
  \end{marginfigure}
\end{definition}

The immediate output, immediate input, and reduction bisimulation conditions are all single-step forms of rewriting bisimilarity's output and input bisimulation conditions~\parencref{def:ordered-bisimilarity:bisim} and reduction bisimulation property~\parencref{thm:bisim-reduction-closure}.
The emptiness bisimulation condition, on the other hand, is necessary for labeled bisimilarity to be complete.
A similar condition appears in \textcite{Deng+:MSCS16}'s simulation preorder.

Emptiness bisimulation is equivalent to requiring that $\octx \simu{R} (\octxe)$ implies both $\octx \Reduces (\octxe)$ and $(\octxe) \simu{S} (\octxe)$.%
\footnote{See \cref{thm:emptiness-bisim-equiv} for a proof sketch.}
In this way, it can be seen that being $\simu{R}$-related to $(\octxe)$ is possible only if $\octx$ is morally equivalent to $(\octxe)$, in the sense that $\octx$ must be able to spontaneously evolve to $(\octxe)$.


% O R (.) implies a O ==>(Ra) a
% a O ==> O' a and O' R (.)
% Case: a O = O' a
%   O = (.) because it can't end with a 
% Case: a O -->  ==> O' a
%   O --> O' and a O'' ==> O' a
%   O'' ==> (.)
%   O ==> (.)


% If D O ==>(Sa) D, then O ==> (.) and (.) S (.).
% If O ==> (.) S (.), then D O ==>(SD) D.

% a O ==> O' a then O ==> (.) and O' = (.)
% Case: a O = O' a
%   O = O' = . because a can't apear in O
% Case: a O --> ==> O' a
%   O --> O1 and a O1 ==> O' a
%   O1 ==> (.) and O' = (.)
%   O ==> (.)

\newthought{It is relatively} straightforward to show that labeled bisimilarity is complete with respect to rewriting bisimilarity: every rewriting bisimulation is itself a labeled bisimulation.
%
\begin{theorem}[Completeness of labeled bisimilarity]\label{thm:ordered-bisimilarity:labeled-complete}
  Every rewriting bisimulation is also a labeled bisimulation, and labeled bisimilarity consequently contains rewriting bisimilarity.
\end{theorem}
\begin{proof}
  Let $\simu{R}$ be a rewriting bisimulation.
  The immediate output, immediate input, and reduction bisimulation conditions are trivial instances of the output and input bisimulation conditions.
  For instance, to prove that $\simu{R}$ is an immediate input bisimulation, assume that $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$; then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R} \reduces \lctx'$.
  Because $\simu{R}$ is a rewriting bisimulation, it follows from the input bisimulation property that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R} \lctx'$.

  The emptiness bisimulation condition follows from the composition of the input bisimulation property with the output bisimulation property.%
  \begin{marginfigure}
    \begin{center}
      \begin{tabular}{@{}c@{\quad}c@{}}
        \begin{tikzcd}
          \atmR{\lctx} \oc \octx
            \rar[relation, "\lrframe{\atmR{\lctx}}{\simu{R}}{}"]
            \dar[Reduces]
          &
          \atmR{\lctx}
            \arrow[Reduces, loop right]{}
          \\
          \octx\mathrlap{'}
            \urar[relation, "\simu{R}" sloped]
            \dar[Reduces]
          \\
          \octx'' \oc \atmR{\lctx}
            \arrow[relation, "\lrframe{}{\simu{R}}{\atmR{\lctx}}" {sloped, below}]{uur}
        \end{tikzcd}
        &
        \begin{tikzcd}
          \octx \oc \atmL{\lctx}
            \rar[relation, "\lrframe{}{\simu{R}}{\atmL{\lctx}}"]
            \dar[Reduces]
          &
          \atmL{\lctx}
            \arrow[Reduces, loop right]{}
          \\
          \octx\mathrlap{'}
            \urar[relation, "\simu{R}" sloped]
            \dar[Reduces]
          \\
          \atmL{\lctx} \oc \octx''
            \arrow[relation, "\lrframe{\atmL{\lctx}}{\simu{R}}{}" {sloped, below}]{uur}
        \end{tikzcd}
      \end{tabular}
    \end{center}
    \caption{Emptiness bisimulation property as a consequence of input and output bisimulation properties}
  \end{marginfigure}
\end{proof}



Unfortunately, the direct converse is not true: a labeled bisimulation is not necessarily itself a rewriting bisimulation.
For example, consider the least symmetric binary relation $\simu{R}$ such that
\begin{equation*}
  \atmR{a} \limp (\atmR{c} \pmir \atmL{b}) \simu{R} (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}
  \quad\text{and}\quad
  \atmR{c} \simu{R} \atmR{c}
  \quad\text{and}\quad
  (\octxe) \simu{R} (\octxe)
  \,.
\end{equation*}
The relation $\simu{R}$ is a labeled bisimulation, but it does not qualify as a rewriting bisimulation because it does not satisfy the more general input bisimulation condition: for instance, $\atmR{a} \oc (\atmR{a} \limp (\atmR{c} \pmir \atmL{b})) \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc ((\atmR{a} \limp \atmR{c}) \pmir \atmL{b})$ does not imply $\atmR{a} \oc (\atmR{a} \limp (\atmR{c} \pmir \atmL{b})) \Reduces\simu{R} \atmR{a} \oc ((\atmR{a} \limp \atmR{c}) \pmir \atmR{b})$.
That would be possible only if $\atmR{a} \oc (\atmR{a} \limp (\atmR{c} \pmir \atmL{b}))$ and $\atmR{a} \oc ((\atmR{a} \limp \atmR{c}) \pmir \atmR{b})$ were $\simu{R}$-related.

Even though a labeled bisimulation itself is not a rewriting bisimulation, a slightly weaker statement is nevertheless true: each labeled bisimulation is contained within \emph{some} rewriting bisimulation.
Specifically, if $\simu{R}$ is a labeled bisimulation, then its input contextual closure, $\ctxc{\simu{R}}$, as described in \cref{def:ordered-bisimilarity:framed-relation} is such a rewriting bisimulation.
Fortunately, this will be enough to prove that labeled bisimilarity is sound.



% \begin{definition}
%   A symmetric binary relation $\simu{R}$ \vocab{(labeled-)progresses} to binary relation $\simu{S}$ if the two relations satisfy the following conditions.
%   \begin{thmdescription}
%   \item[Immediate output bisimulation]
%     If $\octx \simu{R} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{S}}{\atmR{\lctx}'_R} \lctx$.
%   \item[Immediate input bisimulation]
%     If $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$, then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{S} \lctx'$.
%   \item[Reduction bisimulation]
%     If $\octx \simu{R}\reduces \lctx'$, then $\octx \Reduces\simu{S} \lctx'$.
%   \item[Emptiness bisimulation]
%     If $\octx \simu{R} \octxe$, then:
%     \begin{itemize*}[label=, afterlabel=]
%     \item $\atmR{\lctx} \oc \octx \Reduces\lrframe{}{\simu{S}}{\atmR{\lctx}} \atmR{\lctx}$ for all $\atmR{\lctx}$; and
%     \item $\octx \oc \atmL{\lctx} \Reduces\lrframe{\atmL{\lctx}}{\simu{S}}{} \atmL{\lctx}$ for all $\atmL{\lctx}$.
%     \end{itemize*}
%   \end{thmdescription}
% \end{definition}
% %
% \noindent
% Notice that the labeled bisimulations are exactly those relations that progress to themselves.



% \begin{lemma}
%   If $\simu{R}$ is a labeled bisimulation, then $\ctxc{\simu{R}}$ satisfies the following properties.
%   \begin{thmdescription}
%   \item[Immediate output bisimulation]
%     If $\octx \ctxc{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$.
%   \item[Reduction bisimulation]
%     If $\octx \ctxc{\simu{R}}\reduces \lctx'$, then $\octx \Reduces\ctxc{\simu{R}} \lctx'$.
%   \end{thmdescription}
% \end{lemma}
% \begin{proof}
%   The two properties are established separately. 
%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\octx \ctxc{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%     There are four cases, according to whether $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty.
%     \begin{itemize}[parsep=0pt, listparindent=\parindent]
%     \item Consider the case in which both $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty; in this case, we must show that $\octx \Reduces\ctxc{\simu{R}} \lctx$.
%       Using a trivial trace, that follows directly from the assumption $\octx \ctxc{\simu{R}} \lctx$.

%     \item Consider the case in which both $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are nonempty.
%       The context $\lctx$ therefore exposes output atoms\fixnote{messages?} at its left and right ends.
%       And so the $\ctxc{\simu{R}}$-related contexts $\octx$ and $\lctx$ must, in fact, be $\simu{R}$-related, for otherwise at least one end of $\lctx$ would expose an input, not output, atom.
%       In other words, $\octx \simu{R} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%       Because $\simu{R}$ is a labeled bisimulation and satisfies the immediate output bisimulation property, it follows that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \lctx$.
%       Since $\ctxc{\simu{R}}$ trivially contains $\simu{R}$, we conclude that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.

%     \item Consider the case in which $\atmL{\lctx}'_L$ is nonempty and $\atmR{\lctx}'_R$ is empty; in this case, we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{} \lctx$.
%       Similar to the previous case, $\lctx$ exposes output atoms at its left end because $\atmL{\lctx}'_L$ is nonempty.
%       And so the $\ctxc{\simu{R}}$-related contexts $\octx$ and $\lctx$ must, in fact, be $\lrframe{}{\simu{R}}{\atmL{\octx}_R}$-related, for some $\atmL{\octx}_R$, for otherwise the left end of $\lctx$ would expose an input, not output, atom.
%       In other words, $\octx \lrframe{}{\simu{R}}{\atmL{\octx}_R} \lctx = \atmL{\lctx}'_L \oc \lctx'$.

%       There are two subcases, according to how far the left edge of $\atmL{\octx}_R$ extends into $\lctx$.
%       \begin{itemize}
%       \item Suppose that the left edge of $\atmL{\octx}_R$ does not extend into $\atmL{\lctx}'_L$.
%         Because $\simu{R}$ is a labeled bisimulation, we may appeal to the immediate output bisimulation property after framing off $\atmL{\octx}_R$ -- we deduce $\octx \mathrel{\bigl((\Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{})\atmL{\octx}_R\bigr)} \lctx$.
%         Reduction is closed under framing, so we conclude $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{} \lctx$.
%       \item Otherwise, suppose that the left edge of $\atmL{\octx}_R$ does indeed extend into $\atmL{\lctx}'_L$.
%         In this case, there exist contexts $\atmL{\lctx}''_L$ and $\atmL{\octx}'_L$ such that $\atmL{\lctx}'_L = \atmL{\lctx}''_L \oc \atmL{\octx}'_L$ and $\atmL{\octx}_R = \atmL{\octx}'_L \oc \lctx'$.
%         Because $\simu{R}$ is a labeled bisimulation, we will compose the immediate output and emptiness bisimulation properties to establish $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{} \lctx$.

%         After framing off $\atmL{\octx}_R$, we may appeal to the immediate output bisimulation property and deduce $\octx \mathrel{\bigl((\Reduces\lrframe{\atmL{\lctx}''_L}{\simu{R}}{})\atmL{\octx}_R\bigr)} \lctx = \atmL{\lctx}''_L \oc \atmL{\octx}_R$.
%         Reduction is closed under framing, so $\octx \Reduces\lrframe{\atmL{\lctx}''_L}{\simu{R}}{\atmL{\octx}_R} \lctx$.
%         Upon respelling $\atmL{\octx}_R$ as $\atmL{\octx}'_L \oc \lctx'$ and framing off $\atmL{\lctx}''_L$ and $\lctx'$, we may appeal to the emptiness bisimulation property and deduce $\octx \Reduces\mathrel{\bigl(\atmL{\lctx}''_L\mathord{(\Reduces\lrframe{\atmL{\octx}'_L}{\simu{R}}{})}\lctx'\bigr)} \lctx = \atmL{\lctx}''_L \oc \atmL{\octx}'_L \oc \lctx'$.
%         Once again, reduction is closed under framing and we may respell $\atmL{\lctx}''_L \oc \atmL{\octx}'_L$ as $\atmL{\lctx}'_L$, so $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\lctx'} \lctx$.
%         Finally, because $\lctx'$ is an input context, we may conclude that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{} \lctx$.
%       \end{itemize}

%     \item The case in which $\atmR{\lctx}'_R$ is nonempty and $\atmL{\lctx}'_L$ is empty is symmetric to the previous case.
%     \end{itemize}

%   \item[Reduction bisimulation]
%     Assume that $\octx \ctxc{\simu{R}}\reduces \lctx'$.
%     There are two cases: either the reduction arises from the $\simu{R}$-related component alone, or it arises from an input transition of the $\simu{R}$-related component that has its input demands met by the framing environment.
%     \begin{itemize}
%     \item Consider the case in which the reduction arises from the $\simu{R}$-related component alone -- that is, the case in which $\octx \ctxc{\simu{R}\reduces} \lctx'$.
%       Because $\simu{R}$ is a labeled bisimulation and therefore satisfies reduction bisimulation, it follows that $\octx \ctxc{\Reduces\simu{R}} \lctx'$.
%       Reduction is closed under framing, so $\octx \Reduces\ctxc{\simu{R}} \lctx'$.
%     \item Consider the case in which the reduction arises from an input transition of the $\simu{R}$-related component that has its input demands met by the framing environment -- that is, the case in which $\octx \ctxc{\lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}\mathrel{(\prescript{\atmR{\lctx}_L}{}{\simu{I}}^{\atmL{\lctx}_R})}} \lctx'$ for some $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$, where $\atmR{\lctx}_L \oc \lctx_0 \oc \atmL{\lctx}_R \mathrel{(\prescript{\atmR{\lctx}_L}{}{\simu{I}}^{\atmL{\lctx}_R})} \lctx'_0$ if $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$.
%       Because $\simu{R}$ is a labeled bisimulation and therefore satisfies immediate input bisimulation, it follows that $\octx \ctxc{\Reduces\simu{R}} \lctx'$.
%       Once again, reduction is closed under framing, so $\octx \Reduces\ctxc{\simu{R}} \lctx'$.
%     \end{itemize}
%     Note that it is impossible for the reduction to arise from the framing environment alone, because $\ctxc{\simu{R}}$ surrounds the $\simu{R}$-related components with only input messages, which are passive.
%   \qedhere
%   \end{description}
% \end{proof}

% \begin{theorem}
%   If $\simu{R}$ is a labeled bisimulation, then $\ctxc{\simu{R}}$ is a rewriting bisimulation.
% \end{theorem}
% \begin{proof}
%   To prove that $\ctxc{\simu{R}}$ is a rewriting bisimulation whenever $\simu{R}$ is a labeled bisimulation, we shall establish output and input bisimulation properties for $\ctxc{\simu{R}}$.
%   \begin{description}
%   \item[Output bisimulation]
%     follows by composing the reduction bisimulation and immediate output bisimulation properties of $\ctxc{\simu{R}}$, as proved in \cref{??}.%
%     \fixnote{Diagram?}
%   \item[Input bisimulation]
%     for $\ctxc{\simu{R}}$ is simply an instance of its reduction bisimulation property, as proved in \cref{??}, because $\ctxc{\simu{R}}$ is closed under framing of input message contexts.%
%     \fixnote{Diagram?}
%   \qedhere
%   \end{description}
% \end{proof}

% \begin{corollary}
%   Rewriting bisimilarity contains labeled bisimilarity.
% \end{corollary}


% \begin{theorem}
%   Given a binary relation $\simu{R}$, let $\ctxc{\simu{R}}$ be the \emph{input context[ual] closure} of $\simu{R}$ -- the least relation such that $\lctx \ctxc{\simu{R}} \octx$ if $\lctx \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R} \octx$ for some $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$.
%   If $\simu{R}$ is a labeled bisimulation, then $\ctxc{\simu{R}}$ is a rewriting bisimulation.
% \end{theorem}
% \begin{proof}
%   \begin{itemize}
%   \item
%     Suppose that $\octx \simu{R}^{-1}\reduces\Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%     $\octx \Reduces\simu{R}^{-1}\Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$
%     $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R}^{-1} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$
%   \item
%     Suppose that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}^{-1} \lctx'$.
%     So $\octx \simu{R}^{-1} \lctx'_0$ and $\lctx' = \atmR{\lctx}_L \oc \lctx'_0 \oc \atmL{\lctx}_R$.
%   \end{itemize}
% \end{proof}


% \begin{theorem}
%   A symmetric relation $\simu{R}$ is contained in bisimilarity if it satisfies the following conditions.
%   \begin{thmdescription}
%   \item[Immediate output]
%     If $\octx \simu{R}^{-1} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R}^{-1} \lctx$.
%   \item[Immediate input]
%     If $\octx \simu{R}^{-1} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$, then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R}^{-1} \lctx'$.
%   \item[Reduction closure]
%     If $\octx \simu{R}^{-1}\reduces \lctx'$, then $\octx \Reduces\simu{R}^{-1} \lctx'$.
%   % \item[Emptiness]
%   %   If $\octx \simu{R}^{-1} \octxe$, then:
%   %   \begin{itemize*}[label=, afterlabel=]
%   %   \item $\atmR{\lctx} \oc \octx \Reduces\lrframe{}{\simu{R}}{\atmR{\lctx}}^{-1} \atmR{\lctx}$ for all $\atmR{\lctx}$; and
%   %   \item $\octx \oc \atmL{\lctx} \Reduces\lrframe{\atmL{\lctx}}{\simu{R}}{}^{-1} \atmL{\lctx}$ for all $\atmL{\lctx}$.
%   %   \end{itemize*}
%   \item[Input contextuality]
%     If $\lctx \simu{R} \octx$, then $\atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R \simu{R} \atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R$ for all $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$.
%   \end{thmdescription}
% \end{theorem}
% \begin{proof}
%   \begin{description}
%   \item[Output bisimulation]
%     Suppose that $\octx \simu{R}^{-1} \lctx \Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%     By induction on the structure of the given trace, we can show $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R}^{-1} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%     The base case follows from the immediate output bisimulation property of $\simu{R}$;
%     the inductive case follows from reduction closure of $\simu{R}$ and the inductive hypothesis.
%   \item[Input bisimulation]
%     Suppose that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}^{-1} \atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R \Reduces \lctx'$.
%     We can show, by induction on the structure of the given trace, that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R}^{-1} \lctx'$.
%     The base case follows from the input context closure property of $\simu{R}$.
%     \begin{itemize}
%     \item Suppose that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}^{-1} \atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R \reduces \lctx_1 \Reduces \lctx'$.
%       By Lemma?, there are three possible cases:
%       \begin{itemize}
%       \item If $\lctx \reduces \lctx'_1$ and $\lctx_1 = \atmR{\lctx}_L \oc \lctx'_1 \oc \atmL{\lctx}_R$, then it follows from the reduction closure property of $\simu{R}$ that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R}^{-1}\Reduces \lctx'$.
%       \end{itemize}
%       In any case, $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\lrframe{\atmR{\lctx}^1_L}{\simu{R}}{\atmL{\lctx}^1_R}^{-1} \lctx_1 \Reduces \lctx'$.
%       It follows from the inductive hypothesis that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R}^{-1} \lctx'$.
%     \end{itemize}
%     the inductive case follows from reduction closure of $\simu{R}$ and the inductive hypothesis.
%   \end{description}
% \end{proof}


% \begin{theorem}
%   Let $\simu{R}$ be a symmetric relation that satisfies the following conditions;
%   then $\ctxc{\simu{R}}$ is a rewriting bisimulation.
%   \begin{thmdescription}
%   \item[Immediate output]
%     If $\octx \simu{R}^{-1} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{\atmR{\lctx}'_R}^{-1} \lctx$.
%   \item[Immediate input]
%     If $\octx \simu{R}^{-1} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$, then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\ctxc{\simu{R}}^{-1} \lctx'$.
%   \item[Reduction closure]
%     If $\octx \simu{R}^{-1}\reduces \lctx'$, then $\octx \Reduces\ctxc{\simu{R}}^{-1} \lctx'$.
%   \item[Emptiness]
%     If $\octx \simu{R}^{-1} \octxe$, then:
%     \begin{itemize*}[label=, afterlabel=]
%     \item $\atmR{\lctx} \oc \octx \Reduces\lrframe{}{\ctxc{\simu{R}}}{\atmR{\lctx}}^{-1} \atmR{\lctx}$ for all $\atmR{\lctx}$; and
%     \item $\octx \oc \atmL{\lctx} \Reduces\lrframe{\atmL{\lctx}}{\ctxc{\simu{R}}}{}^{-1} \atmL{\lctx}$ for all $\atmL{\lctx}$.
%     \end{itemize*}
%   % \item[Input contextuality]
%   %   If $\lctx \simu{R} \octx$, then $\atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R \simu{R} \atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R$ for all $\atmR{\lctx}_L$ and $\atmL{\lctx}_R$.
%   \end{thmdescription}
% \end{theorem}
% \begin{proof}
%   \begin{description}
%   \item[Immediate output]
%     We must show that $\octx \ctxc{\simu{R}}^{-1} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ implies $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{\atmR{\lctx}'_R}^{-1} \lctx$.
%     \begin{itemize}
%     \item 
%     \end{itemize}
%   \end{description}
% \end{proof}

% \subsection{}

% \begin{definition}
%   A symmetric binary relation $\simu{R}$ is a labeled bisimulation up to reflexivity and context if it satisfies the following conditions.
%   \begin{thmdescription}
%   \item[Immediate output bisimulation]
%     If $\octx \simu{R} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{(\osim\ctxc{\reflc{\simu{R}}})}{\atmR{\lctx}'_R} \lctx$.
%   \item[Immediate input bisimulation]
%     If $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$, then $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\osim\ctxc{\reflc{\simu{R}}} \lctx'$.
%   \item[Reduction bisimulation]
%     If $\octx \simu{R}\reduces \lctx'$, then $\octx \Reduces\osim\ctxc{\reflc{\simu{R}}} \lctx'$.
%   \item[Emptiness bisimulation]
%     If $\octx \simu{R} \octxe$, then:
%     \begin{itemize*}[label=, afterlabel=]
%     \item $\atmR{\lctx} \oc \octx \Reduces\lrframe{}{(\osim\ctxc{\reflc{\simu{R}}})}{\atmR{\lctx}} \atmR{\lctx}$ for all $\atmR{\lctx}$; and 
%     \item $\octx \oc \atmL{\lctx} \Reduces\lrframe{\atmL{\lctx}}{(\osim\ctxc{\reflc{\simu{R}}})}{} \atmL{\lctx}$ for all $\atmL{\lctx}$
%     \end{itemize*}%
%     .
%   \end{thmdescription}
% \end{definition}

% \begin{lemma}
%   If $\simu{R}$ is a labeled bisimulation up to reflexivity and context, then $\osim\ctxc{\reflc{\simu{R}}}$ satisfies the following conditions.
%   \begin{thmdescription}
%   \item[Immediate output bisimulation]
%     If $\octx \osim\ctxc{\reflc{\simu{R}}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{(\osim\ctxc{\reflc{\simu{R}}})}{\atmR{\lctx}'_R} \lctx$.
%   \item[Reduction bisimulation]
%     If $\octx \osim\ctxc{\reflc{\simu{R}}}\reduces \lctx'$, then $\octx \Reduces\osim\ctxc{\reflc{\simu{R}}} \lctx'$.
%   \end{thmdescription}
% \end{lemma}
% \begin{proof}
%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\octx \ctxc{\reflc{\simu{R}}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$; we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\reflc{\simu{R}}}}{\atmR{\lctx}'_R} \lctx$.
%     There are two cases: either the $\reflc{\simu{R}}$-related components of $\octx$ and $\lctx$ are equal or merely $\simu{R}$-related.
%     \begin{itemize}
%     \item If the $\reflc{\simu{R}}$-related components of $\octx$ and $\lctx$ are in fact equal, then so are $\octx$ and $\lctx$.
%       $\octx \ctxc{\reflc{\simu{R}}} \lctx$
%     \item
%       Otherwise, the $\reflc{\simu{R}}$-related components of $\octx$ and $\lctx$ are merely $\simu{R}$-related, with $\octx \ctxc{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%       There are four subcases according to whether $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty.
%       \begin{itemize}
%       \item Consider the subcase in which both $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty;
%         in this subcase, we must show that $\octx \Reduces\ctxc{\reflc{\simu{R}}} \lctx$.
%         Because $\ctxc{\reflc{\simu{R}}}$ includes $\ctxc{\simu{R}}$, that follows directly.

%       \item Consider the subcase in which both $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are nonempty.
%         The context $\lctx$ therefore exposes output atoms at its left and right ends, and so the $\ctxc{\simu{R}}$-related contexts $\octx$ and $\lctx$ must, in fact, be $\simu{R}$-related, for otherwise at least one end of $\lctx$ would expose an input, not output, atom.
%         In other words, $\octx \simu{R} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%         Because $\simu{R}$ is a labeled bisimulation up to reflexivity and contect, $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\reflc{\simu{R}}}}{\atmR{\lctx}'_R} \lctx$ follows from the immediate output property.

%       \item Consider the subcase in which $\atmL{\lctx}'_L$ is nonempty and $\atmR{\lctx}'_R$ is empty;
%         in this subcase, we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\reflc{\simu{R}}}}{} \lctx$.
%         Similarly to the previous case, $\lctx$ exposes output atoms at its left end because $\atmL{\lctx}'_L$ is nonempty.
%         And so the $\ctxc{\simu{R}}$-related contexts $\octx$ and $\lctx$ must, in fact, be $\lrframe{}{\simu{R}}{\atmL{\octx}_R}$-related, for some input context $\atmL{\octx}_R$.
%         In other words, $\octx \lrframe{}{\simu{R}}{\atmL{\octx}_R} \lctx = \atmL{\lctx}'_L \oc \lctx'$.

%         \begin{itemize}
%         \item Suppose that the left edge of $\atmL{\octx}_R$ does not extend into $\atmL{\lctx}'_L$.
%           Because $\simu{R}$ is a labeled bisimulation up to reflexivity and context, we may appeal to the immediate output property after framing off $\atmL{\octx}_R$ -- we deduce $\octx \lrframe{}{(\Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\reflc{\simu{R}}}}{})}{\atmL{\octx}_R} \lctx$.
%           Reduction is closed under framing, so $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\reflc{\simu{R}}}}{} \lctx$.

%         \item Otherwise, suppose that the left edge of $\atmL{\octx}_R$ does extend into $\atmL{\lctx}'_L$ -- in other words, that $\atmL{\lctx}'_L = \atmL{\lctx}''_L \oc \atmL{\octx}'_L$ and $\atmL{\octx}_R = \atmL{\octx}'_L \oc \lctx'$ for some $\atmL{\octx},_L$.
%           We therefore have $\octx \lrframe{}{\simu{R}}{\atmL{\octx}_R} \lctx = \atmL{\lctx}''_L \oc \atmL{\octx}_R$.
%           Because $\simu{R}$ is a labeled bisimulation up to reflexivity and context, we may appeal to the immediate output property after framing off $\atmL{\octx}_R$ -- we deduce $\octx \lrframe{}{(\Reduces\lrframe{\atmL{\lctx}''_L}{\ctxc{\reflc{\simu{R}}}}{})}{\atmL{\octx}_R} \lctx$.
%           Reduction is closed under framing, so $\octx \Reduces\lrframe{\atmL{\lctx}''_L}{\ctxc{\reflc{\simu{R}}}}{\atmL{\octx}_R} \lctx$.

%           Respelling $\atmL{\octx}_R$ as $\atmL{\octx}'_L \oc \lctx'$, we have $\octx \Reduces\lrframe{\atmL{\lctx}''_L}{\lrframe{}{\ctxc{\reflc{\simu{R}}}}{\atmL{\octx}'_L}}{\lctx'} \lctx = \atmL{\lctx}''_L \oc \atmL{\octx}'_L \oc \lctx'$.
%           Once again, because $\simu{R}$ is a labeled bisimulation up to reflexivity and context, we may appeal to the emptiness property after framing off $\atmL{\lctx}''_L$ and $\lctx'$ -- we deduce $\octx \Reduces\lrframe{\atmL{\lctx}''_L}{(\Reduces\lrframe{\atmL{\octx}'_L}{\ctxc{\reflc{\simu{R}}}}{})}{\lctx'} \atmL{\lctx}''_L \oc \atmL{\octx}'_L \oc \lctx' = \lctx$.
%           Again, reduction is closed under framing, so $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\reflc{\simu{R}}}}{} \lctx$.
%         \end{itemize}
%       \item The subcase in which $\atmL{\lctx}'_L$ is nonempty and $\atmR{\lctx}'_R$ is empty.
%       \end{itemize}
%     \end{itemize}

%   \item[Reduction bisimulation]
%     Assume that $\octx \ctxc{\reflc{\simu{R}}}\reduces \lctx'$.
%     The $\reflc{\simu{R}}$-related components are either equal or $\simu{R}$-related.
%     In the latter case, either the reduction arises from the $\simu{R}$-related component alone, or it arises from an input transition of the $\simu{R}$-component that has its input demands met by the framing environment. 
%     There are thus three cases:
%     \begin{itemize}
%     \item Consider the case in which the $\reflc{\simu{R}}$-related components are in fact equal -- that is, the case in which $\octx \ctxc{=}\reduces \lctx'$.
%       $\octx \reduces \lctx'$.
%       Because $\ctxc{\reflc{\simu{R}}}$ is reflexive, $\octx \Reduces\ctxc{\reflc{\simu{R}}} \lctx'$.
      
%     \item Consider the case in which the reduction arises from the $\simu{R}$-related component alone -- that is, the case in which $\octx \ctxc{\simu{R}\reduces} \lctx'$.
%       Because $\simu{R}$ satisfies reduction bisimulation up to reflexivity and context, $\octx \ctxc{\Reduces\ctxc{\reflc{\simu{R}}}} \lctx'$.
%       Reduction is closed under framing and $\ctxc{}$ is an idempotent operation, so $\octx \Reduces\ctxc{\reflc{\simu{R}}} \lctx'$.
  
%     \item Consider the case in which the reduction arises from an input transition of the $\simu{R}$-related component that has had its input demands met by the framing environment -- that is, the case in which [...].
%       Because $\simu{R}$ satisfies immediate input bisimulation up to reflexivity and context, it follows that $\octx \ctxc{\Reduces\ctxc{\reflc{\simu{R}}}} \lctx'$.
%       Once again, reduction is closed under framing and $\ctxc{}$ is an idempotent operation, so $\octx \Reduces\ctxc{\reflc{\simu{R}}} \lctx'$.
%     \end{itemize}
%   \end{description}
% \end{proof}


% \section{}

% Given a binary relation $\simu{R}$, let $\simu{R}^*$ be the least \emph{reflexive} relation containing $\lrframe{\atmR{a}}{\simu{R}}{}$ for all $\atmR{a}$.
% If $\simu{R}$ is a blabeled bisimulation, then so is $\simu{R}^*$.
% \begin{description}
% \item[Immediate output bisimulation]
%   Assume that $\octx \lrframe{\atmR{a}}{\simu{R}}{} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ for some $\atmR{a}$; we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}^*}{\atmR{\lctx}'_R} \lctx$.
%   \begin{itemize}
%   \item $\lctx'$ is nonempty.
%   \item $\lctx'$ is empty.
%   \end{itemize}

% \item[Reduction bisimulation]
%   Assume that $\octx \lrframe{\atmR{a}}{\simu{R}}{}\reduces \lctx'$.
%   \begin{itemize}
%   \item $\octx \lrframe{\atmR{a}}{(\simu{R}\reduces)}{} \lctx'$
%   \item $\octx \lrframe{\atmR{a}}{\simu{R}}{} \atmR{a} \oc \lctx$ where $\ireduces{\atmR{a} \oc #1}{\lctx}{\lctx'}$
%   \end{itemize}

% \item[Immediate input bisimulation]
%   Assume that $\octx \lrframe{\atmR{a}}{\simu{R}}{} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$; we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R}^* \lctx'$.
%   \begin{itemize}
%   \item $\lctx = \atmR{a} \oc \lctx_0$ and $\ireduces{\atmR{\lctx}_L \oc \atmR{a} \oc #1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'}$
%   \item $\lctx = \atmR{a} \oc \lctx_0$ and $\ireduces{#1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$
%   \end{itemize}
% \end{description}

% If $\simu{R}$ is a labeled bisimulation, then $\ctxc{\simu{R}}$ satisfies immediate output and reduction properties.
% \begin{description}
% \item[Immediate output]
%   Assume that $\octx \lrframe{\atmR{a}}{\ctxc{\simu{R}}}{} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%   Inductive hypothesis.
%   Lemma: $\octx \Reduces\reflc{\lrframe{\atmR{a}}{\ctxc{\simu{R}}}{}} \lctx$.
% \item[Reduction]
%   Assume that $\octx \lrframe{\atmR{a}}{\ctxc{\simu{R}}}{}\reduces \lctx'$.
%   By the inductive hypothesis, $\ctxc{\simu{R}}$ satisfies the reduction property.
%   So, the above lemma yields $\octx \Reduces\reflc{\lrframe{\atmR{a}}{\ctxc{\simu{R}}}{}} \lctx'$.
%   \begin{itemize}
%   \item $\octx \ctxc{\Reduces\simu{R}^*} \lctx'$
%   \end{itemize}
% \end{description}


% \section{}

The proof of soundness is clean, but it does wind through a few \lcnamecrefs{lem:labeled-bisim-union}.
The first of these describes a condition under which the union of two relations is a labeled bisimulation.
%
\begin{lemma}\label{lem:labeled-bisim-union}
  Let $\simu{S}$ be a labeled bisimulation.
  If $\simu{R}$ progresses to $\simu{R} \union \simu{S}$, then $\simu{R} \union \simu{S}$ is also a labeled bisimulation.
\end{lemma}
\begin{proof}
  When $\simu{S}$ is a labeled bisimulation and $\simu{R}$ progresses to $\simu{R} \union \simu{S}$, then the relation $\simu{R} \union \simu{S}$ progresses to itself, \ie, $\simu{R} \union \simu{S}$ is 
  % satisfies the conditions required of
  a labeled bisimulation.
  If $\octx \mathrel{(\simu{R} \union \simu{S})} \lctx$ because $\octx$ and $\lctx$ are $\simu{R}$-related, then the conditions for progressing to $\simu{R} \union \simu{S}$ are satisfied by $\simu{R}$ progressing to $\simu{R} \union \simu{S}$.
  If, on the other hand, $\octx \mathrel{(\simu{R} \union \simu{S})} \lctx$ because $\octx$ and $\lctx$ are $\simu{S}$-related, then the conditions for progressing to $\simu{R} \union \simu{S}$ are satisfied by the fact that $\simu{S}$ is a labeled bisimulation.
\end{proof}

Next, we use this result to prove that framing a single input atom onto a labeled bisimulation results in a binary relation that does not stray too far from a labeled bisimulation.
\begin{lemma}\label{lem:single-input-atom}
  If $\simu{R}$ is a labeled bisimulation, then so are $\lframe{\atmR{a}}{\simu{R}} \union \simu{R}$ and $\rframe{\simu{R}}{\atmL{a}} \union \simu{R}$, for all $\atmR{a}$ and $\atmL{a}$, respectively.
\end{lemma}
\begin{proof}
  Let $\simu{R}$ be a labeled bisimulation.
  We shall prove that $\lframe{\atmR{a}}{\simu{R}} \union \simu{R}$ is a labeled bisimulation; the proof for $\rframe{\simu{R}}{\atmL{a}} \union \simu{R}$ is symmetric.

  According to \cref{lem:labeled-bisim-union}, because $\simu{R}$ is a labeled bisimulation, it suffices to show that $\lframe{\atmR{a}}{\simu{R}}$ progresses to $\lframe{\atmR{a}}{\simu{R}} \union \simu{R}$.
  We prove each property in turn.
  \begin{description}
  \item[Immediate output bisimulation]
    Assume that $\octx \lframe{\atmR{a}}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$; we must show that $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{(\lframe{\atmR{a}}{\simu{R}} \union \simu{R})}{\atmR{\lctx}'_R} \lctx$.
    Because the input atom $\atmR{a}$ cannot be unified with the output atoms $\atmL{\lctx}'_L$, the context $\atmL{\lctx}'_L$ must be empty.
    We distinguish cases on the size of $\lctx'$.
    \begin{itemize}
    \item
      Consider the case in which $\lctx'$ is nonempty.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \lframe[\big]{\atmR{a}}{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R})} \lctx$.
      Reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\lframe{\atmR{a}}{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.%
      \begin{marginfigure}[-8\baselineskip]
        $
        \phantom{\octx = {}}
        \begin{tikzcd}[%
          /tikz/column 1/.append style={anchor=base east},
          /tikz/column 2/.append style={anchor=base east}
        ]
          \mathllap{\octx = {}} \atmR{a} \oc \octx_0
            \rar[relation, "\lframe{\atmR{a}}{\simu{R}}"]
            \dar[Reduces]
          &
          \atmR{a} \oc \lctx'_0 \oc \atmR{\lctx}'_R \mathrlap{{} = \lctx}
          \\
          \atmR{a} \oc \octx'_0
            \urar[relation, "\rframe{\lframe{\atmR{a}}{\simu{R}}}{\atmR{\lctx}'_R}" {sloped, below}]
          % \\
          % \octx_0
          %   \rar[relation, "\simu{R}"]
          %   \dar[Reduces]
          % &
          % \lctx'_0 \oc \atmR{\lctx}'_R
          % \\
          % \octx'_0
          %   \urar[relation, "\rframe{\simu{R}}{\atmR{\lctx}'_R}" {sloped, below}]
        \end{tikzcd}
        \phantom{{} = \lctx}
        $
      \end{marginfigure}%
    %
    \item
      Consider the case in which $\lctx'$ is empty -- that is, the case in which $\octx \lframe{\atmR{a}}{\simu{R}} \lctx = \atmR{\lctx}'_R = \atmR{a} \oc \atmR{\lctx}''_R$ for some $\atmR{\lctx}''_R$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \lframe{\atmR{a}}{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}''_R})} \atmR{\lctx}'_R$.
      Reduction is closed under framing, so $\octx \Reduces\rframe{\lframe{\atmR{a}}{\simu{R}}}{\atmR{\lctx}''_R} \atmR{\lctx}'_R$.
      After framing off $\atmR{\lctx}''_R$, we may subsequently appeal to the emptiness bisimulation property of $\simu{R}$ and deduce that $\octx \Reduces\rframe{(\Reduces\rframe{\simu{R}}{\atmR{a}})}{\atmR{\lctx}''_R} \atmR{\lctx}'_R$.
      Once again, reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R} \lctx$, as required.%
      \begin{marginfigure}[-11\baselineskip]
        $
        \phantom{\octx = {}}
        \begin{tikzcd}[%
          /tikz/column 1/.append style={anchor=base east},
          /tikz/column 2/.append style={anchor=base east}
        ]
          \mathllap{\octx = {}} \atmR{a} \oc \octx_0
            \rar[relation, "\lframe{\atmR{a}}{\simu{R}}"]
            \dar[Reduces]
          &
          \atmR{a} \oc \atmR{\lctx}''_R \mathrlap{{} = \atmR{\lctx}'_R = \lctx}
          \\
          \atmR{a} \oc \octx'_0
            \urar[relation, "\rframe{\lframe{\atmR{a}}{\simu{R}}}{\atmR{\lctx}''_R}" {sloped, below}]
            \dar[Reduces]
          \\
          \octx''_0 \oc \atmR{a}
            \arrow[relation, "\rframe{\rframe{\simu{R}}{\atmR{a}}}{\atmR{\lctx}''_R}" {sloped, below}, bend right]{uur}
        \end{tikzcd}
        \phantom{{} = \atmR{\lctx}'_R \oc \lctx}
        $
      \end{marginfigure}%
    \end{itemize}

  \item[Immediate input bisimulation]
    Assume that $\octx \lrframe{\atmR{a}}{\simu{R}}{} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$; we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\mathrel{(\lframe{\atmR{a}}{\simu{R}} \union \simu{R})} \lctx'$.
    According to \cref{lem:input-framing}, there are two cases: either $\atmR{a}$ satisfies an input demand, or it does not participate in the given input transition.
    \begin{itemize}
    \item
      Consider the case in which $\atmR{a}$ does participate in the input transition -- that is, the case in which $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{\atmR{\lctx}_L \oc \atmR{a} \oc #1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'}$, for some $\lctx_0$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property and deduce $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R} \lctx'$, as required.
      \begin{marginfigure}[-8\baselineskip]
        $
        \begin{tikzcd}
          \atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R
            \dar[phantom]{=}
          &[2em]
          \atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R
            \dar[phantom]{=}
          \\[-3ex]
          \atmR{\lctx}_L \oc \atmR{a} \oc \octx_0 \oc \atmL{\lctx}_R
            \rar[relation, "\lrframe{(\atmR{\lctx}_L \atmR{a})}{\simu{R}}{\atmL{\lctx}_R}"]
            \arrow[Reduces]{dd}
          &
          \atmR{\lctx}_L \oc \atmR{a} \oc \lctx_0 \oc \atmL{\lctx}_R
          \\[-4ex]
          &
          \atmR{\lctx}_L \oc \atmR{a} \oc [\lctx_0] \oc \atmL{\lctx}_R
            \dar[reduces]
          \\
          \octx\mathrlap{'}
            \rar[relation, "\simu{R}" {sloped, below}]
          &
          \lctx\mathrlap{'}
        \end{tikzcd}
        $
      \end{marginfigure}%
    %
    \item
      Consider the case in which $\atmR{a}$ does not participate in the input transition -- that is, the case in which $\atmR{\lctx}_L$ is empty and $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{#1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$ and $\lctx' = \atmR{a} \oc \lctx'_0$, for some $\lctx_0$ and $\lctx'_0$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \oc \atmL{\lctx}_R \lframe{\atmR{a}}{(\Reduces\simu{R})} \lctx'$.
      Reduction is closed under framing, so we conclude that $\octx \oc \atmL{\lctx}_R \Reduces\lframe{\atmR{a}}{\simu{R}} \lctx'$, as required.%
      \begin{marginfigure}
        $
        \phantom{\octx \oc \atmL{\lctx}_R = {}}
        \begin{tikzcd}
          \mathllap{\octx \oc \atmL{\lctx}_R = {}}
          \atmR{a} \oc \octx_0 \oc \atmL{\lctx}_R
            \rar[relation, "\lframe{\atmR{a}}{\rframe{\simu{R}}{\atmL{\lctx}_R}}"]
            \arrow[Reduces]{ddd}
          &[1em]
          \atmR{a} \oc \lctx_0 \oc \atmL{\lctx}_R
          \mathrlap{{} = \lctx \oc \atmL{\lctx}_R}
          \\[-4ex]
          &
          \hphantom{\atmR{a} \oc} [\lctx_0] \oc \atmL{\lctx}_R
            \dar[reduces]
          \\
          &
          \lctx\mathrlap{'_0}
          \\[-4ex]
          \atmR{a} \oc \octx'_0
            \rar[relation, "\lframe{\atmR{a}}{\simu{R}}" {sloped, below}, shorten >=0.7em]
          &
          \mathllap{\atmR{a} \oc {}} \lctx\mathrlap{'_0 = \lctx'}
        \end{tikzcd}
        \phantom{{} = \lctx \oc \atmL{\lctx}\vphantom{_R}}
        $
      \end{marginfigure}%
    \end{itemize}

  \item[Reduction bisimulation]
    Assume that $\octx \lframe{\atmR{a}}{\simu{R}}\reduces \lctx'$ holds; we must show that $\octx \Reduces\mathrel{(\lframe{\atmR{a}}{\simu{R}} \union \simu{R})} \lctx'$.
    We distinguish cases on the origin of the given reduction.
    \begin{itemize}
    \item
      Consider the case in which the reduction arises from the $\simu{R}$-related component alone -- that is, the case in which $\octx \lframe{\atmR{a}}{(\simu{R}\reduces)} \lctx'$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its reduction bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \lframe{\atmR{a}}{(\Reduces\simu{R})} \lctx'$.
      Reduction is closed under framing, so we conclude that $\octx \Reduces\lframe{\atmR{a}}{\simu{R}} \lctx'$, as required.%
      \begin{marginfigure}[-9\baselineskip]
        $
        \phantom{\octx = {}}
        \begin{tikzcd}
          \mathllap{\octx = {}}
          \atmR{a} \oc \octx_0
            \rar[relation, "\lframe{\atmR{a}}{\simu{R}}"]
            \dar[Reduces]
          &
          \atmR{a} \oc \lctx_0
            \dar[reduces]
          \\
          \atmR{a} \oc \octx'_0
            \rar[relation, "\lframe{\atmR{a}}{\simu{R}}" {sloped, below}]
          &
          \atmR{a} \oc \lctx'_0 \mathrlap{{} = \lctx'}
        \end{tikzcd}
        \phantom{{} = \lctx'}
        $
      \end{marginfigure}%
    \item
      Consider the case in which the reduction arises from an input transition on the $\simu{R}$-related component -- that is, the case in which $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{\atmR{a} \oc #1}{\lctx_0}{\lctx'}$, for some $\lctx_0$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property and deduce that $\octx \Reduces\simu{R} \lctx'$, as required.%
      \begin{marginfigure}[-8\baselineskip]
        $
        \phantom{\octx = {}}
        \begin{tikzcd}
          \mathllap{\octx = {}}
          \atmR{a} \oc \octx_0
            \rar[relation, "\lframe{\atmR{a}}{\simu{R}}"]
            \arrow[Reduces]{dd}
          &
          \atmR{a} \oc \lctx_0 \mathrlap{{} = \lctx}
          \\[-4ex]
          &
          \atmR{a} \oc [\lctx_0]
            \dar[reduces]
          \\
          \octx\mathrlap{'}
            \rar[relation, "\simu{R}" {sloped, below}]
          &
          \lctx\mathrlap{'}
        \end{tikzcd}
        \phantom{{} = \lctx}
        $
      \end{marginfigure}%
    \end{itemize}

  \item[Emptiness bisimulation]
    Assume that $\octx \lframe{\atmR{a}}{\simu{R}} (\octxe)$.
    This is, in fact, impossible because the empty context does not contain $\atmR{a}$.
  %
  \qedhere
  \end{description}
\end{proof}

Having proved the preceding \lcnamecref{lem:single-input-atom} about framing a single input atom, we can apply it inductively to prove that framing input contexts preserves labeled bisimulations. 
\begin{lemma}\label{lem:ctxc-labeled-bisim}
  If $\simu{R}$ is a labeled bisimulation, then so is $\ctxc{\simu{R}}$.
\end{lemma}
\begin{proof}
  Let $(\simu{S}_n)_{n \in \nats}$ be the indexed family of relations given by
  \begin{align*}
    \mathord{\simu{S}_0} &= \mathord{\simu{R}} \\
    \mathord{\simu{S}_{n+1}} &= \textstyle
                                  \parens[size=Big]{\bigunion_{\atmR{a}} \mathord{\lframe{\atmR{a}}{\simu{S}_n}}}
                                  \union \parens[size=Big]{\bigunion_{\atmL{a}} \mathord{\rframe{\simu{S}_n}{\atmL{a}}}}
                                  \union \mathord{S}_n
    \,.
  \end{align*}
  % We shall prove that $\mathord{\ctxc{\simu{R}}} = \bigunion_{n=0}^{\infty}{\mathord{\simu{S}_n}}$.
  %
  It is easy to prove by structural induction that each $\ctxc{\simu{R}}$-related pair of contexts is also $\simu{S}_n$-related for some natural number $n$; and so $\ctxc{\simu{R}}$ is contained within $\bigunion_{n=0}^{\infty}{\mathord{\simu{S}_n}}$.
  % 
  Conversely, using \cref{lem:single-input-atom}, it is equally easy to prove by induction on $n$ that each $\simu{S}_n$ is contained within $\ctxc{\simu{R}}$ and, moreover, that each $\simu{S}_n$ is a labeled bisimulation.

  Because each $\simu{S}_n$ is a labeled bisimulation, so is their least upper bound, namely $\bigunion_{n=0}^{\infty}{\mathord{\simu{S}_n}} = \mathord{\ctxc{\simu{R}}}$.
  %
  % For each $\ctxc{\simu{R}}$-related pair of contexts, $\octx$ and $\lctx$, there exists a least natural number $n$ for which those contexts are $\simu{S}_n$-related.
  % Specifically, if $\octx$ and $\lctx$ are $\ctxc{\simu{R}}$-related by virtue of $\octx \lrframe{\atmR{\lctx}_L}{\simu{R}}{\atmL{\lctx}_R} \lctx$, then $\card{\atmR{\lctx}_L} + \card{\atmL{\lctx}_R}$ is the least natural number $n$ for which $\octx$ and $\lctx$ are $\simu{S}_n$-related.
  %
  % Using \cref{lem:single-input-atom}, it is easy to prove by induction on $n$ that each $\simu{S}_n$ is contained within $\ctxc{\simu{R}}$ and, moreover, that each $\simu{S}_n$ is a labeled bisimulation.
  % Therefore, $\mathord{\ctxc{\simu{R}}} = \bigunion_{n=0}^{\infty}{\mathord{\simu{S}_n}}$.
  % Because each $\simu{S}_n$ is a labeled bisimulation, so is their least upper bound, $\ctxc{\simu{R}}$.
\end{proof}

Now we use this \lcnamecref{lem:ctxc-labeled-bisim}
% fact that $\ctxc{\simu{R}}$ is a labeled bisimulation whenever $\simu{R}$ is also one 
to prove that $\ctxc{\simu{R}}$ is a rewriting bisimulation if $\simu{R}$ is a labeled bisimulation.
\begin{theorem}\label{thm:labeled-proof-technique}
  If $\simu{R}$ is a labeled bisimulation, then rewriting bisimilarity contains $\simu{R}$.
\end{theorem}
\begin{proof}
  Let $\simu{R}$ be a labeled bisimulation.
  By \cref{lem:ctxc-labeled-bisim}, so is $\ctxc{\simu{R}}$.
  The relation $\ctxc{\simu{R}}$ is also a rewriting bisimulation, as we will show by proving each property in turn.
  (Notice, too, that $\ctxc{\simu{R}}$ is symmetric because $\simu{R}$ is.)
  \begin{description}[itemsep=\dimexpr\itemsep+\parsep\relax, parsep=0pt, listparindent=\parindent]
  \item[Output bisimulation]
    Assume that $\octx \ctxc{\simu{R}}\Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$; we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.

    As a labeled bisimulation, $\ctxc{\simu{R}}$ satisfies the reduction bisimulation property, so we deduce that $\octx \Reduces\ctxc{\simu{R}} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
    The relation $\ctxc{\simu{R}}$ also satisfies the immediate output bisimulation property, so we conclude that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{\atmR{\lctx}'_R} \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, as required.%
      \begin{marginfigure}[-9\baselineskip]
        $
        \begin{tikzcd}
          \octx
            \rar[relation, "\ctxc{\simu{R}}"]
            \dar[Reduces]
          &[0.8em]
          \lctx
            \dar[Reduces]
          \\
          \octx\mathrlap{'}
            \rar[relation, "\ctxc{\simu{R}}" {sloped}]
            \dar[Reduces]
          &
          \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R
          \\
          \octx\mathrlap{''}
            \urar[relation, "\lrframe{\atmL{\lctx}'_L}{\ctxc{\simu{R}}}{\atmR{\lctx}'_R}" {sloped, below}, shorten <=0.2em]
        \end{tikzcd}
        \phantom{{} = \lctx'}
        $
      \end{marginfigure}%
  %
  \item[Input bisimulation]
    Assume that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\ctxc{\simu{R}}}{\atmL{\lctx}_R}\Reduces \lctx'$; we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\ctxc{\simu{R}} \lctx'$.

    Because $\ctxc{\simu{R}}$ is input contextual, we deduce that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \ctxc{\simu{R}}\Reduces \lctx'$.
    As a labeled bisimulation, $\ctxc{\simu{R}}$ satisfies the reduction bisimulation property, so we conclude that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\ctxc{\simu{R}} \lctx'$, as required.%
    % Assume that $\octx \ctxc{\simu{R}} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$; we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\ctxc{\simu{R}} \lctx'$.
    % 
    % By \cref{??}, the given input transition gives rise to a reduction: $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \lrframe{\atmR{\lctx}_L}{\ctxc{\simu{R}}}{\atmL{\lctx}_R}\reduces \lctx'$.
    % Because $\ctxc{\simu{R}}$ is input contextual, we deduce that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \ctxc{\simu{R}}\reduces \lctx'$.
    % As a labeled bisimulation, $\ctxc{\simu{R}}$ satisfies the reduction bisimulation property, so we conclude that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\ctxc{\simu{R}} \lctx'$, as required.%
    \begin{marginfigure}[-7\baselineskip]
        $
        \begin{tikzcd}
          \atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R
            \rar[relation, "\lrframe{\atmR{\lctx}_L}{\ctxc{\simu{R}}}{\atmL{\lctx}_R}"]
            \rar[relation, "\ctxc{\simu{R}}" {sloped, below}, bend right=20]
            \dar[Reduces]
          &[1.75em]
          \atmR{\lctx}_L \oc \lctx \oc \atmL{\lctx}_R
            \dar[Reduces]
          \\[2ex]
          \octx\mathrlap{'}
            \rar[relation, "\ctxc{\simu{R}}" {sloped, below}]
          &
          \lctx\mathrlap{'}
        \end{tikzcd}
        $
      \end{marginfigure}%
  %
  \qedhere
  \end{description}
\end{proof}

Rewriting bisimilarity therefore contains every labeled bisimulation and, in particular, the largest labeled bisimulation, namely labeled bisimilarity.
\begin{corollary}
  Labeled bisimilarity is sound and complete with respect to rewriting bisimilarity.
\end{corollary}

\newthought{As a simple example} of this labeled bisimilarity proof technique for rewriting bisimilarity, we shall now establish that $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ and $\atmR{b}$ are rewriting-bisimilar contexts.
Let $\simu{R}$ be the least symmetric binary relation for which $\atmR{a} \oc (\atmR{a} \limp \atmR{b}) \simu{R} \atmR{b}$ and $\atmR{b} \simu{R} \atmR{b}$ and $(\octxe) \simu{R} (\octxe)$ hold.
The relation $\simu{R}$ is a labeled bisimulation:
\begin{itemize}
\item The immediate output bisimulation condition holds because $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ can simulate $\atmR{b}$'s output of $\atmR{b}$ (with $\atmR{a} \oc (\atmR{a} \limp \atmR{b}) \reduces\rframe{\simu{R}}{\atmR{b}} \atmR{b}$) and the former makes no immediate outputs of its own.
  Moreover, $\atmR{b}$ and $\atmR{b}$ can simulate each other's output of $\atmR{b}$.
\item The immediate input bisimulation condition holds vacuously for the relation $\simu{R}$ because neither $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ nor $\atmR{b}$ accept any inputs on either side.
\item The reduction bisimulation condition holds because $\atmR{b}$ can simulate the reduction $\atmR{a} \oc (\atmR{a} \limp \atmR{b}) \reduces \atmR{b}$ trivially (with $\atmR{b} \Reduces\simu{R} \atmR{b}$).
\item The emptiness bisimulation condition holds trivially: $\atmR{\lctx} \Reduces\rframe{\simu{R}}{\atmR{\lctx}} \atmR{\lctx}$ for all $\atmR{\lctx}$ because $(\octxe) \simu{R} (\octxe)$, and symmetrically for all $\atmL{\lctx}$.
\end{itemize}
We may conclude from the above proof technique~\parencref{thm:labeled-proof-technique} that $\simu{R}$ is contained within rewriting bisimilarity and that $\atmR{a} \oc (\atmR{a} \limp \atmR{b})$ and $\atmR{b}$ are indeed bisimilar.

We can similarly prove that $\atmR{a} \limp (\atmR{c} \pmir \atmL{b})$ and $(\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$ are rewriting-bisimilar by showing that the least symmetric relation $\simu{R}$ such that $\atmR{a} \limp (\atmR{c} \pmir \atmL{b}) \simu{R} (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$ and $\atmR{c} \simu{R} \atmR{c}$ and $(\octxe) \simu{R} (\octxe)$ is a labeled bisimulation.

Somewhat surprisingly, even $\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b})$ and $\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$ are bisimilar.
This one is rather surprising because the $\up \dn$ shift is placed in two different locations: over $\mathord{-} \pmir \atmL{b}$ in the former, and over $\atmR{a} \limp \mathord{-}$ in the latter.
One might expect that the placement of $\up \dn$ and the different intermediate contexts that it induces would make it possible to distinguish $\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b})$from $\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$.

But by using least symmetric relation $\simu{R}$ such that
$\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b}) \simu{R} \up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$ and
$\atmR{c} \pmir \atmL{b} \simu{R} \atmR{a} \oc \bigl(\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}\bigr)$ and
$\bigl(\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b})\bigr) \oc \atmL{b} \simu{R} \atmR{a} \limp \atmR{c}$ and
$\atmR{c} \simu{R} \atmR{c}$ and
$(\octxe) \simu{R} (\octxe)$,
we can prove that the two propositions are indistinguishable.
The labeled bisimulation $\simu{R}$ shows how the inputs protected by the $\up \dn$ double shifts are treated lazily in establishing the equivalence: the proposition $\atmR{c} \pmir \atmL{b}$ is $\simu{R}$-related to the context $\atmR{a} \oc \bigl(\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}\bigr)$, for example.



% $\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b}) \simu{R} \up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}$
% and
% $\atmR{c} \pmir \atmL{b} \simu{R} \atmR{a} \oc \bigl(\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}\bigr)$
% and
% $\bigl(\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b})\bigr) \oc \atmL{b} \simu{R} \atmR{a} \limp \atmR{c}$
% and
% $(\atmR{c} \pmir \atmL{b}) \oc \atmL{b} \simu{R} \atmR{c}$
% and
% $\atmR{a} \oc (\atmR{a} \limp \atmR{c}) \simu{R} \atmR{c}$
% and
% $\atmR{c} \simu{R} \atmR{c}$
% and
% $\octxe \simu{R} \octxe$.
% The relation is a labeled bisimulation because:
% \begin{itemize}
% \item Notice that $\ireduces{#1 \oc \atmL{b}}{\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}}{\atmR{a} \limp \atmR{c}}$.
%   And indeed $\bigl(\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b})\bigr) \oc \atmL{b} \Reduces\simu{R} \atmR{a} \limp \atmR{c}$.
%   Similarly, notice that $\ireduces{\atmR{a} \oc #1}{\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b})}{\atmR{c} \pmir \atmL{b}}$.
%   And indeed $\atmR{a} \oc \bigl(\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}\bigr) \Reduces\simu{R} \atmR{c} \pmir \atmL{b}$.
% \item Notice that $\ireduces{\atmR{a} \oc #1}{\atmR{a} \limp \atmR{c}}{\atmR{c}}$.
%   And indeed $\atmR{a} \oc \bigl(\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}\bigr) \oc \atmL{b} \Reduces\simu{R} \atmR{c}$.
%   Notice that $\ireduces{\atmR{a} \oc #1}{\bigl(\atmR{a} \limp \up \dn (\atmR{c} \pmir \atmL{b})\bigr) \oc \atmL{b}}{(\atmR{c} \pmir \atmL{b}) \oc \atmL{b}}$.
%   And indeed $\atmR{a} \oc \bigl(\up \dn (\atmR{a} \limp \atmR{c}) \pmir \atmL{b}\bigr) \oc \atmL{b} \Reduces\simu{R} (\atmR{c} \pmir \atmL{b}) \oc \atmL{b}$.
% \end{itemize}

% \clearpage
\subsection{A simple up-to proof technique: Reflexivity}

As a slight enhancement of the above proof technique, we can consider a simple up-to technique: bisimilarity up to reflexivity.
Let us call a relation $\simu{R}$ a labeled bisimulation \vocab{up to reflexivity} if $\simu{R}$ progresses to its reflexive closure, which we write as $\reflc{\simu{R}}$.
%
% \begin{lemma}\label{lem:identity-labeled-bisim}
%   The identity relation is a labeled bisimulation.
% \end{lemma}
% \begin{proof}
%
% \end{proof}
%
\begin{theorem}\label{thm:bisim-technique-up-to-refl}
  If $\simu{R}$ is a labeled bisimulation up to reflexivity, then rewriting bisimilarity contains $\simu{R}$.
\end{theorem}
\begin{proof}
  Let $\simu{R}$ be a labeled bisimulation up to reflexivity.
  First, notice that the identity relation is a labeled bisimulation -- each of the labeled bisimulation conditions is trivially true of the identity relation.
  Then, it follows from \cref{lem:labeled-bisim-union} that $\reflc{\simu{R}}$, the reflexive closure of $\simu{R}$, is a labeled bisimulation.
  By \cref{thm:labeled-proof-technique}, we may conclude that rewriting bisimilarity contains $\reflc{\simu{R}}$ and hence $\simu{R}$.
\end{proof}

% \begin{lemma}
%   If $\simu{R}$ is a labeled bisimulation up to reflexivity, then $\lframe{\atmR{a}}{\reflc{\simu{R}}} \union \reflc{\simu{R}}$ and $\rframe{\reflc{\simu{R}}}{\atmL{a}} \union \reflc{\simu{R}}$ are labeled bisimulations, for all $\atmR{a}$.
% \end{lemma}
% \begin{proof}
%   Let $\simu{R}$ be a labeled bisimulation up to reflexivity.
%   We shall prove that $\lframe{\atmR{a}}{\reflc{\simu{R}}} \union \reflc{\simu{R}}$ is a labeled bisimulation; the proof for $\rframe{\reflc{\simu{R}}}{\atmL{a}} \union \reflc{\simu{R}}$ is symmetric.

%   First, notice that $\mathord{\lframe{\atmR{a}}{\reflc{\simu{R}}}} \union \mathord{\reflc{\simu{R}}} = \mathord{\lframe{\atmR{a}}{\simu{R}}} \union \mathord{\reflc{\simu{R}}}$.
%   Because $\simu{R}$ is a labeled bisimulation up to reflexivity, $\reflc{\simu{R}}$ is a labeled bisimulation \parencref{??}.
%   According to \cref{??}, to show that $\lframe{\atmR{a}}{\reflc{\simu{R}}} \union \reflc{\simu{R}}$ is a labeled bisimulation, it therefore suffices to show that $\lframe{\atmR{a}}{\simu{R}}$ progresses to $\lframe{\atmR{a}}{\reflc{\simu{R}}} \union \reflc{\simu{R}}$.
%   We prove each property in turn.
%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\octx \lframe{\atmR{a}}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$; we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{(\lframe{\atmR{a}}{\reflc{\simu{R}}} \union \reflc{\simu{R}})}{\atmR{\lctx}'_R} \lctx$.
%     Because the input atom $\atmR{a}$ cannot be unified with the output atoms $\atmL{\lctx}'_L$, the context $\atmL{\lctx}'_L$ must be empty.
%     We distinguish cases on the size of $\lctx'$.
%     \begin{itemize}
%     \item
%       Consider the case in which $\lctx'$ is nonempty.
%       Because $\simu{R}$ is a labeled bisimulation up to reflexivity, we may appeal to its immediate output bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \lframe{\atmR{a}}{(\Reduces\rframe{\reflc{\simu{R}}}{\atmR{\lctx}'_R})} \lctx$.
%       Reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\lframe{\atmR{a}}{\reflc{\simu{R}}}}{\atmR{\lctx}'_R} \lctx$, as required.
%     %
%     \item
%       Consider the case in which $\lctx'$ is empty -- that is, the case in which $\octx \lframe{\atmR{a}}{\simu{R}} \lctx = \atmR{\lctx}'_R = \atmR{a} \oc \atmR{\lctx}''_R$ for some $\atmR{\lctx}''_R$.
%       Because $\simu{R}$ is a labeled bisimulation up to reflexivity, we may appeal to its immediate output bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \lframe{\atmR{a}}{(\Reduces\rframe{\reflc{\simu{R}}}{\atmR{\lctx}''_R})} \atmR{\lctx}'_R$.
%       Reduction is closed under framing, so $\octx \Reduces\rframe{\lframe{\atmR{a}}{\reflc{\simu{R}}}}{\atmR{\lctx}''_R} \atmR{\lctx}'_R$.
%       After framing off $\atmR{\lctx}''_R$, we may subsequently appeal to the emptiness bisimulation property of $\reflc{\simu{R}}$ and deduce that $\octx \Reduces\rframe{(\Reduces\rframe{\reflc{\simu{R}}}{\atmR{a}})}{\atmR{\lctx}''_R} \atmR{\lctx}'_R$.
%       Once again, reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.
%     \end{itemize}

%   \item[Immediate input bisimulation]
%     Assume that $\octx \lrframe{\atmR{a}}{\simu{R}}{} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$; we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\mathrel{(\lframe{\atmR{a}}{\reflc{\simu{R}}} \union \reflc{\simu{R}})} \lctx'$.
%     According to \cref{??}, there are two cases: either $\atmR{a}$ does not participate in the given input transition, or it is an input demand that is already present.
%     \begin{itemize}
%     \item
%       Consider the case in which $\atmR{a}$ does not participate in the transition -- that is, the case in which $\atmR{\lctx}_L$ is empty and $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{#1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$ and $\lctx' = \atmR{a} \oc \lctx'_0$, for some $\lctx_0$ and $\lctx'_0$.
%       Because $\simu{R}$ is a labeled bisimulation up to reflexivity, we may appeal to its immediate input bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \oc \atmL{\lctx}_R \lframe{\atmR{a}}{(\Reduces\reflc{\simu{R}})} \lctx'$.
%       Reduction is closed under framing, so we conclude that $\octx \oc \atmL{\lctx}_R \Reduces\lframe{\atmR{a}}{\reflc{\simu{R}}} \lctx'$, as required.
%     %
%     \item
%       Consider the case in which $\atmR{a}$ does participate in the input transition -- that is, the case in which $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{\atmR{\lctx}_L \oc \atmR{a} \oc #1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'}$, for some $\lctx_0$.
%       Because $\simu{R}$ is a labeled bisimulation up to reflexivity, we may appeal to its immediate input bisimulation property and deduce that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\reflc{\simu{R}} \lctx'$, as required.
%     \end{itemize}

%   \item[Reduction bisimulation]
%     Assume that $\octx \lframe{\atmR{a}}{\simu{R}}\reduces \lctx'$; we must show that $\octx \Reduces\mathrel{(\lframe{\atmR{a}}{\reflc{\simu{R}}} \union \reflc{\simu{R}})} \lctx'$.
%     We distinguish cases on the origin of the given reduction.
%     \begin{itemize}
%     \item
%       Consider the case in which the reduction arises from the $\simu{R}$-related component alone -- that is, the case in which $\octx \lframe{\atmR{a}}{(\simu{R}\reduces)} \lctx'$.
%       Because $\simu{R}$ is a labeled bisimulation up to reflexivity, we may appeal to its reduction bisimulation property after framing off $\atmR{a}$ and deduce that $\octx \lframe{\atmR{a}}{(\Reduces\reflc{\simu{R}})} \lctx'$.
%       Reduction is closed under framing, so we conclude that $\octx \Reduces\lframe{\atmR{a}}{\reflc{\simu{R}}} \lctx'$, as required.
%     \item
%       Consider the case in which the reduction arises from an input transition on the $\simu{R}$-related component -- that is, the case in which $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{\atmR{a} \oc #1}{\lctx_0}{\lctx'}$, for some $\lctx_0$.
%       Because $\simu{R}$ is a labeled bisimulation up to reflexivity, we may appeal to its immediate input bisimulation property and deduce that $\octx \Reduces\reflc{\simu{R}} \lctx'$, as required.
%     \end{itemize}

%   \item[Emptiness bisimulation]
%     Assume that $\octx \lframe{\atmR{a}}{\simu{R}} \octxe$.
%     This is, in fact, impossible because the empty context does not contain $\atmR{a}$.
%   %
%   \qedhere
%   \end{description}
% \end{proof}


% \begin{lemma}
%   If $\simu{R}$ is a labeled bisimulation up to reflexivity and context, then $\lframe{\atmR{a}}{\ctxc{\reflc{\simu{R}}}} \union \ctxc{\reflc{\simu{R}}}$ is a labeled bisimulation.
% \end{lemma}
% \begin{proof}
%   \begin{description}
%   \item[Output] Assume that $\octx \lframe{\atmR{a}}{\ctxc{\simu{R}}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
%     $\octx_0 \ctxc{\simu{R}} \lctx'_0 \oc \atmR{\lctx}'_R$.
%     \begin{itemize}
%     \item $\octx \lframe{\atmR{a}}{(\Reduces\rframe{\reflc{\simu{R}}}{\atmR{\lctx}'_R})} \lctx$.
%     \item $\octx \lframe{\atmR{a}}{(\Reduces\rframe{\reflc{\simu{R}}}{\atmR{\lctx}''_R})} \lctx$.
%       $\octx \Reduces\rframe{\lframe{\atmR{a}}{\reflc{\simu{R}}}}{\atmR{\lctx}''_R} \lctx$.
%     \end{itemize}
%     Assume that $\octx \simu{R} \lctx = ...$.
%     $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$.
%   \end{description}
% \end{proof}

% \begin{theorem}
%   If $\simu{R}$ is a labeled bisimulation up to reflexivity, then $\ctxc{\reflc{\simu{R}}}$ is a labeled bisimulation.
% \end{theorem}
% \begin{proof}
%   \begin{align*}
%     \mathord{\simu{S}_0} &= \mathord{\reflc{\simu{R}}} \\
%     \mathord{\simu{S}_{n+1}} &= \mathord{\reflc{\simu{S}_n}} \union \parens[size=Big]{\bigunion_{\atmR{a}} \lframe{\atmR{a}}{\reflc{\simu{S}_n}}} \union \parens[size=Big]{\bigunion_{\atmL{a}} \rframe{\reflc{\simu{S}_n}}{\atmL{a}}} 
%   \end{align*}
% \end{proof}



\subsection{Other properties of rewriting bisimilarity}

In addition to soundness and completeness of labeled bisimilarity with respect to rewriting bisimilarity, we also expect rewriting bisimilarity to be a (monoidal) congruence relation.

Rewriting bisimilarity is, indeed, an equivalence relation.
%
\begin{theorem}\label{thm:ordered-bisimilarity:equivalence}
  Rewriting bisimilarity is reflexive, symmetric, and transitive.
\end{theorem}
\begin{proof}
  The identity relation on contexts can be shown to be a bisimulation, so rewriting bisimilarity is reflexive.
  Rewriting bisimilarity is symmetric by definition.
  The relation $\osim\osim$ can be shown to be a bisimulation, so rewriting bisimilarity is also transitive.
\end{proof}


% \begin{equation*}
%   \begin{lgathered}
%     \congsimu*{\octxe}{\simu{R}} = \mathord{\simu{R}} \\
%     \congsimu*{\lctx_L \oc \atmR{a}}{\simu{R}} = \mathord{\simu{S}}(\lctx_L, \lframe{\atmR{a}}{\simu{R}} \union \simu{R}) \\
%     \mathord{\simu{S}}(\lctx_L \oc \atmL{a}, \simu{R}) = \mathord{\simu{S}}(\lctx_L, \lframe{\atmL{a}}{\simu{R}} \union \simu{R}) \\
%     \congsimu*{\lctx_L \oc \n{A}}{\simu{R}} = \congsimu*{\lctx_L}{\lframe{\n{A}}{\simu{R}} \union \bigcup_{\lctx'} \congsimu*{\lctx'}{\simu{R}}}
%   \end{lgathered}
% \end{equation*}
% Notice that $\congsimu*{\lctx_L}{\simu{R}}$ contains $\lframe{\lctx_L}{\simu{R}}$.

% \begin{theorem}
%   If $\simu{R}$ is a labeled bisimulation, then so is $\congsimu*{\lctx_L}{\simu{R}}$, for all contexts $\lctx_L$.
% \end{theorem}
% \begin{proof}
%   By structural induction on the context $\lctx_L$.

%   Assume that $\simu{R}$ is a labeled bisimulation;
%   we must show that so is $\congsimu*{\lctx_L}{\simu{R}}$.
%   \begin{itemize}[itemsep=\dimexpr\itemsep+\parsep\relax, parsep=0pt, listparindent=\parindent]
%   \item Consider the case in which $\lctx_L = (\octxe)$.
%     Because $\congsimu*{\octxe}{\simu{R}} = \mathord{\simu{R}}$, it is immediate that $\congsimu*{\octxe}{\simu{R}}$ is a labeled bisimulation.

%   \item Consider the case in which $\lctx_L = \lctx'_L \oc \atmR{a}$.
%     According to \cref{lem:single-input-atom}, $\lframe{\atmR{a}}{\simu{R}} \union \simu{R}$ is also a labeled bisimulation.
%     By the inductive hypothesis, we conclude that $\congsimu*{\lctx'_L}{\lframe{\atmR{a}}{\simu{R}} \union \simu{R}} = \congsimu*{\lctx'_L \oc \atmR{a}}{\simu{R}}$ is a labeled bisimulation.

%   \item Consider the case in which $\lctx_L = \lctx'_L \oc \atmL{a}$.
%     We will show that $\lframe{\atmL{a}}{\simu{R}} \union \simu{R}$ is a labeled bisimulation.
%     It will then follow from the inductive hypothesis that $\congsimu*{\lctx'_L}{\lframe{\atmL{a}}{\simu{R}} \union \simu{R}} = \congsimu*{\lctx'_L \oc \atmL{a}}{\simu{R}}$ is a labeled bisimulation.

%     To show that $\lframe{\atmL{a}}{\simu{R}} \union \simu{R}$ is a labeled bisimulation, it suffices, according to \cref{??}, to show that $\lframe{\atmL{a}}{\simu{R}}$ progresses to $\lframe{\atmL{a}}{\simu{R}} \union \simu{R}$.
%     \begin{description}
%     \item[Immediate output bisimulation]
%       Assume that $\octx \lframe{\atmL{a}}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
%       we must show that $\octx \Reduces\lrframe[\bigl]{\atmL{\lctx}'_L}{\mathrel{(\lframe{\atmL{a}}{\simu{R}} \union \simu{R})}}{\atmR{\lctx}'_R} \lctx$.
%       We distinguish cases on whether $\atmL{\lctx}'_L$ is empty.
%       \begin{itemize}
%       \item Consider the subcase in which $\atmL{\lctx}'_L$ is empty.
%         Because $\atmL{a}$ cannot be unified with the right-directed atoms $\atmR{\lctx}'_R$, it must be that $\lctx'$ is nonempty.
%         Because $\simu{R}$ is a labeled bisimulation, we can appeal to its immediate output bisimulation property after framing off $\atmL{a}$ and deduce that $\octx \lframe[\bigl]{\atmL{a}}{\mathrel{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R})}} \lctx$.
%         Reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\lframe{\atmL{a}}{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.

%       \item Consider the subcase in which $\atmL{\lctx}'_L$ is nonempty -- that is, $\atmL{\lctx}'_L = \atmL{a} \oc \atmL{\lctx}''_L$ for some $\atmL{\lctx}''_L$.
%         Because $\simu{R}$ is a labeled bisimulation, we can appeal to its immediate output bisimulation property after framing off $\atmL{a}$ and deduce that $\octx \lframe[\bigl]{\atmL{a}}{\mathrel{(\Reduces\lrframe{\atmL{\lctx}''_L}{\simu{R}}{\atmR{\lctx}'_R})}} \lctx$.
%         Reduction is closed under framing, so we conclude that $\octx \Reduces\lrframe[\bigl]{(\atmL{a} \oc \atmL{\lctx}''_L)}{\simu{R}}{\atmR{\lctx}'_R} \lctx$, as required.
%       \end{itemize}
%     \end{description}

%   \item Consider the case in which $\lctx_L = \lctx'_L \oc \n{A}$.
%     In this case, $\congsimu*{\lctx_L}{\simu{R}} = \mathord{\lframe{\n{A}}{\simu{R}} \union \simu{X}}$.
%     \begin{description}
%     \item[Reduction bisimulation]
%       Assume that $\octx \lframe{\n{A}}{\simu{R}} \lctx \reduces \lctx'$;
%       we must show that $\octx \Reduces\mathrel{(\lframe{\n{A}}{\simu{R}} \union \simu{X})} \lctx'$.
%       \begin{itemize}
%       \item Consider the case in which the given reduction arises from an input transition on $\n{A}$ -- that is, $\lctx = \n{A} \oc \atmL{\lctx}_R \oc \lctx_0$ and $\ireduces{#1 \oc \atmL{\lctx}_R}{\n{A}}{\lctx'_A}$ and $\lctx'_A \oc \lctx_0 = \lctx'$, for some $\atmL{\lctx}_R$, $\lctx_0$, and $\lctx'_A$.
%         Because $\simu{R}$ is a labeled bisimulation, we can appeal to its immediate output bisimulation property and deduce that $\octx \Reduces\lframe{(\n{A} \oc \atmL{\lctx}_R)}{\simu{R}} \lctx$.
%         After carrying out the reduction involving $\n{A}$, we have $\octx \Reduces\reduces\lframe{\lctx'_A}{\simu{R}} \lctx'$.
%         Because $\congsimu*{\lctx'_A}{\simu{R}}$ contains $\lframe{\lctx'_A}{\simu{R}}$, it follows that $\octx \Reduces\congsimu{\lctx'_A}{\simu{R}} \lctx'$.

%         I would like to say that $\congsimu*{\lctx'_A}{\simu{R}}$ is a labeled bisimulation.
%         But I don't see how to use the inductive hypothesis -- $\lctx'_A$ doesn't seem to be smaller than $\lctx_L$.
%       \end{itemize}
%     \end{description}
%   \end{itemize}
% \end{proof}


At this point, we would like to prove, as a \lcnamecref{lem:ordered-bisimilarity:append-left}, that $\lframe{\lctx_L}{\simu{R}}$ is contained in some labeled bisimulation, for all contexts $\lctx_L$ and all labeled bisimulations $\simu{R}$.
Ideally, the proof that proceeds by induction (or possibly coinduction), decomposing the context $\lctx_L$ and framing each antecedent of $\lctx_L$ onto the relation, one at a time.
This would allow \cref{lem:single-input-atom} to be reused, and would also streamline other cases.

Unfortunately, such a proof has been elusive so far.
So, instead, we will prove the following \lcnamecref{lem:ordered-bisimilarity:append-left} by handling the context $\lctx_L$ all at once.
The proof rehashes cases from \cref{lem:single-input-atom} and is not particularly enlightening beyond what was already presented there.
For that reason, the majority of the following \lcnamecref{lem:ordered-bisimilarity:append-left}'s proof is postponed to \cref{app:bisim}.
%
\begin{lemma}\label{lem:ordered-bisimilarity:append-left}
  If $\simu{R}$ is a labeled bisimulation, then, for each context $\lctx_L$, there exists a labeled bisimulation that contains $\lframe{\lctx_L}{\simu{R}}$.
\end{lemma}
\begin{proof}
  Let $\mathord{\simu{S}}$ be the relation such that $\octx \simu{S} \lctx$ if, and only if, there exists a context $\lctx_L$ such that $\octx \lframe{\lctx_L}{\simu{R}} \lctx$.
  We will show that $\simu{S}$ is a labeled bisimulation.
  \begin{description}
  \item[Immediate output bisimulation]
    Assume that $\octx \lframe{\lctx_L}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
    we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{S}}{\atmR{\lctx}'_R} \lctx$.
    We distinguish three cases according to where the right edge of $\lctx_L$ occurs in $\lctx$.
    \begin{itemize}
    \item Consider the case in which the right edge of $\lctx_L$ occurs in either $\atmL{\lctx}'_L$ or $\lctx'$ -- that is, the case in which $\atmL{\lctx}'_L = \lctx_L \oc \atmL{\lctx}''_L$ for some $\atmL{\lctx}''_L$.
      Because $\simu{R}$ is a labeled bisimulation, we can appeal to its immediate output bisimulation property after framing off $\lctx_L$ and deduce that $\octx \lframe[\big]{\lctx_L}{\mathrel{(\Reduces\lrframe{\atmL{\lctx}''_L}{\simu{R}}{\atmR{\lctx}'_R})}} \lctx$.
      Reduction is closed under framing, so we may conclude that $\octx \Reduces\lrframe[\big]{(\lctx_L \atmL{\lctx}''_L)}{\simu{R}}{\atmR{\lctx}'_R} \lctx$, as required.

    \item Consider the case in which the right edge of $\lctx_L$ occurs in $\lctx'$ -- that is, the case in which $\lctx' = \lctx'_1 \oc \lctx'_2$ for some $\lctx'_1$ and $\lctx'_2$ such that $\lctx_L = \atmL{\lctx}'_L \oc \lctx'_1$.
      Because $\simu{R}$ is a labeled bisimulation, we can appeal to its immediate output bisimulation property after framing off $\lctx_L$ and deduce that $\octx \lframe[\big]{\lctx_L}{\mathrel{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R})}} \lctx$.
      Reduction is closed under framing, so $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{\lframe{\lctx'_1}{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.

    \item Consider the case in which the right edge of $\lctx_L$ occurs in $\atmR{\lctx}'_R$ -- that is, the case in which $\atmR{\lctx}'_R = \atmR{\lctx}'_{R1} \oc \atmR{\lctx}'_{R2}$ for some $\atmR{\lctx}'_{R1}$ and $\atmR{\lctx}'_{R2}$ such that $\lctx_L = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_{R1}$.
      Because $\simu{R}$ is a labeled bisimulation, we can appeal to its immediate output bisimulation properties after framing off $\lctx_L$ and deduce that $\octx \lframe[\big]{\lctx_L}{\mathrel{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_{R2}})}} \lctx$.
      Reduction is closed under framing, so $\octx \Reduces\lrframe{\lctx_L}{\simu{R}}{\atmR{\lctx}'_{R2}} \lctx = \lctx_L \oc \atmR{\lctx}'_{R2}$.
      We can also appeal to $\simu{R}$'s emptiness bisimulation property after framing off $(\atmL{\lctx}'_L \oc \lctx')$ and $\atmR{\lctx}'_{R2}$ and deduce that $\octx \Reduces\lrframe[\big]{(\atmL{\lctx}'_L \lctx')}{\mathrel{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_{R1}})}}{\atmR{\lctx}'_{R2}} \lctx$.
      Once again, reduction is closed under framing, so we conclude that $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{\lframe{\lctx'}{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.
    \end{itemize}

  \item[Immediate input bisimulation]
    Assume that $\octx \lframe{\lctx_L}{\simu{R}} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$;
    we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{S} \lctx'$.

    According to 
    \begin{itemize}
    \item 
      Consider the case in which $\lctx_L$ only consists of (possibly zero) right-directed messages.
      In this case, an input transition $\ireduces{\atmR{\lctx}_L \oc \lctx_L \oc #1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'}$ exists, for some $\lctx_0$ such that $\octx \lframe{\lctx_L}{\simu{R}} \lctx_L \oc \lctx_0 = \lctx$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property to deduce that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R} \lctx'$, as required.

    \item
      Consider the case in which some part of $\lctx_L$ does not participate in the input transition -- that is, the case in which $\lctx_L = \lctx'_L \oc \atmR{\lctx}'_L$ and $\atmR{\lctx}_L$ is empty and $\ireduces{\atmR{\lctx}'_L \oc #1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$ and $\lctx'_L \oc \lctx'_0 = \lctx'$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property after framing off $\lctx'_L$ and deduce that $\octx \oc \atmL{\lctx}_R \lframe{\lctx'_L}{\mathrel{(\Reduces\simu{R})}} \lctx'$.
      Reduction is closed under framing, so we conclude that $\octx \oc \atmL{\lctx}_R \Reduces\lframe{\lctx'_L}{\simu{R}} \lctx'$, as required.
    \end{itemize}

  \item[Reduction bisimulation]
    Assume that $\octx \lframe{\lctx_L}{\simu{R}} \lctx \reduces \lctx'$;
    we must show that $\octx \Reduces\simu{S} \lctx'$.
    We distinguish cases on the origin of the given reduction.
    \begin{itemize}
    \item
      Consider the case in which the reduction arises from the $\simu{R}$-related component alone -- that is, the case in which $\octx \lframe[\big]{\lctx_L}{\mathrel{(\simu{R}\reduces)}} \lctx'$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its reduction bisimulation property after framing off $\lctx_L$ and deduce that $\octx \lframe[\big]{\lctx_L}{\mathrel{(\Reduces\simu{R})}} \lctx'$.
      Reduction is closed under framing, so we may conclude that $\octx \Reduces\lframe{\lctx_L}{\simu{R}} \lctx'$, as required.

    \item
      Consider the case in which the reduction arises from an input transition on the $\simu{R}$-related component -- that is, the case in which $\lctx_L = \lctx'_L \oc \atmR{\lctx}_L$ and $\ireduces{\atmR{\lctx}_L \oc #1}{\lctx}{\lctx'_0}$ and $\lctx'_L \oc \lctx'_0 = \lctx'$ for some contexts $\lctx'_L$, $\atmR{\lctx}_L$, and $\lctx'_0$.
      Because $\simu{R}$ is a labeled bisimulation, we may appeal to its reduction bisimulation property after framing off $\lctx'_L$ and deduce that $\octx \lframe[\big]{\lctx'_L}{\mathrel{(\Reduces\simu{R})}} \lctx'$.
      Reduction is closed under framing, so we may conclude that $\octx \Reduces\lframe{\lctx'_L}{\simu{R}} \lctx'$, as required.
    \end{itemize}

  \item[Emptiness bisimulation]
    Assume that $\octx \lframe{\lctx_L}{\simu{R}} (\octxe)$;
    we must show that:
    $\atmR{\lctx} \oc \octx \Reduces\rframe{\simu{S}}{\atmR{\lctx}} \atmR{\lctx}$ for all $\atmR{\lctx}$; and $\octx \oc \atmL{\lctx} \lframe{\atmL{\lctx}}{\simu{S}} \atmL{\lctx}$ for all $\atmL{\lctx}$.

    It can only be that $\lctx_L$ is empty, and so $\octx \simu{R} (\octxe)$.
    Because $\simu{R}$ is a labeled bisimulation, it follows that: $\atmR{\lctx} \oc \octx \Reduces\rframe{\simu{R}}{\atmR{\lctx}} \atmR{\lctx}$ for all $\atmR{\lctx}$; and $\octx \oc \atmL{\lctx} \lframe{\atmL{\lctx}}{\simu{R}} \atmL{\lctx}$ for all $\atmL{\lctx}$.
  %
  \qedhere
  \end{description}
\end{proof}



% \begin{theorem} 
  
% \end{theorem}
% \begin{proof}
%   \begin{equation*}
%     \mathord{\simu{R}} = \Set{ (\lctx_L \oc \octx, \lctx_L \oc \lctx) \given \octx \osim \lctx }
%   \end{equation*}
%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\lctx_L \oc \octx \simu{R} \lctx_L \oc \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
%     we must show that $\lctx_L \oc \octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \lctx_L \oc \lctx$.
    
%   \end{description}
% \end{proof}

% \begin{theorem}
%   \begin{itemize}
%   \item If $\simu{R}$ is a labeled bisimulation, then, for each context $\lctx_L$, there exists a labeled bisimulation that contains $\lframe{\lctx_L}{\simu{R}}$.
%   \item If $\simu{R}$ is a labeled bisimulation, then for each $\oante$ there exists a labeled bisimulation that contains $\lframe{\oante}{\simu{R}}$.
%   \end{itemize}
% \end{theorem}
% \begin{proof}
%   If $\lctx$ is empty, we are done.
%   Otherwise, $\lctx$ ends with some $\oante$.
%   \begin{itemize}
%   \item If $\oante$ is $\atmR{a}$, then $\lframe{\atmR{a}}{\simu{R}} \union \simu{R}$ is a labeled bisimulation.
%     By the inductive hypothesis, there exists a labeled bisimulation that contains $\lframe{\lctx}{\simu{R}} \union \lframe{\lctx_0}{\simu{R}}$.
%   \item If $\oante$ is $\atmL{a}$, then $\lframe{\atmL{a}}{\simu{R}}$
%   \end{itemize}

%   Let $\simu{S}$ be the relation 
%   \begin{equation*}
%     \mathord{\simu{S}}(\oante) =
%       \begin{cases*}
%         \lframe{\atmR{a}}{\simu{R}} \union \simu{R} & if $\oante = \atmR{a}$ \\
%         \lframe{\atmL{a}}{\simu{R}} \union \simu{R} & if $\oante = \atmL{a}$ \\
%         \lframe{\n{A}}{\simu{R}} \union \simu{R} & if $\oante = \n{A}$
%       \end{cases*}
%   \end{equation*}
% \end{proof}

% $\osim$ is a labeled bisimulation.
% So are $\lframe{\atmR{a}}{\osim} \union \osim$ and $\rframe{\osim}{\atmL{a}} \union \osim$.
% So $\osim$ contains them.
% In particular, $\osim$ contains $\lframe{\atmR{a}}{\osim}$ and symmetrically.

% It suffices to show that $\lframe{\n{A}}{\osim} \union \osim$ and $\rframe{\osim}{\n{A}} \union \osim$.

% $\octx \lframe{\n{A}}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$


% \begin{theorem}
%   \begin{itemize}
%   \item If $\simu{R}$ is a labeled bisimulation, then so are $\lframe{\oante}{\simu{R}} \union \simu{R}$ and $\rframe{\simu{R}}{\oante} \union \simu{R}$, for all $\oante$.
%   \item If $\simu{R}$ is a labeled bisimulation, then so are $\lframe{\lctx_L}{\simu{R}} \union \simu{R}$ and $\rframe{\simu{R}}{\lctx_R} \union \simu{R}$, for all $\lctx_L$ and $\lctx_R$, respectively.
%   \end{itemize}
% \end{theorem}
% \begin{proof}
%   $\lctx = \oante_1 \oc \oante_2 \dotsm \oante_n$
%   and $\lctx_0^n = (\octxe)$ and $\lctx_{i+1}^n = \oante_{n-i} \lctx_i$
%   and $\lctx = \lctx_n^n$.

%   If $\simu{R}$ is a labeled bisimulation, then so is $\bigcup_{i=0}^n \lframe{\lctx_i^n}{\simu{R}}$.

%   By the inductive hypothesis, $\bigcup_{i=0}^n \lframe{\lctx_i}{\simu{R}}$ is a labeled bisimulation.

  
%   $\bigcup_{i=2}^n \lframe{\lctx_i}{\simu{R}}$ is a labeled bisimulation.
  

%   $\lctx_L = \oante \oc \lctx'_L$.
%   By the inductive hypothesis, $\lframe{\lctx'_L}{\simu{R}} \union \simu{R}$ is a labeled bisimulation.
%   $\mathord{\lframe{\lctx_L}{\simu{R}}} \union \mathord{\lframe{\oante}{\simu{R}}} \union \mathord{\simu{R}}$ is a labeled bisimulation.
  

%   Let $\simu{R}$ be a labeled bisimulation.
%   We shall prove that $\lframe{\n{A}}{\simu{R}} \union \simu{R}$ is a labeled bisimulation;
%   the proof for $\rframe{\simu{R}}{\n{A}} \union \simu{R}$ is symmetric.

%   If $\oante = $

%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\octx \lframe{\oante}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
%     we must show that $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{\mathrel{(\lframe{\oante}{\simu{R}} \union \simu{R})}}{\atmR{\lctx}'_R} \lctx$.
%     \begin{itemize}
%     \item Consider the case in which $\oante$ is a negative proposition -- \ie, $\oante = \n{A}$, for some $\n{A}$.
%       Because the proposition $\n{A}$ cannot be unified with the output atoms $\atmL{\lctx}'_L$, the context $\atmL{\lctx}'_L$ must be empty.
%       Moreover, because $\n{A}$ cannot be unified with the output atoms $\atmR{\lctx}'_R$, the context $\lctx'$ must be \emph{non}empty -- that is, the proposition $\n{A}$ must occur at the left edge of $\lctx'$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\n{A}$ and deduce that $\octx \lframe{\n{A}}{\mathrel{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R})}} \lctx$.
%       Reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\lframe{\n{A}}{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.

%     \item Consider the case in which $\oante$ is a left-directed atom -- \ie, $\oante = \atmL{a}$ for some $\atmL{a}$.
%       Unlike negative propositions, the atom $\atmL{a}$ can be unified with the output atoms $\atmL{\lctx}_L$.
%       By the same reasoning as 
%     \end{itemize}

%   \item[Immediate input bisimulation]
%     Assume that $\octx \lframe{\oante}{\simu{R}} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$;
%     we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\mathrel{(\lframe{\oante}{\simu{R}} \union \simu{R})} \lctx'$.

%     According to \cref{??}, $\oante$ cannot participate in the given input transition.
%     That is, $\atmR{\lctx}_L$ is empty and $\octx \lframe{\oante}{\simu{R}} \oante \oc \lctx_0 = \lctx$ and $\ireduces{#1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$ and $\lctx' = \oante \oc \lctx'_0$, for some contexts $\lctx_0$ and $\lctx'_0$.
%     Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property after framing off $\oante$ and deduce that $\octx \oc \atmL{\lctx}_R \lframe{\oante}{\mathrel{(\Reduces\simu{R})}} \lctx'$.
%     Reduction is closed under framing, so we conclude that $\octx \oc \atmL{\lctx}_R \Reduces\lframe{\oante}{\simu{R}} \lctx'$, as required.

%   \item[Reduction bisimulation]
%     Assume that $\octx \lframe{\oante}{\simu{R}}\reduces \lctx'$ holds;
%     we must show that $\octx \Reduces\mathrel{(\lframe{\oante}{\simu{R}} \union \simu{R})} \lctx'$.
%     We distinguish cases on the origin of the given reduction.
%     \begin{itemize}
%     \item Consider the case in which the reduction arises from the $\simu{R}$-related component alone -- that is, the case in which $\octx \lframe{\oante}{\mathrel{(\simu{R}\reduces)}} \lctx'$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its reduction bisimulation property after framing off $\oante$ and deduce that $\octx \lframe{\oante}{\mathrel{(\Reduces\simu{R})}} \lctx'$.
%       Reduction is closed under framing, so we conclude that $\octx \Reduces\lframe{\oante}{\simu{R}} \lctx'$, as required.

%     \item Consider the case in which the reduction arises from an input transition on the $\simu{R}$-related conponent -- $\octx \lframe{\oante}{\simu{R}} \oante \oc \lctx_0$

%     \item Consider the case in which $\oante = \n{A}$ for some negative proposition $\n{A}$ and the reduction arises from $\n{A}$ -- that is, the case in which $\octx \lframe{\n{A}}{\simu{R}} \n{A} \oc \atmL{\lctx}_L \oc \lctx_0 = \lctx$ and $\ireduces{#1 \oc \atmL{\lctx}_L}{\n{A}}{\lctx'_L}$ and $\lctx'_L \oc \lctx_0 = \lctx'$, for some contexts $\atmL{\lctx}_L$ and $\lctx'_L$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\n{A}$ and deduce that $\octx \lframe{\n{A}}{\mathrel{(\Reduces\lframe{\atmL{\lctx}_L}{\simu{R}})}} \lctx$.

%       $\octx_0 \Reduces\lframe{\atmL{\lctx}_L}{\simu{R}} \atmL{\lctx}_L \oc \lctx_0$.
%       $\n{A} \oc \octx_0 \Reduces\reduces \lctx'_L \oc \octx'_0 \lframe{\lctx'_L}{\simu{R}} \lctx'$

%       Reduction is closed under framing, so $\octx \Reduces\lframe{(\n{A} \oc \atmL{\lctx}_L)}{\simu{R}} \lctx$.
%       Owing to the input transition on $\n{A}$, we can $\octx \Reduces\reduces\lframe{\lctx'_L}{\simu{R}} \lctx'$.

%     \item Consider the case in which $\octx = \n{A} \oc \octx_R \lframe{\n{A}}{\simu{R}} \n{A} \oc (\atmL{\lctx}_L \oc \lctx_0) = \lctx$ and $\ireduces{#1 \oc \atmL{\lctx}_L}{\n{A}}{\lctx'_L}$.
%       We must show that $\octx \Reduces\mathrel{(\lframe{\n{A}}{\simu{R}} \union \simu{R})} \lctx'_L \oc \lctx_0 = \lctx'$.

%       By output bisimulation, $\octx_R \Reduces\lframe{\atmL{\lctx}_L}{\simu{R}} \atmL{\lctx}_L \oc \lctx_0$.
%       Framing $\n{A}$ on, $\n{A} \oc \octx_R \Reduces\lframe{(\n{A} \oc \atmL{\lctx}_L)}{\simu{R}} \n{A} \oc \atmL{\lctx}_L \oc \lctx_0$.
%       We can append a reduction: $\n{A} \oc \octx_R \Reduces\lframe{(\n{A} \oc \atmL{\lctx}_L)}{\simu{R}} \n{A} \oc \atmL{\lctx}_L \oc \lctx_0 \reduces \lctx'_L \oc \lctx_0$.
%       Therefore, $\n{A} \oc \octx_R \Reduces\lframe{\lctx'_L}{\simu{R}} \lctx'_L \oc \lctx_0 = \lctx'$.

%     \item The case in which $\oante = \atmL{a}$ for some left-directed atom $\atmL{a}$ and the reduction arises from $\oante$ is 
%     \end{itemize}


%   \item[Emptiness bisimulation]
%     Assume that $\octx \lframe{\oante}{\simu{R}} (\octxe)$.
%     This is, in fact, impossible because the empty context does not contain $\oante$.
%   \end{description}


%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\octx \lframe{\n{A}}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
%     we must show that $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{\mathrel{(\lframe{\n{A}}{\simu{R}} \union \simu{R})}}{\atmR{\lctx}'_R} \lctx$.

%     Because the proposition $\n{A}$ cannot be unified with the output atoms $\atmL{\lctx}'_L$, the context $\atmL{\lctx}'_L$ must be empty.
%     Moreover, because $\n{A}$ cannot be unified with the output atoms $\atmR{\lctx}'_R$, the context $\lctx'$ must be \emph{non}empty -- that is, the proposition $\n{A}$ must occur at the left edge of $\lctx'$.
%     Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\n{A}$ and deduce that $\octx \lframe{\n{A}}{\mathrel{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R})}} \lctx$.
%     Reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\lframe{\n{A}}{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.

%   \item[Immediate input bisimulation]
%     Assume that $\octx \lframe{\n{A}}{\simu{R}} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$;
%     we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\mathrel{(\lframe{\n{A}}{\simu{R}} \union \simu{R})} \lctx'$.

%     According to \cref{??}, $\n{A}$ does not participate in the given input transition.
%     That is, $\atmR{\lctx}_L$ is empty and $\octx \lframe{\n{A}}{\simu{R}} \n{A} \oc \lctx_0 = \lctx$ and $\ireduces{#1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$ and $\lctx' = \n{A} \oc \lctx'_0$, for some contexts $\lctx_0$ and $\lctx'_0$.
%     Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property after framing off $\n{A}$ and deduce that $\octx \oc \atmL{\lctx}_R \lframe{\n{A}}{\mathrel{(\Reduces\simu{R})}} \lctx'$.
%     Reduction is closed under framing, so we conclude that $\octx \oc \atmL{\lctx}_R \Reduces\lframe{\n{A}}{\simu{R}} \lctx'$, as required.

%   \item[Reduction bisimulation]
%     Assume that $\octx \lframe{\n{A}}{\simu{R}}\reduces \lctx'$ holds;
%     we must show that $\octx \Reduces\mathrel{(\lframe{\n{A}}{\simu{R}} \union \simu{R})} \lctx'$.

%   \item[Emptiness bisimulation]
%     Assume that $\octx \lframe{\n{A}}{\simu{R}} (\octxe)$.
%     This is, in fact, impossible because the empty context does not contain $\n{A}$.
%   \end{description}
% \end{proof}

\begin{theorem}
  If $\octx_1 \osim \lctx_1$ and $\octx_2 \osim \lctx_2$, then $\octx_1 \oc \octx_2 \osim \lctx_1 \oc \lctx_2$.
\end{theorem}
\begin{proof}
  Assume that $\octx_1 \osim \lctx_1$ and $\octx_2 \osim \lctx_2$.
  Notice that $\octx_1 \oc \octx_2 \lframe{\octx_1}{\osim} \octx_1 \oc \lctx_2 \rframe{\osim}{\lctx_2} \lctx_1 \oc \lctx_2$.

  Rewriting bisimilarity is a labeled bisimulation~\parencref{thm:ordered-bisimilarity:labeled-complete}.
  By \cref{lem:ordered-bisimilarity:append-left}, there exists a labeled bisimulation that contains $\lframe{\octx_1}{\osim}$.
  According to \cref{thm:labeled-proof-technique}, rewriting bisimilarity therefore contains $\lframe{\octx_1}{\osim}$.
  By symmetric reasoning, rewriting bisimilarity must also contain $\rframe{\osim}{\lctx_2}$.

  Applying these to the previous observation, $\octx_1 \oc \octx_2 \osim \octx_1 \oc \lctx_2 \osim \lctx_1 \oc \lctx_2$.
  Because rewriting bisimilarity is transitive~\parencref{thm:ordered-bisimilarity:equivalence}, we conclude that $\octx_1 \oc \octx_2 \osim \lctx_1 \oc \lctx_2$.
\end{proof}

\begin{corollary}
  Rewriting bisimilarity is a congruence.
\end{corollary}

% \begin{lemma}
%   Rewriting bisimilarity contains $\lframe{\p{A}}{\osim}$ and $\rframe{\osim}{\p{A}}$, for all propositions $\p{A}$.
% \end{lemma}
% \begin{proof}
%   By induction over the structure of $\p{A}$.
%   We show only the proof for $\lframe{\p{A}}{\osim}$; the proof for $\rframe{\osim}{\p{A}}$ is symmetric.

%   According to \cref{??}, it suffices to show that $\lframe{\p{A}}{\osim} \union \osim$ is a labeled bisimulation.
%   By \cref{??}, we need only show that $\lframe{\p{A}}{\osim}$ progresses to $\lframe{\p{A}}{\osim} \union \osim$.
%   Many of the cases follow the pattern laid out in the proof of \cref{??}, substituting $\p{A}$ for $\atmR{a}$; we show only the new cases.
%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\octx \lframe{\p{A}}{\osim} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
%     we must show that $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{(\lframe{\p{A}}{\osim} \union \osim)}{\atmR{\lctx}'_R} \lctx$.

%     Unlike in the proof of \cref{??}, here it is possible that $\p{A} = \atmL{a}$ with $\atmL{\lctx}'_L$ nonempty: $\atmL{\lctx}'_L = \atmL{a} \oc \atmL{\lctx}''_L$, for some $\atmL{\lctx}''_L$.
%     Because $\osim$ is a labeled bisimulation~\parencref{??}, we may appeal to its immediate output bisimulation property after framing $\atmL{a}$ and deduce that $\octx \lframe[\big]{\atmL{a}}{(\Reduces\lrframe{\atmL{\lctx}''_L}{\osim}{\atmR{\lctx}'_R})} \lctx$.
%     Reduction is closed under framing, so $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\osim}{\atmR{\lctx}'_R} \lctx$, as required.

%     The other cases follow the pattern laid out in the proof of \cref{??}.

%   \item[Immediate input bisimulation]
%     Assume that $\octx \lframe{\p{A}}{\osim} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$;
%     we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\mathrel{\bigl(\lframe{\p{A}}{\osim} \union \osim\bigr)} \lctx'$.

%     All cases here follow the pattern laid out in the proof of \cref{??}.
    
%   \item[Reduction bisimulation]
%     Assume that $\octx \lframe{\p{A}}{\osim}\reduces \lctx'$;
%     we must show that $\octx \Reduces\mathrel{(\lframe{\p{A}}{\osim} \union \osim)} \lctx'$.

%     As in the proof of \cref{??}, we distinguish cases based on the origin of the reduction.
%     Here, there are three new cases because the reduction might originate from $\p{A}$; the other cases follow the pattern laid out in the proof of \cref{??}.
%     \begin{itemize}
%     \item
%       Consider the case in which $\p{A} = \p{A}_1 \fuse \p{A}_2$ and $\octx \lframe{\p{A}}{\osim} (\p{A}_1 \fuse \p{A}_2) \oc \lctx_0 \reduces \p{A}_1 \oc \p{A}_2 \oc \lctx_0 = \lctx'$ for some $\lctx_0$.
%       Notice that $\octx \reduces\lframe{\p{A}_1}{\lframe{\p{A}_2}{\osim}} \lctx'$.
%       By appealing to the inductive hypothesis for $\p{A}_2$, we deduce that rewriting bisimilarity contains $\lframe{\p{A}_2}{\osim}$, and so $\octx \reduces\lframe{\p{A}_1}{\osim} \lctx'$.
%       Similar reasoning for $\p{A}_1$ allows us to conclude that $\octx \reduces\osim \lctx'$, as required.

%     \item
%       Consider the case in which $\p{A} = \one$ and $\octx \lframe{\p{A}}{\osim} \one \oc \lctx' \reduces \lctx'$.
%       Notice that $\octx \reduces\osim \lctx'$, as required.

%     \item
%       Consider the case in which $\p{A} = \n{A}_0$ and $\octx \lframe[\big]{\p{A}}{\osim} \dn \n{A}_0 \oc \atmL{\lctx}_L \oc \lctx'_0 \reduces \p{C} \oc \lctx'_0 = \lctx'$ because $\lfocus{}{\n{A}_0}{\atmL{\lctx}_L}{\p{C}}$.
%       Because $\osim$ is a labeled bisimulation~\parencref{??}, we may appeal to immediate output bisimulation property after framing off $\dn \n{A}_0$ and deduce that $\octx \lframe[\big]{\p{A}}{(\Reduces\lframe{\atmL{\lctx}_L}{\osim})} \dn \n{A}_0 \oc \atmL{\lctx}_L \oc \lctx'_0$.
%       Reduction is closed under framing, so $\octx \Reduces\lframe[\big]{(\dn \n{A} \oc \atmL{\lctx}_L)}{\osim} \dn \n{A} \oc \atmL{\lctx}_L \oc \lctx'_0$.
%       We can insert the reduction $\dn \n{A} \oc \atmL{\lctx}_L \reduces \p{C}$ and arrive at $\octx \Reduces\lframe{\p{C}}{\osim} \p{C} \oc \lctx'_0 = \lctx'$.
%       The proposition $\p{C}$ is a subformula of $\dn \n{A}$, so, by the inductive hypothesis, $\lframe{\p{C}}{\osim}$ is contained within $\osim$.
%       It follows that $\octx \Reduces\osim \lctx'$, as required. 
%     \end{itemize}

%   \item[Emptiness bisimulation]
%     Assume that $\octx \lframe{\p{A}}{\osim} \octxe$.
%     As before, this is impossible.
%   %
%   \qedhere
%   \end{description}
% \end{proof}

% \begin{itemize}
% \item Assume that $\octx \lframe{\p{A}}{\osim} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
%   we must show that $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{(\lframe{\p{A}}{\osim} \union \osim)}{\atmR{\lctx}'_R} \lctx$.
% \item 
%   Assume that $\octx \lframe{(\p{A}_1 \fuse \p{A}_2)}{\osim} \lctx \reduces \p{A}_1 \oc \p{A}_2 \oc \lctx'_0 = \lctx'$;
%   we must show that $\octx \Reduces\mathrel{\bigl(\lframe{(\p{A}_1 \fuse \p{A}_2)}{\osim} \union \osim\bigr)} \lctx'$.
%   Notice that $\octx \reduces\lframe{\p{A}_1}{\lframe{\p{A}_2}{\osim}} \lctx'$.
%   By the inductive hypothesis on $\p{A}_1$ and $\p{A}_2$, respectively, $\octx \reduces\lframe{\p{A}_1}{\osim} \lctx'$, and then $\octx \reduces\osim \lctx'$.
% \item
%   Assume that $\octx \lframe{\one}{\osim} \lctx \reduces \lctx'$.
%   Notice that $\octx \reduces\osim \lctx'$.
% \item
%   Assume that $\octx \lframe{(\dn \n{A})}{\osim} (\dn \n{A}) \oc \atmL{\lctx}'_L \oc \lctx_0 = \lctx$ and $\lfocus{}{\n{A}}{\atmL{\lctx}'_L}{\p{C}}$ and $\lctx' = \p{C} \oc \lctx_9$.
%   Notice that $\octx \lframe[\big]{\dn \n{A}}{(\Reduces\lframe{\atmL{\lctx}'_L}{\osim})} \lctx$, and so $\octx \Reduces\reduces\lframe{\p{C}}{\osim} \lctx'$.
%   By the inductive hypothesis, $\octx \Reduces\reduces\osim \lctx'$.
% \end{itemize}


% \begin{theorem}
%   If $\simu{R}$ is a labeled bisimulation, then so is $\lframe{\lctx_L}{\simu{R}}$ for all $\lctx_L$.
% \end{theorem}
% %
% \begin{proof}
%   \begin{description}
%   \item[Immediate output bisimulation]
%     Assume that $\octx \lframe{\octx_L}{\simu{R}} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$;
%     we must show that $\octx \Reduces\lrframe[\big]{\atmL{\lctx}'_L}{(\lframe{\p{A}}{\simu{R}} \union \simu{R})}{\atmR{\lctx}'_R} \lctx$.
%     \begin{itemize}
%     \item
%       Consider the case in which the context $\atmL{\lctx}'_L$ is nonempty -- that is, the case in which $\octx \lframe{\p{A}}{\simu{R}} \lctx = \p{A} \oc \atmL{\lctx}''_L \oc \lctx' \oc \atmR{\lctx}'_R$ and $\atmL{\lctx}'_L = \p{A} \oc \atmL{\lctx}''_L$, for some $\atmL{\lctx}''_L$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\p{A}$ and deduce that $\octx \lframe[\big]{\p{A}}{(\Reduces\lrframe{\atmL{\lctx}''_L}{\simu{R}}{\atmR{\lctx}'_R})} \lctx$.
%       Reduction is closed under framing, 
      
%     \item
%       Consider the case in which the context $\atmL{\lctx}'_L$ is empty and $\lctx'$ is nonempty.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\p{A}$ and deduce that $\octx \lframe[\big]{\p{A}}{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R})} \lctx$.
%       Reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\lframe{\p{A}}{\simu{R}}}{\atmR{\lctx}'_R} \lctx$, as required.

%     \item
%       Consider the case in which the contexts $\atmL{\lctx}'_L$ and $\lctx'$ are empty. -- that is, the case in whihc $\p{A} = \atmR{a}$ and $\octx \lframe{\p{A}}{\simu{R}} \lctx = \atmR{\lctx}'_R = \atmR{a} \oc \atmR{\lctx}''_R$, for some $\atmR{\lctx}''_R$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate output bisimulation property after framing off $\p{A}$ and deduce that $\octx \lframe[\big]{\p{A}}{(\Reduces\rframe{\simu{R}}{\atmR{\lctx}''_R})} \lctx$.
%       Reduction is closed under framing, so $\octx \Reduces\rframe{\lframe{\p{A}}{\simu{R}}}{\atmR{\lctx}''_R} \lctx$.
%       After framing off $\atmR{\lctx}''_R$, we may appeal to the emptiness bisimulation property of $\simu{R}$ and deduce that $\octx \Reduces\rframe[\big]{(\Reduces\rframe{\simu{R}}{\atmR{a}})}{\atmR{\lctx}''_R} \lctx$.
%       Once again, reduction is closed under framing, so we conclude that $\octx \Reduces\rframe{\simu{R}}{\atmR{\lctx}'_R} \lctx$, as required.
%     \end{itemize}

%   \item[Immediate input bisimulation]
%     Assume that $\octx \lframe{\p{A}}{\simu{R}} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$;
%     we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\mathrel{(\lframe{\p{A}}{\simu{R}} \union \simu{R})} \lctx'$.
%     \begin{itemize}
%     \item
%       Consider the case in which $\p{A} = \atmR{a}$ and does participate in the input transition -- that is, the case in which $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{\atmR{\lctx}_L \oc \atmR{a} \oc #1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'}$, for some $\lctx_0$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property and deduce that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\simu{R} \lctx'$, as required.
%     \item
%       Consider the case in which $\p{A}$ does not participate in the input transition -- that is, the case in which $\atmR{\lctx}_L$ is empty and $\octx \lframe{\p{A}}{\simu{R}} \p} \oc \lctx_0 = \lctx$ and $\ireduces{#1 \oc \atmL{\lctx}_R}{\lctx_0}{\lctx'_0}$ and $\lctx' = \p{A} \oc \lctx'_0$, for some $\lctx_0$ and $\lctx'_0$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property after framing off $\p{A}$ and deduce that $\octx \oc \atmL{\lctx}_R \lframe{\p{A}}{(\Reduces\simu{R})} \lctx'$.
%       Reduction is closed under framing, so we conclude that $\octx \oc \atmL{\lctx}_R \Reduces\lframe{\p{A}}{\simu{R}} \lctx'$, as required.
%     \end{itemize}

%   \item[Reduction bisimulation]
%     Assume that $\octx \lframe{\p{A}}{\simu{R}}\reduces \lctx'$;
%     we must show that $\octx \Reduces\mathrel{(\lframe{\p{A}}{\simu{R}} \union \simu{R})} \lctx'$.
%     \begin{itemize}
%     \item
%       Consider the case in which the reduction arises from the $\simu{R}$-related component alone -- that is, the case in which $\octx \lframe{\p{A}}{(\simu{R}\reduces)} \lctx'$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its reduction bisimulation property after framing off $\p{A}$ and deduce that $\octx \lframe{\p{A}}{(\Reduces\simu{R})} \lctx'$.
%       Reduction is closed under framing, so we conclude that $\octx \Reduces\lframe{\p{A}}{\simu{R}} \lctx'$.

%     \item
%       Consider the case in which the reduction arises from an input transition on the $\simu{R}$-related component -- that is, the case in which $\p{A} = \atmR{a}$ and $\octx \lframe{\atmR{a}}{\simu{R}} \atmR{a} \oc \lctx_0 = \lctx$ and $\ireduces{\atmR{a} \oc #1}{\lctx_0}{\lctx'}$, for some $\lctx_0$.
%       Because $\simu{R}$ is a labeled bisimulation, we may appeal to its immediate input bisimulation property and deduce that $\octx \Reduces\simu{R} \lctx'$, as required.

%     \item 
%       Consider the case in which the reduction arises from $\p{A}$ alone -- that is, the case in which $\octx = \p{A} \oc \octx_0$ and
%       \begin{itemize}
%       \item $\octx \lframe{(\p{A}_1 \fuse \p{A}_2)}{\simu{R}} \lctx = (\p{A}_1 \fuse \p{A}_2) \oc \lctx_0 \reduces \p{A}_1 \oc \p{A}_2 \oc \lctx_0 = \lctx'$, for some $\lctx_0$.
%         Then $\octx \reduces\lframe{\p{A}_1}{\lframe{\p{A}_2}{\simu{R}}} \lctx'$.
%       \end{itemize}
%     \end{itemize}

%   \item[Emptiness bisimulation]
%     Assume that $\octx \lframe{\p{A}}{\simu{R}} \octxe$.
%     This is, in fact, impossible because the empty context does not contain $\p{A}$.
%   \end{description}
% \end{proof}


% \begin{theorem}
%   If $\octx \osim \lctx$, then $\octx_L \oc \octx \oc \octx_R \osim \octx_L \oc \lctx \oc \octx_R$ for all $\octx_L$ and $\octx_R$.
% \end{theorem}
% \begin{proof}
%   By induction on the structures of $\octx_L$ and $\octx_R$, appealing to \cref{??}.
% \end{proof}


% \begin{theorem}[Reduction closure]
%   Let $\simu{R}$ be a rewriting bisimulation.
%   Then $\simu{R}$ is reduction-closed: $\octx \simu{R}\Reduces \lctx'$ implies $\octx \Reduces\simu{R} \lctx'$.
% \end{theorem}
% %
% \begin{proof}
%   Reduction closure follows immediately as the trivial instance of either the output or input bisimulation properties.
% \end{proof}




\clearpage
\section{Example of rewriting bisimilarity: \Aclp*{NFA}}\label{sec:ordered-bisimilarity:nfa}

Recall from \cref{sec:formula-as-process:nfa-bisim} the conjecture that bisimilar \ac{NFA} states have bisimilar encodings and vice versa.
Once established, this will allow us to rephrase soundness and completeness of the \ac{NFA} choreography in a properly stratified way: $\atmR{a} \oc \defp{q} \reduces_{\orsig}\osim \defp{q}'$ if, and only if, $q \nfareduces[a]\asim q'$.
More precisely, we will prove the following \lcnamecref{thm:nfa-bisim-osim}.
\begin{restatable*}[
  label=thm:nfa-bisim-osim
]{theorem}{thmnfabisim}
  Let $\aut{A} = (Q, \nfapow, F)$ be \iac{NFA} over the input alphabet $\ialph$.
  Then $q \asim s$ if, and only if, $\nfa{q} \osim \nfa{s}$ for all states $q$ and $s$.
\end{restatable*}
\noindent
Before proving this statement, we need a few \lcnamecrefs{lem:a-succ-bisim}.
%
% \begin{lemma}\label{lem:nfa-reduces}
%   For all states $q$:
%   \begin{enumerate}[nosep]
%   \item\label{enum:nfa-reduces-1} $\defp{q} \nreduces$.
%   \item\label{enum:nfa-reduces-2} If $\atmR{a} \oc \defp{q} \Reduces \octx'$, then either $\atmR{a} \oc \defp{q} = \octx'$ or $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a = \octx'$ for some state $q'_a$ that $a$-succeeds $q$.
%   \item\label{enum:nfa-reduces-3} If $\atmR{\emp} \oc \defp{q} \Reduces \octx'$, then either: $\atmR{\emp} \oc \defp{q} = \octx'$; $\atmR{\emp} \oc \defp{q} \reduces \defp{F}(q) = \octx'$; or $q$ is a final state and $\atmR{\emp} \oc \defp{q} \reduces \defp{F}(q) \reduces \octxe = \octx'$.
%   \end{enumerate}
% \end{lemma}
% \begin{proof}
%   Part~\ref{enum:nfa-reduces-1} is proved by inversion of a hypothetical rewriting of $\defp{q}$.

%   Part~\ref{enum:nfa-reduces-2} is proved by inversion of the given rewriting sequence:
%   If the rewriting sequence is nontrivial, it must be $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a \Reduces \octx'$ for some state $q'_a$ that $a$-succeeds $q$; by part~\ref{enum:nfa-reduces-1}, we deduce that $\octx' = \defp{q}'_a$.
%   Otherwise, if the rewriting sequence is trivial, the desired result is immediate.
% \end{proof}
%

% \noindent
These results hold only because the formula-as-process ordered rewriting framework is focused;
under an unfocused rewriting framework, $\defp{q}$ would admit rewritings, such as $\defp{q} \Reduces \atmR{\eow} \limp \atmR{F}(q)$, and $\atmR{a} \oc \defp{q}$ would admit rewritings to contexts other than encodings of $a$-successors.


\begin{lemma}\label{lem:a-succ-bisim}\label{lem:nfa-latent}\label{lem:final-bisim}
  Let $\aut{A} = (Q, \nfapow, F)$ be \iac{NFA} over the alphabet $\ialph$.
  Then:
  \begin{itemize}[nosep]
  \item $\defp{q} \nreduces$ for all states $q$.
  \item If $\atmR{a} \oc \defp{q} \Reduces\osim \defp{q}'$, then $\defp{q}'_a \osim \defp{q}'$ for some state $q'_a$ that $a$-succeeds $q$.
  \item If $\atmR{\eow} \oc \defp{q} \Reduces\osim \atmR{F}(s)$, then $q \in F$ if, and only if, $s \in F$.
  \end{itemize}
\end{lemma}
\begin{proof}
  The first part can be proved by examining the encoding of an arbitrary state $q$.

  To prove the second part, assume that $\atmR{a} \oc \defp{q} \Reduces\osim \defp{q}'$.
  By inversion on the given trace, there are two cases: either
  \begin{enumerate*}[label=\emph{(\roman*)}]
  \item $\atmR{a} \oc \defp{q} \osim \defp{q}'$ or
  \item $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a \Reduces\osim \defp{q}'$ for some state $q'_a$ that $a$-succeeds $q$.
  \end{enumerate*}
  \begin{itemize}
  \item
    Consider the case in which $\atmR{a} \oc \defp{q} \osim \defp{q}'$.
    Because the underlying \ac{NFA} is well-formed~\parencref{def:finite-automata:nfa}, $q$ has at least one $a$-successor;
    let $q'_a$ be one such successor.
    By definition of the encoding, $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a$.
    Because rewriting bisimilarity is reduction-closed (\cref{thm:bisim-reduction-closure}), $\defp{q}'_a \osim\secudeR \defp{q}'$.
    The first part of this \lcnamecref{lem:a-succ-bisim} shows that states are encoded by propositions that do not reduce, and so we may conclude that, in fact, $\defp{q}'_a \osim \defp{q}'$.

  \item 
    Consider the case in which $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a \Reduces\osim \defp{q}'$ for some state $q'_a$ that $a$-succeeds $q$.
    Because states are encoded by propositions that do not reduce, $\defp{q}'_a \osim \defp{q}'$ for some state $q'_a$ that $a$-succeeds $q$, as required.
  \end{itemize}

  To prove the third part, we reason as in the preceding part and deduce that $\atmR{F}(q) \osim \atmR{F}(s)$;
  we conclude that $q \in F$ if, and only if, $s \in F$.
  % 
  % \begin{itemize}
  % \item Consider the case in which the trace is trivial: $\atmR{a} \oc \defp{q} \osim \defp{q}'$.
  %   Because the underlying \ac{NFA} is well-formed~\parencref{??}, $q$ has at least one $a$-successor;
  %   let $q'_a$ be one such successor.
  %   By definition of the encoding, $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a$.
  %   Because rewriting bisimilarity is reduction-closed (\cref{thm:bisim-reduction-closure}), $\defp{q}'_a \osim\secudeR \defp{q}'$.
  %   States are encoded by latent\autocite{??} propositions (\cref{??}), and so we may conclude that, in fact, $\defp{q}'_a \osim \defp{q}'$.
  %
  % \item Consider the case in which the trace contains at least one step.
  %   By inversion, that step corresponds to \iac{NFA} transition: $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a \Reduces\osim \defp{q}'$, for some state $q'_a$ that $a$-succeeds $q$.
  %   Once again, because states are encoded by latent propositions, the trace from $\defp{q}'_a$ must be trivial.
  % \qedhere
  % \end{itemize}
\end{proof}
%
% \begin{lemma}\label{lem:final-bisim}
%   If $\atmR{\emp} \oc \nfa{q} \Reduces\osim \nfa{F}(s)$, then $q \in F$ if, and only if, $s \in F$.
% \end{lemma}
% %
% \begin{proof}
%   \begin{itemize}
%   \item Consider the case in which the trace is trivial -- \ie, $\atmR{\emp} \oc \nfa{q} \osim \nfa{F}(s)$.
%     By definition of the encoding, $\nfa{F}(q) \secuder \atmR{\emp} \oc \nfa{q} \osim \nfa{F}(s)$.
%     $\nfa{F}(q) \osim\secudeR \nfa{F}(s)$
%   \end{itemize}
% \end{proof}


% \begin{lemma}
%   If $\nfa{F}(q) \Reduces\osim \nfa{F}(s)$, then $q \in F$ if, and only if, $s \in F$.
% \end{lemma}
% %
% \begin{proof}
%   Assume that $\nfa{F}(q) \Reduces\osim \nfa{F}(s)$ and $q \notin F$.
%   By inversion, The trace can only be the trivial one, so $\nfa{F}(q) = \top$ and $\nfa{F}(s)$ are bisimilar.
%   Suppose, for the sake of contradiction, that $s \in F$ and so $\nfa{F}(s) = \one$.
%   Then $\top \osim \one$; hence, $\atmR{a} \oc \top \Reduces\osim \atmR{a}$ follows from the input bisimilarity property.
%   But output bisimilarity implies $\atmR{a} \oc \top \Reduces\rframe{\osim}{\atmR{a}} \atmR{a}$, which is impossible because $\atmR{a} \oc \top$ cannot produce $\atmR{a}$ at its right end.
% \end{proof}

\thmnfabisim
%
\begin{proof}
  We shall show that \ac{NFA} bisimilarity coincides with rewriting bisimilarity of encodings, proving each direction separately.
  \begin{itemize}[itemsep=\dimexpr\itemsep+\parsep\relax, parsep=0em, listparindent=\parindent]
    \item
      To prove that bisimilar \ac{NFA} states have bisimilar encodings -- \ie, that $q \asim s$ implies $\defp{q} \osim \defp{s}$ -- we shall now show that the relation $\mathord{\simu{R}} = \Set{(\defp{q}, \defp{s}) \given q \asim s}$ is a labeled bisimulation up to reflexivity and, by \cref{thm:bisim-technique-up-to-refl}, is included in rewriting bisimilarity.
      Notice that $\simu{R}$ is, by definition, symmetric because \ac{NFA} bisimilarity is symmetric~\parencref{thm:ordered-bisimilarity:equivalence}.
      \begin{description}
      \item[Immediate output bisimulation]
        Assume that $\defp{q} \simu{R} \defp{s} = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$; we must show that $\defp{q} \Reduces\lrframe{\atmL{\lctx}'_L}{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \defp{s}$.
        By definition of the encoding, $\defp{s}$ is a negative propostion and does not expose outputs.
        Therefore, $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty and $\lctx'$ is $\defp{s}$.
        The required $\defp{q} \Reduces\lrframe{\atmL{\lctx}'_L}{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \defp{s}$ follows trivially.

      \item[Immediate input bisimulation]
        Assume that $\defp{q} \simu{R} \defp{s}$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\defp{s}}{\lctx'}$; we must show that $\atmR{\lctx}_L \oc \defp{q} \oc \atmL{\lctx}_R \Reduces\reflc{\simu{R}} \lctx'$.
        Inversion of the input transition yields two cases.
        \begin{itemize}
        \item
          Consider the case in which the input transition is $\ireduces{\atmR{a} \oc #1}{\defp{s}}{\defp{s}'_a}$, where state $s$ is $a$-succeeded by $s'_a$.
          Because $q$ and $s$ are bisimilar, there must exist an $a$-successor of $q$, say $q'_a$, that is bisimilar to $s'_a$.
          By definition of the encoding, we thus have $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a$.
          So indeed, because $q'_a$ and $s'_a$ are bisimilar states, $\atmR{a} \oc \defp{q} \Reduces\reflc{\simu{R}} \defp{s}'_a$, as required.

        \item
          Consider the case in which the input transition is $\ireduces{\atmR{\eow} \oc #1}{\defp{s}}{\atmR{F}(s)}$.
          Because $q$ and $s$ are bisimilar states, $\atmR{F}(q) = \atmR{F}(s)$.
          By definition of the encoding, $\atmR{\eow} \oc \defp{q} \reduces \atmR{F}(q)$, and so, indeed, $\atmR{\eow} \oc \defp{q} \Reduces\reflc{\simu{R}} \atmR{F}(s)$, as required.
        \end{itemize}

      \item[Reduction bisimulation]
        Assume that $\defp{q} \simu{R} \defp{s} \reduces \lctx'$.
        The reduction bisimulation property holds vacuously because states are encoded as propositions that do not reduce~\parencref{lem:nfa-latent} -- there is no $\lctx'$ such that $\defp{s} \reduces \lctx'$.

      \item[Emptiness bisimulation]
        Assume that $\defp{q} \simu{R} \defp{s} = (\octxe)$.
        The emptiness bisimulation property also holds vacuously because states are encoded as propositions, not empty contexts.
      \end{description}

    \item
      To prove the converse -- that states with bisimilar encodings are themselves bisimilar -- we shall now show that the relation $\mathord{\simu{R}} = \Set{(q,s) \given \defp{q} \osim \defp{s}}$, which relates states if they have rewriting-bisimilar encodings, is \iac{NFA} bisimulation and is therefore included in \ac{NFA} bisimilarity.

      Because rewriting bisimilarity is symmetric~\parencref{thm:ordered-bisimilarity:equivalence}, so too is the relation $\simu{R}$.
      We must also prove that $\simu{R}$ satisfies the conditions of \ac{NFA} bisimilarity.
      \begin{description}[itemsep=\dimexpr\itemsep+\parsep\relax, parsep=0em, listparindent=\parindent]
      \item[Input bisimulation] Let $q$ and $s$ be states with bisimilar encodings, and let $q'_a$ be an $a$-successor of $q$;
        we must exhibit a state $s'_a$ that $a$-succeeds $s$ and has an encoding that is bisimilar to that of $q'_a$.

        By definition of the encoding, $\atmR{a} \oc \defp{q} \reduces \defp{q}'_a$.
        Because $q$ and $s$ have bisimilar encodings, the input bisimulation property allows us to deduce that $\atmR{a} \oc \defp{s} \Reduces\osim \defp{q}'_a$.
        An appeal to \cref{lem:a-succ-bisim} provides exactly what is needed: a state $s'_a$ that $a$-succeeds $s$ and has an encoding bisimilar to that of $q'_a$.
        
      \item[Finality bisimulation] Let $q$ and $s$ be states with bisimilar encodings, and assume that $q$ is a final state;
        we must show that $s$ is also a final state.

        By definition of the encoding, $\atmR{\eow} \oc \defp{q} \reduces \atmR{F}(q) = \atmR{\symacc}$.
        Because $q$ and $s$ have bisimilar encodings, it follows from the input bisimulation property that $\atmR{\eow} \oc \defp{s} \Reduces\osim \atmR{F}(q)$.
        An appeal to \cref{lem:final-bisim} allows us to conclude that $s$, like $q$, is a final state.
      %
      \qedhere
      \end{description}
    \end{itemize}
\end{proof}


% \begin{proof}
%   The parts are proved in order, with parts [...] depending on part [...].
%   \begin{enumerate}
%   \item To prove that bisimilar states are exactly those states that have bisimilar encodings, we take each direction in turn.
%     \begin{itemize}
%     \item First, we will prove that bisimilar states have bisimilar encodings.
%       Let $\simu{R}$ be the binary relation that relates two states' encodings if their underlying states are \ac{NFA}-bisimilar -- that is, $\mathord{\simu{R}} = \set{(\nfa{q}, \nfa{s}) \given q \asim s}$; we shall show that $\simu{R}$ satisfies the conditions of \cref{thm:??} and is therefore included in rewriting bisimilarity.


%     \item Conversely, we will now prove that states that have bisimilar encodings are themselves bisimilar.
%       Let $\simu{R}$ be the binary relation that relates two states if their encodings are rewriting-bisimilar -- that is, $\mathord{\simu{R}} = \set{(q,s) \given \nfa{q} \osim \nfa{s}}$;
%       we shall show that $\simu{R}$ is \iac{NFA} bisimulation and therefore included in \ac{NFA} bisimilarity.
%       \begin{itemize}[listparindent=\parindent]
%       \item Let $q$ and $s$ be states with bisimilar encodings, and let $q'_a$ be an $a$-successor of $q$;
%         we must exhibit a state $s'_a$ that $a$-succeeds $s$ and has an encoding that is bisimilar to that of $q'_a$.

%         By definition of the encoding, $\atmR{a} \oc \nfa{q} \reduces \nfa{q}'_a$.
%         Because $q$ and $s$ have bisimilar encodings, the input bisimilarity property allows us to deduce that $\atmR{a} \oc \nfa{s} \Reduces\miso \nfa{q}'_a$.
%         An appeal to \cref{lem:??} provides exactly what is needed: a state $s'_a$ that $a$-succeeds $s$ and has an encoding bisimilar to that of $q'_a$.
        
%       \item Let $q$ and $s$ be states with bisimilar encodings, and assume that $q$ is a final state;
%         we must show that $s$ is also a final state.

%         By definition of the encoding, $\atmR{\emp} \oc \nfa{q} \reduces \nfa{F}(q) = \one$.
%         Because $q$ and $s$ have bisimilar encodings, it follows from input bisimilarity that $\atmR{\emp} \oc \nfa{s} \Reduces\miso \nfa{F}(q)$.
%         \begin{itemize}
%         \item $\nfa{F}(s) \secuder \atmR{\emp} \oc \nfa{s} \miso \nfa{F}(q)$.
%           Then $\nfa{F}(s) \miso\secudeR \nfa{F}(q)$.
%         \item $\nfa{F}(s) \Reduces\miso \nfa{F}(q)$.
          
%         \end{itemize}
%       \end{itemize}
      
%     \end{itemize}

%   \item 
%     \begin{itemize}
%     \item Assume that, up to bisimilarity, $q'$ is an $a$-successor of $q$ -- that is, that $q \misa s \nfareduces[a] s'_a \asim q'$ for some states $s$ and $s'_a$.
%       By definition of the encoding, $\atmR{a} \oc \nfa{s} \reduces \nfa{s}'_a$.
%       Because bisimilar states have bisimilar encodings (part~\ref{??}), $\nfa{q} \miso \nfa{s}$ and $\nfa{s}'_a \osim \nfa{q}'$.
%       Moreover, because rewriting bisimilarity is an atomic congruence (\cref{??}), $\atmR{a} \oc \nffa{q} \miso \atmR{a} \oc \nfa{s}$.
%       and putting everything together, we have $\atmR{a} \oc \nfa{q} \miso\reduces\osim \nfa{s}'_a$.

%     \item Assume that, up to bisimilarity, $\atmR{a} \oc \nfa{q}$ rewrites to $\nfa{q}'$ -- that is, assume that $\atmR{a} \oc \nfa{q} \miso\reduces\osim \nfa{q}'$.
%       An appeal to the reduction bisimilarity property yields $\atmR{a} \oc \nfa{q} \Reduces\miso\osim \nfa{q}'$.
%       Because bisimilarity is a symmetric relation, it follows from \cref{lem:??} that there exists a state $q'_a$ that $a$-succeeds $q$ and has an encoding that is bisimilar to that of $q'$.
%       Moreover, because states with bisimilar encodings are themselves bisimilar (part~\ref{??}) and because bisimilarity is reflexive, $q \misa\nfareduces[a]\asim q'$.
%     \end{itemize}

%   \item
%   \item 
%     \begin{itemize}
%     \item We must show that $q \misa\asim q'$ if, and only if, $\nfa{q} \miso\Reduces\osim \nfa{q}'$.
%     \item We must show that $q \misa\nfareduces[a]\nfareduces[w]\asim q'$ if, and only if, $\atmR{w} \oc \atmR{a} \oc \nfa{q} \miso\Reduces\osim \nfa{q}'$.
      
%     \end{itemize}
%   \end{enumerate}

%   Let $\simu{R}$ be the binary relation on ordered contexts such that $\octx$ and $\lctx$ are $\simu{R}$-related if they are equal to the encodings of a pair of bisimilar states -- that is, $\mathord{\simu{R}} = \set{(\octx, \lctx) \given \exists q,s \in Q.\, (\octx = \nfa{q}) \land (q \asim s) \land (\nfa{s} = \lctx)}$.
%   \begin{itemize}
%   \item Let $q$ and $s$ be bisimilar states, and assume that $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\nfa{q}}{\lctx'}$.
%     By inversion, there are two cases; in either case, the context $\atmL{\lctx}_R$ must be empty.
%     \begin{itemize}
%     \item Consider the case in which the context $\atmR{\lctx}_L$ is a single atom $\atmR{\emp}$ and $\lctx' = \nfa{F}(q)$.
%       By the encoding's construction, $\ireduces{\atmR{\emp} \oc #1}{\nfa{s}}{\nfa{F}(s)}$.
%       And, because states $q$ and $s$ are bisimilar, the two are both final or both nonfinal states.
%       $\nfa{F}(s)$
%     \item  or $\atmR{a}$ for some input symbol $a$.
%     \end{itemize}
%   \end{itemize}
  

%   Let $\simu{R}$ be the binary relation on states such that $q$ and $s$ are $\simu{R}$-related if their encodings are ordered bisimilar -- that is, $\mathord{\simu{R}} = \set{(q, s) \given \nfa{q} \osim \nfa{s}}$.
%   \begin{itemize}
%   \item Assume that $s \simu{R}^{-1} q \nfareduces[a] q'_a$.
%     Because $q'_a$ is an $a$-successor of $q$, there exists a trace $\atmR{a} \oc \nfa{q} \Reduces \nfa{q}'_a$.
%     Because $q$ and $s$ have bisimilar encodings, it then follows from the input bisimilarity property that $\atmR{a} \oc \nfa{s} \Reduces\miso \nfa{q}'_a$.
%     By inversion, there are two cases
%     \begin{itemize}
%     \item $\nfa{s}'_a \secuder \atmR{a} \oc \nfa{s} \miso \nfa{q}'_a$, so $\nfa{q}'_a \Reduces\osim \nfa{s}'_a$
%     \item $\atmR{a} \oc \nfa{s} \reduces \nfa{s}'_a \miso \nfa{q}'_a$
%     \end{itemize}
%     By inversion of this trace, there must exist a state $s'_a$ that is an $a$-successor of $s$ and has an encoding that is bisimilar to the encoding of $q'_a$ -- in other words, $s \nfareduces[a] s'_a \simu{R}^{-1} q'_a$.

%   \item Assume that $s \simu{R}^{-1} q \in F$.
%     With $q$ being a final state, there exists a trace $\atmR{\emp} \oc \nfa{q} \Reduces \octxe$.
%     Because $q$ and $s$ have bisimilar encodings, $\atmR{\emp} \oc \nfa{s} \Reduces\miso \octxe$.
%     By inversion of this trace, $\nfa{F}(s)$ is bisimilar to the empty context.
%     That is impossible if $s \notin F$, so $s$ must be a final state, like $q$.
%   \end{itemize}

%   To establish the completness of our \ac{NFA} encoding with respect to bisimularity, it then suffices to show that ordered bisimularity contains the relation $\simu{R}$.
%   Appealing to the preceding proof technique for ordered bisimilarity\parencref{thm:ord-bisim-technique}, we need only establish that $\simu{R}$ has immediate output bisimulation, immediate input bisimulation, reduction bisimulation, and emptiness bisimulation properties.

%   Only the immediate input bisimulation and reduction bisimulation conditions apply to the relation $\simu{R}$.
%   \begin{description}
%   \item[Immediate input bisimulation]
%     Assume that $\lctx \simu{R} \octx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$;
%     we must show that $\atmR{\lctx}_L \oc \octx \oc \atmL{\lctx}_R \Reduces\refl*{\simu{R}}^{-1} \lctx'$.

%     Inversion allows us to deduce $\lctx = \nfa{q}$ and $\octx = \nfa{s}$ for some states $q$ and $s$ such that $q \asim s$.
%     Examining the encoding, we see that there are two possible input transitions from $\nfa{q}$.
%     \begin{itemize}
%     \item Consider the input transition $\ireduces{\atmR{a} \oc #1}{\nfa{q}}{\nfa{q}'_a}$, with $a \in \ialph$ and $q \nfareduces[a] q'_a$ -- that is, $\atmR{\lctx}_L = \atmR{a}$; $\atmL{\lctx}_R = \octxe$; and $\lctx' = \nfa{q}'_a$.
%       We must show that $\atmR{a} \oc \nfa{s} \Reduces\refl*{\simu{R}}^{-1} \nfa{q}'_a$.

%       Because $q$ and $s$ are bisimilar states, $s \nfareduces[a] s'_a \misa q'_a$ for some state $s'_a$.
%       Recall from \cref{thm:nfa-encoding-reduces} that the encoding of \acp{NFA} is complete with respect to input transitions; so, $\atmR{a} \oc \nfa{s} \reduces \nfa{s}'_a$.
%       As $q'_a$ and $s'_a$ are bisimilar states, we conclude that $\atmR{a} \oc \nfa{s} \reduces\refl*{\simu{R}}^{-1} \nfa{q}'_a$, as required.

%     \item Consider the input transition $\ireduces{\atmR{\emp} \oc #1}{\nfa{q}}{\octxe}$ when $q$ is a final state -- that is, $\atmR{\lctx}_L = \atmR{\emp}$ and $\atmL{\lctx}_R = \lctx' = \octxe$.
%       We must show that $\atmR{\emp} \oc \nfa{s} \Reduces\refl*{\simu{R}}^{-1} \octxe$.

%       Because $q$ and $s$ are bisimilar states, $s$ must also be a final state.
%       Recall from \cref{thm:nfa-encoding-reduces} that the encoding of \acp{NFA} is complete with respect to input transitions; so, $\atmR{\emp} \oc \nfa{s} \reduces \octxe$.
%       We conclude that $\atmR{\emp} \oc \nfa{s} \reduces\refl*{\simu{R}}^{-1} \octxe$, as required.
%     \end{itemize}
%   %
%   \item[Reduction bisimulation]
%   \end{description}
% \end{proof}

% \begin{theorem}
%   If $\nfa{q} \osim \nfa{s}$, then $q \asim s$.
% \end{theorem}
% %
% \begin{proof}
%   Let $\simu{R}$ be the binary relation on states such that $q \simu{R} s$ exactly when $\nfa{q} \osim \nfa{s}$.
%   We will show that $\simu{R}$ is \iacs{NFA} bisimulation.

%   Among other properties, we must show that $\simu{R}$ simulates inputs.
%   Assume that $\nfa{s} \miso \nfa{q}$ and $q \nfareduces[a] q'$; we must show that $s \nfareduces[a] s'$ for some $s'$ such that $\nfa{s}' \miso \nfa{q}'$.
%   Because $\atmR{a} \oc \nfa{q} \Reduces \nfa{q}'$, it follows by input bisimilarity that $\atmR{a} \oc \nfa{s} \Reduces\miso \nfa{q}'$.
%   There are two cases, according to the structure of the reduction sequence from $\atmR{a} \oc \nfa{s}$.
%   \begin{itemize}
%   \item If the reduction sequence is trivial, then $\atmR{a} \oc \nfa{s} \miso \nfa{q}'$.
%     Because the transition relation is left-total, $s \nfareduces[a] s'$ for some state $s'$.
%     It follows that $\atmR{a} \oc \nfa{s} \Reduces \nfa{s}'$, and so, by input bisimilarity, $\nfa{q}' \Reduces\osim \nfa{s}'$.
%     However, $\nfa{q}' \longarrownot\reduces$, allowing us to conclude that $\nfa{q}' \osim \nfa{s}'$.
%   \item If the reduction sequence is nontrivial, then $\atmR{a} \oc \nfa{s} \reduces\Reduces\miso \nfa{q}'$.
%     Then
%     \begin{equation*}
%       \with_{s^* \mid s \nfareduces[a] s^*} \nfa{s}^* \Reduces\miso \nfa{q}'
%     \end{equation*}
%     It follows that $\with_{s^* \in S} \nfa{s}^* \miso \nfa{q}$ where $S$ is a subset of the $a$-successors of state $s$.
%     Because bisimilarity is reduction-closed, $\nfa{s}^* \miso \nfa{q}'$ for each $s^* \in S$.

%     How do we know that the subset $S$ is nonempty?
%     In other words, what happens if $\top \miso \nfa{q}'$?
%   \end{itemize}

%   Assume that $\nfa{s} \miso \nfa{q}$ and $q$ is a final state;
%   we must show that $s$ is also a final state.
%   Because $q$ is final, $\atmR{\emp} \oc \nfa{q} \Reduces \octxe$.
%   By input bisimilarity, $\atmR{\emp} \oc \nfa{s} \Reduces\miso \octxe$.
%   Choose a fresh atom $\atmR{x}$.
%   It follows by emptiness bisimilarity that $\atmR{x} \oc \atmR{\emp} \oc \nfa{s} \Reduces\rframe{\osim}{\atmR{x}}^{-1} \atmR{x}$.
%   However, $\atmR{x} \oc \atmR{\emp} \oc \nfa{s}$ exposes $\atmR{x}$ on the right only if $s$ is also a final state.
% \end{proof}

% \clearpage
\section{Example of rewriting bisimilarity: Binary counter}\label{sec:ordered-bisimilarity:counter}

For a further application of rewriting bisimilarity, we can revisit the binary counter.
Recall from \cref{sec:formula-as-process:counters-oo} its object-oriented choreography:
%d of the binary counter:
\begin{equation*}
  \orsig =
  \begin{lgathered}[t]
    \defp{e} \defd (\defp{e} \fuse \defp{b}_1 \pmir \atmL{i}) \with (\atmR{z} \pmir \atmL{d}) \\
    \defp{b}_0 \defd (\up \dn \defp{b}_1 \pmir \atmL{i}) \with (\atmL{d} \fuse \defp{b}'_0 \pmir \atmL{d}) \\
    \defp{b}_1 \defd (\atmL{i} \fuse \defp{b}_0 \pmir \atmL{i}) \with (\defp{b}_0 \fuse \atmR{s} \pmir \atmL{d}) \\
    \defp{b}'_0 \defd (\atmR{z} \limp \atmR{z}) \with (\atmR{s} \limp \defp{b}_1 \fuse \atmR{s})
  \end{lgathered}
\end{equation*}
Also, recall that denotations were assigned directly to choreographed counters using $\aval{\octx}{n}$, $\ainc{\octx}{n}$, and $\adec{\octx}{n}$ judgments.

Intuitively, any two counters that have the same denotation ought to be indistinguishable.
After all, the only two operations that we have on counters are increment and head-unary normalization (also known as decrement), and both of these are reflected in the denotation.
For instance, both $\defp{e} \oc \atmL{i} \oc \defp{b}_1$ and $\defp{e} \oc \defp{b}_1 \oc \defp{b}_0 \oc \atmL{i}$ denote the natural number $3$, so any sequence of increments and decrements that we apply to these counters ought not to distinguish them.

% Strictly speaking, denotations were only defined for the string rewriting specification of binary counters~\parencref{sec:??}: string $w$ denotes natural number $n$ exactly when $\ainc{w}{n}$.
% We can, of course, lift the denotations to choreographed contexts:
% $\octx$ denotes $n$ exactly when $\ainc{\theta^{-1}(\octx)}{n}$.
% For instance, $\defp{e} \oc \atmL{i} \oc \defp{b}_1$ denotes $3$ because $\theta^{-1}(\defp{e} \oc \atmL{i} \oc \defp{b}_1) = \ainc{e \wc i \wc b_1}{3}$.
% We could even assign denotations directly to choreographed contexts by defining new $\aval{}{}$, $\ainc{}{}$, and $\adec{}{}$ relations on choreographed contexts.
% \begin{inferences}
%   \infer[\jrule{$\defp{e}$-V}]{\aval{\defp{e}}{0}}{}
%   \and
%   \infer[\jrule{$\defp{b}_0$-V}]{\aval{\octx \oc \defp{b}_0}{2n}}{
%     \aval{\octx}{n}}
%   \and
%   \infer[\jrule{$\defp{b}_1$-V}]{\aval{\octx \oc \defp{b}_1}{2n+1}}{
%     \aval{\octx}{n}}
%   \\
%   \infer[\jrule{$\defp{e}$-I}]{\ainc{\defp{e}}{0}}{}
%   \and
%   \infer[\jrule{$\defp{b}_0$-I}]{\ainc{\octx \oc \defp{b}_0}{2n}}{
%     \ainc{\octx}{n}}
%   \and
%   \infer[\jrule{$\defp{b}_1$-I}]{\ainc{\octx \oc \defp{b}_1}{2n+1}}{
%     \ainc{\octx}{n}}
%   \and
%   \infer[\jrule{$\atmL{i}$-I}]{\ainc{\octx \oc \atmL{i}}{n+1}}{
%     \ainc{\octx}{n}}
%   \\
%   \infer[\jrule{$\atmL{d}$-D}]{\adec{\octx \oc \atmL{d}}{n}}{
%     \ainc{\octx}{n}}
%   \and
%   \infer[\jrule{$\atmR{z}$-D}]{\adec{\atmR{z}}{0}}{}
%   \and
%   \infer[\jrule{$\atmR{s}$-D}]{\adec{\octx \oc \atmR{s}}{n+1}}{
%     \ainc{\octx}{n}}
%   \and
%   \infer[\jrule{$\defp{b}'_0$-D}]{\adec{\octx \oc \defp{b}'_0}{2n}}{
%     \adec{\octx}{n}}
% \end{inferences}
% A context $\octx$ is an \vocab{increment counter} or \vocab{increment context} if $\ainc{\octx}{n}$ for some natural number $n$;
% likewise, we will say that a context $\octx$ is an \vocab{decrement counter} or \vocab{decrement context} if $\adec{\octx}{n}$ for some natural number $n$.

% With these relations, 
We can state and prove that counters with equal denotations are bisimilar, and conversely, that bisimilar counters have equal denotations.
\begin{restatable}[
  label=thm:oo-counter-bisim
]{theorem}{thmoocounterbisim}
  If either
  \begin{enumerate*}[label=\emph{(\roman*)}]
  \item $\ainc{\octx}{n}$ and $\ainc{\lctx}{n'}$ or
  \item $\adec{\octx}{n}$ and $\adec{\lctx}{n'}$
  \end{enumerate*}, then $\octx \osim \lctx$ if, and only if, $n = n'$.
\end{restatable}

Before proving this \lcnamecref{thm:oo-counter-bisim}, recall the big-step adequacy of decrements for the choreography.
\coroocounteradequacy*

We also need to prove an easy lemma that characterizes the  output and input transitions possible from binary counters.
\begin{lemma}\label{lem:ordered-bisimilarity:oo-counter-bisim-easy}\leavevmode
  \begin{itemize}[nosep]
  \item
    If $\ainc{\lctx}{n}$, then:
    \begin{itemize}[nosep]
    \item $\lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ only if $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty; and
    \item $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$ only if $\atmR{\lctx}_L$ is empty and either $\atmL{\lctx}_R = \atmL{i}$ or $\atmL{\lctx}_R = \atmL{d}$.
    \end{itemize}

  \item
    If $\adec{\lctx}{n}$, then:
    \begin{itemize}[nosep]
    \item $\lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ only if
      $\atmL{\lctx}'_L$ is empty and either:
      \begin{itemize}[nosep]
      \item $n=0$ and $\atmR{\lctx}'_R = \atmR{z}$ and $\lctx'$ is empty;
      \item $n > 0$ and $\atmR{\lctx}'_R = \atmR{s}$ and $\ainc{\lctx'}{n-1}$; or
      \item $\atmR{\lctx}'_R$ is empty; and
      \end{itemize}

    \item
      $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$ is impossible.
    \end{itemize}
  \end{itemize}
\end{lemma}
\begin{proof}
  By structural induction on the derivation of the given denotation.
  The second part relies on the first part in one case.
\end{proof}

% \begin{lemma}\leavevmode
%   \begin{itemize}
%   \item
%     If $\lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$, then:
%     \begin{itemize}[nosep]
%     \item $\ainc{\lctx}{n}$ only if $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty; and
%     \item $\adec{\lctx}{n}$ only if $\atmL{\lctx}'_L$ is empty and either:
%       \begin{itemize}[nosep]
%       \item $n=0$ and $\atmR{\lctx}'_R = \atmR{z}$ and $\lctx'$ is empty;
%       \item $n > 0$ and $\atmR{\lctx}'_R = \atmR{s}$ and $\ainc{\lctx'}{n-1}$; or
%       \item $\atmR{\lctx}'_R$ is empty.
%       \end{itemize}
%     \end{itemize}

%   \item
%     If $\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\octx}{\octx'}$, then:
%     \begin{itemize}[nosep]
%     \item $\ainc{\octx}{n}$ only if $\atmR{\octx}_L$ is empty and either $\atmL{\octx}_R = \atmL{i}$ or $\atmL{\octx}_R = \atmL{d}$ or $\atmL{\octx}_R$ is empty; and
%     \item $\adec{\octx}{n}$ only if $\atmR{\octx}_L$ and $\atmL{\octx}_R$ are empty.
%     \end{itemize}
%   \end{itemize}
% \end{lemma}
% \begin{proof}
  
% \end{proof}

% \begin{lemma}\label{lem:ordered-bisimilarity:counter-ireduces}
%   If $\ireduces{\atmR{\octx}_L \oc #1 \oc \atmL{\octx}_R}{\octx}{\octx'}$, then:
%   \begin{itemize}[nosep]
%   \item $\ainc{\octx}{n}$ only if $\atmR{\octx}_L$ is empty and either $\atmL{\octx}_R = \atmL{i}$ or $\atmL{\octx}_R = \atmL{d}$ or $\atmL{\octx}_R$ is empty; and
%   \item $\adec{\octx}{n}$ only if $\atmR{\octx}_L$ and $\atmL{\octx}_R$ are empty.
%   \end{itemize}
% \end{lemma}
% \begin{proof}
%   Each part is proved by structural induction on the denotation's derivation, with the second part depending on the first.
% \end{proof}

Using this \lcnamecref{lem:ordered-bisimilarity:oo-counter-bisim-easy}, we may prove the correspondence between denotation and bisimilarity.
It is especially interesting that the proof of this \lcnamecref{thm:oo-counter-bisim} is quite modular, relying heavily on the choreography's adequacy.
We conjecture that this proof pattern will be useful in proving \lcnamecrefs{thm:oo-counter-bisim} about bisimilarities for other choreographies.
%
\thmoocounterbisim*
\begin{proof}
  We prove each direction separately.
  \begin{itemize}
  \item
    To prove that states with equal denotations are bisimilar, consider the relation $\simu{R}$ given by 
    % Let $\simu{R}$ be a relation on states with equal denotations: 
  \begin{equation*}
    \mathord{\simu{R}}
    =
    \begin{lgathered}[t]
      \Set{(\octx, \lctx) \given \exists n \in \nats.\,(\ainc{\octx}{n}) \land (\ainc{\lctx}{n})} \\
      {} \union
      \Set{(\octx, \lctx) \given \exists n \in \nats.\,(\adec{\octx}{n}) \land (\adec{\lctx}{n})}
      \,.
    \end{lgathered}
  \end{equation*}
  We shall show that $\simu{R}$ progresses to its reflexive closure and then conclude, by \cref{thm:bisim-technique-up-to-refl}, that $\simu{R}$ is contained within rewriting bisimilarity.
  \begin{description}
  \item[Immediate output bisimulation]
    Assume that $\octx \simu{R} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$; we must show that $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$.
    Because $\octx$ and $\lctx$ are $\simu{R}$-related, either:
      $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$ for some natural number $n$; or
      $\adec{\octx}{n}$ and $\adec{\lctx}{n}$ for some natural number $n$.
    \begin{itemize}
    \item
      Consider the case in which $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$.
      % A straightforward induction on the derivation of $\ainc{\lctx}{n}$
      \Cref{lem:ordered-bisimilarity:oo-counter-bisim-easy} shows that $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ must both be empty.
      The required $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$ is then trivial.

    \item
      Consider the case in which $\adec{\octx}{n}$ and $\adec{\lctx}{n}$.
    According to big-step adequacy of decrements for the choreography~\parencref{thm:msg-dec-big-adequacy}, there are three cases that derive from $\lctx$.
    \begin{itemize}
    \item 
      Consider the case in which $\adec{\octx}{0}$ and $\lctx = \adec{\atmR{z}}{0}$.
      According to big-step adequacy of decrements for the choreography, $\octx \Reduces \atmR{z}$ and so, indeed, $\octx \Reduces\rframe{\reflc{\simu{R}}}{\atmR{z}} \atmR{z} = \lctx$.

    \item 
      Consider the case in which $\adec{\octx}{n}$ and $n > 0$ and $\lctx = \lctx' \oc \atmR{s}$ and $\ainc{\lctx'}{n-1}$.
      According to big-step adequacy of decrements for the choreography, $\octx \Reduces \octx' \oc \atmR{s}$ for some $\octx'$ such that $\ainc{\octx'}{n-1}$.
      It immediately follows that $\octx \Reduces\rframe{\simu{R}}{\atmR{s}} \lctx' \oc \atmR{s} = \lctx$.

    \item
      Consider the case in which $\adec{\octx}{n}$ and $\adec{\lctx}{n}$, with both $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ empty.
      The required $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$ is trivial.
    \end{itemize}
    \end{itemize}

  % \item[Immediate output bisimulation]
  %   Assume that $\octx \simu{R} \lctx = \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$.
  %   According to big-step adequacy of decrements~\parencref{thm:msg-dec-big-adequacy}, there are three cases that derive from $\lctx$.
  %   \begin{itemize}
  %   \item 
  %     Consider the case in which $\adec{\octx}{0}$ and $\lctx = \adec{\atmR{z}}{0}$.
  %     According to big-step adequacy of decrements~\parencref{thm:msg-dec-big-adequacy}, $\octx \Reduces \atmR{z}$ and so, indeed, $\octx \Reduces\rframe{\reflc{\simu{R}}}{\atmR{z}} \atmR{z}$.

  %   \item 
  %     Consider the case in which $\adec{\octx}{n}$ and $n > 0$ and $\lctx = \lctx' \oc \atmR{s}$ and $\ainc{\lctx'}{n-1}$.
  %     According to big-step adequacy of decrements~\parencref{thm:msg-dec-big-adequacy}, $\octx \Reduces \octx' \oc \atmR{s}$ for some $\octx'$ such that $\ainc{\octx'}{n-1}$.
  %     It immediately follows that $\octx \Reduces\rframe{\simu{R}}{\atmR{s}} \lctx$.

  %   \item
  %     Consider the case in which $\adec{\octx}{n}$ and $\adec{\lctx}{n}$, with both $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ empty.
  %     The required $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\reflc{\simu{R}}}{\atmR{\lctx}'_R} \lctx$ is trivial.
  %   \end{itemize}


    % \begin{itemize}
    % \item 
    %   Consider the case in which $\octx \simu{R} \atmR{z}$ and $\adec{\octx}{0}$.
    %   According to \cref{??}, $\octx \Reduces \atmR{z}$ and so, indeed, $\octx \Reduces\rframe{\simu{R}}{\atmR{z}} \atmR{z}$.

    % \item 
    %   Consider the case in which $\octx \simu{R} \lctx = \lctx' \oc \atmR{s}$ and $\adec{\octx}{n'+1} = n$ and $\ainc{\lctx'}{n'}$.
    %   According to \cref{??}, $\octx \Reduces \octx' \oc \atmR{s}$ for some $\octx'$ such that $\ainc{\octx'}{n'}$.
    %   It immediately follows that $\octx \Reduces\rframe{\simu{R}}{\atmR{s}} \lctx$.

    % \item
    %   Consider the case in which $\octx \simu{R} \lctx = \lctx'$ and both $\atmL{\lctx}'_L$ and $\atmR{\lctx}'_R$ are empty.
    %   The required $\octx \Reduces\lrframe{\atmL{\lctx}'_L}{\simu{R}}{\atmR{\lctx}'_R} \lctx$ is trivial.
    % \end{itemize}

  \item[Immediate input bisimulation]
    Assume that $\octx \simu{R} \lctx$ and $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$.
    There are several cases.
    \begin{itemize}[listparindent=\parindent]
    \item
      Consider the case in which $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$, for some natural number $n$.
      According to \cref{lem:ordered-bisimilarity:oo-counter-bisim-easy}, the input transition is either $\ireduces{#1 \oc \atmL{i}}{\lctx}{\lctx'}$ or $\ireduces{#1 \oc \atmL{d}}{\lctx}{\lctx'}$.
      \begin{itemize}
      \item
        If the input transition $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$ is $\ireduces{#1 \oc \atmL{i}}{\lctx}{\lctx'}$, then  apply the $\jrule{$\atmL{i}$-I}$ rule to deduce that $\ainc{\octx \oc \atmL{i}}{n+1}$ and $\ainc{\lctx \oc \atmL{i}}{n+1}$.
        Because $\lctx \oc \atmL{i} \reduces \lctx'$, it follows from $\ainc{}{}$-preservation~\parencref{??} that $\ainc{\lctx'}{n+1}$.
        We conclude that $\octx \oc \atmL{i} \Reduces\simu{R} \lctx'$, as required.

      \item
        If the input transition $\ireduces{\atmR{\lctx}_L \oc #1 \oc \atmL{\lctx}_R}{\lctx}{\lctx'}$ is $\ireduces{#1 \oc \atmL{d}}{\lctx}{\lctx'}$, then similar reasoning applies.
      \end{itemize}

    \item 
      Consider the case in which $\adec{\octx}{n}$ and $\adec{\lctx}{n}$, for some $n$.
      By \cref{lem:ordered-bisimilarity:oo-counter-bisim-easy}, this input transition is impossible.
    \end{itemize}

  \item[Reduction bisimulation]
    Assume that $\octx \simu{R} \lctx \reduces \lctx'$.
    If $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$ for some natural number $n$, then $\ainc{}{}$-preservation~\parencref{??} yields $\ainc{\lctx'}{n}$;
    it immediately follows that $\octx \Reduces\simu{R} \lctx'$.
    Otherwise, if $\adec{\octx}{n}$ and $\adec{\lctx}{n}$ for some natural number $n$, then $\adec{}{}$-preservation similarly allows us to conclude that $\octx \Reduces\simu{R} \lctx'$.

  \item[Emptiness bisimulation]
    This is vacuously true because $(\octxe)$ has no denotation under $\ainc{}{}$ and $\adec{}{}$.
  \end{description}

  \item
    To prove the converse, that bisimilar counters have equal denotations, we shall prove that 
    \begin{enumerate}[noitemsep]
    \item If $\adec{\octx}{n}$ and $\adec{\lctx}{n'}$ and $\octx \osim \lctx$, then $n = n'$.
    \item If $\ainc{\octx}{n}$ and $\ainc{\lctx}{n'}$ and $\octx \osim \lctx$, then $n = n'$.
    \end{enumerate}
    using a lexicographic induction, first on the denotation $n$ and then on the inductive hypothesis used, with $\text{1} < \text{2}$.
  \begin{enumerate}
  \item Assume that $\adec{\octx}{n}$ and $\adec{\lctx}{n'}$ and $\octx \osim \lctx$.
    \begin{itemize}
    \item
      Consider the case in which $n = 0$.
      By big-step adequacy of decrements~\parencref{cor:oo-counter-adequacy}, $\octx \Reduces \atmR{z}$.
      Because $\octx$ and $\lctx$ are bisimilar, $\lctx \Reduces\rframe{\osim}{\atmR{z}} \atmR{z}$.
      According to big-step adequacy of decrements again, $\lctx$ eventually emits $\atmR{z}$ only if its denotation is $n' = 0$, and so $n = 0 = n'$.

    \item 
      Consider the case in which $n > 0$.
      By big-step adequacy of decrements~\parencref{cor:oo-counter-adequacy}, $\octx \Reduces \octx' \oc \atmR{s}$ for some $\octx'$ such that $\ainc{\octx'}{n-1}$.
      Because $\octx$ and $\lctx$ are bisimilar, $\lctx \Reduces\rframe{\osim}{\atmR{s}} \octx' \oc \atmR{s}$; in other words, $\lctx \Reduces \lctx' \oc \atmR{s}$ for some $\lctx'$ such that $\octx' \osim \lctx'$.
      According to big-step adequacy of decrements again, $\lctx$ eventually emits $\atmR{s}$ only if $n' > 0$ and $\ainc{\lctx'}{n'-1}$.
      By the inductive hypothesis, it follows that $n-1 = n'-1$, and so $n = n'$ as required.
    \end{itemize}
    
  \item Assume that $\ainc{\octx}{n}$ and $\ainc{\lctx}{n'}$ and $\octx \osim \lctx$.
    By applying the $\jrule{$\atmL{d}$-D}$ rule, we may deduce that $\adec{\octx \oc \atmL{d}}{n}$ and $\adec{\lctx \oc \atmL{d}}{n'}$.
    Moreover, because rewriting bisimilarity is a congruence~\parencref{??}, $\octx \oc \atmL{d} \osim \lctx \oc \atmL{d}$.
    By part~\ref{item:??} of the inductive hypothesis, we conclude that $n = n'$, as required.
  %
  \qedhere
  \end{enumerate}
  \end{itemize}
\end{proof}



% \begin{theorem}[Adequacy of binary counter decrements]
%   If $\adec{\octx}{n}$, then:
%   \begin{itemize}[nosep]
%   \item $\octx \Reduces \atmR{z}$ if, and only if, $n = 0$;
%   \item $\octx \Reduces \octx' \oc \atmR{s}$ for some $\octx'$ such that $\ainc{\octx'}{n-1}$, if $n > 0$; and
%   \item $\octx \Reduces \octx' \oc \atmR{s}$ only if $n > 0$ and $\ainc{\octx'}{n-1}$.
%   \end{itemize}
% \end{theorem}

% \begin{theorem}[Small-step adequacy of binary counter decrements]\leavevmode
%   \begin{thmdescription}
%   \item[Preservation]
%     If $\adec{\octx}{n}$ and $\octx \reduces \octx'$, then $\adec{\octx'}{n}$.
%   \item[Progress]
%     If $\adec{\octx}{n}$, then either:
%     \begin{itemize}[nosep]
%     \item $\octx \reduces \octx'$, for some $\octx'$;
%     \item $n = 0$ and $\octx = \atmR{z}$; or
%     \item $n > 0$ and $\octx = \octx' \oc \atmR{s}$, for some $\octx'$ such that $\ainc{\octx'}{n-1}$.\fixnote{Value instead of increment relation?}
%     \end{itemize}
%   \item[Termination]
%     If $\adec{\octx}{n}$, then every rewriting sequence from $\octx$ is finite.
%   \end{thmdescription}
% \end{theorem}


\subsection{A comment on atom directions and bisimilarity}

This \lcnamecref{thm:oo-counter-bisim} gives us the opportunity to remark on the interplay between atoms' directionality and rewriting bisimilarity.

Suppose that the formula-as-process ordered rewriting framework was designed without assigning direction to atoms.
Instead of the directional atoms $\atmL{a}$ and $\atmR{a}$, the framework would have only un(i)directional\fixnote{bidirectional?} atoms $\atm{a}$.
The definition of rewriting bisimilarity would also be ever so slightly revised to use the un(i)directed atoms.
Rewriting bisimilarity would be the largest symmetric relation $\simu{R}$ to satisfy:
\begin{description}[noitemsep]
\item[Output bisimulation]
  If $\octx \simu{R}\Reduces \atm{\lctx}'_L \oc \lctx' \oc \atm{\lctx}'_R$, then $\octx \Reduces\lrframe{\atm{\lctx}'_L}{\simu{R}}{\atm{\lctx}'_R} \atm{\lctx}'_L \oc \lctx' \oc \atm{\lctx}'_R$.
\item[Input bisimulation]
  If $\atm{\lctx}_L \oc \octx \oc \atm{\lctx}_R \lrframe{\atm{\lctx}_L}{\simu{R}}{\atm{\lctx}_R}\Reduces \lctx'$, then $\atm{\lctx}_L \oc \octx \oc \atm{\lctx}_R \Reduces\simu{R} \lctx'$.
\end{description}

Unfortunately, this un(i)directed notion of bisimilarity would be too fine.
Without atom directions to distinguish messages intended as inputs from those intended as outputs, input messages could be incorrectly observed as outputs.
In practice, this means that bisimilarity would rule out desirable equivalences.

Consider, for example, $\defp{e}$ and $\defp{e} \oc \defp{b}_0$.
These two counters have the same denotation -- both represent $0$.
Nevertheless, in opposition to \cref{thm:oo-counter-bisim} for directed atoms, $\defp{e}$ and $\defp{e} \oc \defp{b}_0$ would \emph{not} be bisimilar when using un(i)directed atoms.

To see why, suppose, for the sake of deriving a contradiction, that $\defp{e} \osim \defp{e} \oc \defp{b}_0$.
Because $\defp{e} \oc \defp{b}_0 \oc \atm{d} \Reduces \atm{z} \oc \defp{b}'_0$, it follows from the input bisimulation property that $\defp{e} \oc \atm{d} \Reduces\osim \atm{z} \oc \defp{b}'_0$.
There are only two contexts that can arise from $\defp{e} \oc \atm{d}$, so either $\defp{e} \oc \atm{d} \osim \atm{z} \oc \defp{b}'_0$ or $\atm{z} \osim \atm{z} \oc \defp{b}'_0$.
\begin{itemize}
\item The former is impossible because $\atm{z} \oc \defp{b}'_0$ cannot produce $\atm{d}$ on the right (nor on the left) and so violates output bisimilarity.

\item The latter is also impossible.
It has an output of $\atm{z}$ on the left of $\atm{z} \oc \defp{b}'_0$, from which the output bisimulation property yields $(\octxe) \osim \defp{b}'_0$.
From the input bisimulation property, $\atm{a} \osim \defp{b}'_0 \oc \atm{a}$ follows, for any atom $\atm{a}$.
And that violates output bisimulation because $\defp{b}'_0 \oc \atm{a}$, which does not reduce, cannot match the left output that $\atm{a}$ makes.
\end{itemize}

The key feature of this counterexample is that atoms' lack of direction means that the output bisimilarity condition also applies to atoms intended to act as inputs ($\atm{d}$ and $\atm{a}$, for instance).
Just as atom directions were used in \cref{??} to prevent a process from capturing a message it just sent, so do atom directions prevent \emph{input} messages from being observed.


% \subsection{An alternative specification of a binary counter}

% The above description of a binary counter, repeated here%
% \begin{marginfigure}
%   \begin{equation*}
%     \begin{lgathered}
%       e \defd (e \fuse b_1 \pmir \atmL{i}) \with (\atmR{z} \pmir \atmL{d}) \\
%       b_0 \defd (\up \dn b_1 \pmir \atmL{i}) \with (\atmL{d} \fuse b'_0 \pmir \atmL{d}) \\
%       b_1 \defd (\atmL{i} \fuse b_0 \pmir \atmL{i}) \with (b_0 \fuse \atmL{s} \pmir \atmL{d}) \\
%       b'_0 \defd (\atmR{z} \limp \atmR{z}) \with (\atmR{s} \limp b_1 \fuse \atmR{s})
%     \end{lgathered}
%   \end{equation*}
%   \caption{An object-oriented specification of a binary counter}
% \end{marginfigure}
% for convenience, could be described as object-oriented.
% Like objects, the processes $e$, $b_0$, and $b_1$ dispatch on incoming messages $\atmL{i}$ and $\atmL{d}$, and the process $b'_0$ dispatches on incoming messages $\atmR{z}$ and $\atmR{s}$.%
% \footnote{For a study of the relationship between (session-typed) processes and objects, see \textcite{Balzer+Pfenning:AGERE15}.}

% Alternatively, we could specify the binary counter in a dual way: like functions are applied to data, the processes $i$ and $d$ act on incoming messages $\atmR{e}$, $\atmR{b}_0$, and $\atmR{b}_1$, and the processes $z$ and $s$ act on incoming $\atmL{b}'_0$ messages.
% \begin{equation*}
%   \begin{lgathered}
%     i \defd (\atmR{e} \limp \atmR{e} \fuse \atmR{b}_1) \with (\atmR{b}_0 \limp \atmR{b}_1) \with (\atmR{b}_1 \limp i \fuse \atmR{b}_0) \\
%     d \defd (\atmR{e} \limp \up \dn z) \with (\atmR{b}_0 \limp d \fuse \atmL{b}'_0) \with (\atmR{b}_1 \limp \atmR{b}_0 \fuse s) \\
%     z \defd \up \dn z \pmir \atmL{b}'_0 \\
%     s \defd \atmR{b}_1 \fuse s \pmir \atmL{b}'_0
%   \end{lgathered}
% \end{equation*}
% In contrast with the earlier object-oriented specification, this specification could be described as functional in style.
% \begin{equation*}
%   \atmR{e} \oc \atmR{b}_1 \oc i \Reduces \atmR{e} \oc i \oc \atmR{b}_0 \Reduces \atmR{e} \oc \atmR{b}_1 \oc \atmR{b}_1
% \end{equation*}

% Intuitively, we should expect these two specifications to be equivalent descriptions of a binary counter.
% To make this equivalence concrete, we might imagine defining a binary relation $\simu{D}$ on binary counters that makes the duality precise;
% for example, $e \oc b_1 \oc \atmL{i} \simu{D} \atmR{e} \oc \atmR{b}_1 \oc i$.

% However, in defining the duality relation, we implicitly observe and compare the counters' internal structures.
% Although certainly possible at the meta-level, this is somewhat unsatisfying because it doesn't compare the counters' \emph{behaviors}.
% There ought to be a way to characterize the counters' equivalence using bisimilarity.

% Doing so requires a few small changes to 



% \section{Unary counter}

% \begin{equation*}
%   \begin{lgathered}
%     z \defd (z \fuse s \pmir \atmL{i}) \with (\atmR{z} \pmir \atmL{d}) \\
%     s \defd (s \fuse s \pmir \atmL{i}) \with (\atmR{s} \pmir \atmL{d})
%   \end{lgathered}
% \end{equation*}

% \begin{inferences}
%   \infer{\ainc{z}{0}}{}
%   \and
%   \infer{\ainc{\lctx \oc s}{n+1}}{
%     \ainc{\lctx}{n}}
%   \and
%   \infer{\ainc{\lctx \oc \atmL{i}}{n+1}}{
%     \ainc{\lctx}{n}}
%   \\
%   \infer{\ainc{z \fuse s}{1}}{}
%   \and
%   \infer{\ainc{\lctx \oc (s \fuse s)}{n+2}}{
%     \ainc{\lctx}{n}}
%   \\
%   \infer{\adec{\lctx \oc \atmL{d}}{n}}{
%     \ainc{\lctx}{n}}
%   \and
%   \infer{\adec{\atmR{z}}{0}}{}
%   \and
%   \infer{\adec{\lctx \oc \atmR{s}}{n+1}}{
%     \ainc{\lctx}{n}}
% \end{inferences}

% \begin{theorem}[Adequacy of unary counter increments]
%   If $\ainc{\lctx}{n}$, then $\lctx \Reduces\aval{}{n'}$ if, and only if, $n' = n+1$.
% \end{theorem}

% \begin{theorem}[Small-step adequacy of unary counter increments]\leavevmode
%   \begin{thmdescription}
%   \item[Preservation]
%     If $\ainc{\lctx}{n}$ and $\lctx \reduces \lctx'$, then $\ainc{\lctx'}{n}$.
%   \item[Progress]
%     If $\ainc{\lctx}{n}$, then either:
%     \begin{itemize}[nosep]
%     \item $\lctx \reduces \lctx'$, for some $\lctx'$; or
%     \item $\lctx \nreduces$ and $\aval{\lctx}{n}$.
%     \end{itemize}
%   \item[Termination]
%     If $\ainc{\lctx}{n}$, then every rewriting sequence from $\lctx$ is finite.
%   \end{thmdescription}
% \end{theorem}

% \begin{theorem}[Adequacy of unary counter decrements]
%   If $\adec{\lctx}{n}$, then:
%   \begin{itemize}[nosep]
%   \item $\lctx \Reduces \atmR{z}$ if, and only if, $n = 0$;
%   \item $\lctx \Reduces \lctx' \oc \atmR{s}$ for some $\lctx'$ such that $\ainc{\lctx'}{n-1}$, if $n > 0$; and
%   \item $\lctx \Reduces \lctx' \oc \atmR{s}$ only if $n > 0$ and $\ainc{\lctx'}{n-1}$.
%   \end{itemize}
% \end{theorem}

% \begin{theorem}[Small-step adequacy of unary counter decrements]\leavevmode
%   \begin{thmdescription}
%   \item[Preservation]
%     If $\adec{\lctx}{n}$ and $\lctx \reduces \lctx'$, then $\adec{\lctx'}{n}$.
%   \item[Progress]
%     If $\adec{\lctx}{n}$, then either:
%     \begin{itemize}[nosep]
%     \item $\lctx \reduces \lctx'$, for some $\lctx'$;
%     \item $n = 0$ and $\lctx = \atmR{z}$; or
%     \item $n > 0$ and $\lctx = \lctx' \oc \atmR{s}$, for some $\lctx'$ such that $\ainc{\lctx'}{n-1}$.\fixnote{Value instead of increment relation?}
%     \end{itemize}
%   \item[Termination]
%     If $\adec{\lctx}{n}$, then every rewriting sequence from $\lctx$ is finite.
%   \end{thmdescription}
% \end{theorem}


% % \begin{lemma}\leavevmode
% %   \begin{itemize}[nosep]
% % %  \item If $\ainc{\lctx}{0}$, then $\lctx = z$.
% % %  \item If $\ainc{\lctx}{n+1}$, then $\lctx \Reduces \lctx' \oc s$ for some $\ainc{\lctx'}{n}$.
% %   \item If $\adec{\lctx}{0}$, then $\lctx \Reduces \atmR{z}$.
% %   \item If $\adec{\lctx}{n+1}$, then $\lctx \Reduces \lctx' \oc \atmR{s}$ for some $\ainc{\lctx'}{n}$.
% % %   \end{itemize}
% % % \end{lemma}

% % % \begin{lemma}\leavevmode
% % %   \begin{itemize}[nosep]
% % %  \item If $\ainc{\octx}{0}$, then either $\octx = e$ or $\octx = \octx' \oc b_0$ for some $\ainc{\octx'}{0}$.
% % %  \item If $\ainc{\octx}{2n} > 0$, then $\octx \Reduces \octx' \oc b_0$ for some $\ainc{\octx'}{n}$.
% % %  \item If $\ainc{\octx}{2n+1}$, then $\octx \Reduces \octx' \oc b_1$ for some $\ainc{\octx'}{n}$.
% %   % \item If $\adec{\octx}{0}$, then $\octx \Reduces \atmR{z}$.
% %   % \item If $\adec{\octx}{n+1}$, then $\octx \Reduces \octx' \oc \atmR{s}$ for some $\ainc{\octx'}{n}$.
% %   \end{itemize}
% % \end{lemma}

% \begin{theorem}[Bisimilarity of counters]\leavevmode
%   \begin{itemize}[nosep]
%   \item If $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$, then $\octx \osim \lctx$.
%   \item If $\adec{\octx}{n}$ and $\adec{\lctx}{n}$, then $\octx \osim \lctx$.
%   \end{itemize}
% \end{theorem}
% \begin{proof}
%   Let $\simu{R}$ be the symmetric closure of $\Set{(\octx, \lctx) \given \exists n.\, (\ainc{\octx}{n}) \land (\ainc{\lctx}{n})} \union \Set{(\octx, \lctx) \given \exists n.\, (\adec{\octx}{n}) \land (\adec{\lctx}{n})} \union \Set{(\octxe, \octxe)}$.
%   We will show that $\simu{R}$ is a labeled bisimulation.
%   \begin{description}
%   \item[Immediate output bisimulation]
%     \begin{itemize}
%     \item Consider the case in which $\adec{\octx}{0}$ and $\adec{\atmR{z}}{0}$.
%       By \cref{??}, $\octx \Reduces \atmR{z}$.
%       It follows that $\octx \Reduces\rframe{\simu{R}}{\atmR{z}} \atmR{z}$, as required.
%     \item Consider the case in which $\adec{\octx}{n+1}$ and $\adec{\lctx \oc \atmR{s}}{n+1}$ because $\ainc{\lctx}{n}$.
%       By \cref{??}, $\octx \Reduces \octx' \oc \atmR{s}$ for some $\ainc{\octx'}{n}$.
%       It follows that $\octx \Reduces\rframe{\simu{R}}{\atmR{s}} \lctx \oc \atmR{s}$, as required.
%     \item Consider the case in which $\adec{\atmR{z}}{0}$ and $\adec{\lctx}{0}$.
%       By \cref{??}, $\lctx \Reduces \atmR{z}$.
%       It follows that $\lctx \Reduces\rframe{\simu{R}}{\atmR{z}} \atmR{z}$, as required.
%     \item Consider the case in which $\adec{\octx \oc \atmR{s}}{n+1}$ and $\adec{\lctx}{n+1}$ because $\ainc{\octx}{n}$.
%       By \cref{??}, $\lctx \Reduces \lctx' \oc \atmR{s}$ for some $\ainc{\lctx'}{n}$.
%       It follows that $\lctx \Reduces\rframe{\simu{R}}{\atmR{s}} \octx \oc \atmR{s}$, as required.
%     \end{itemize}

%   \item[Immediate input bisimulation]
%     \begin{itemize}
%     \item Consider the case in which $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$ and $\ireduces{#1 \oc \atmL{i}}{\lctx}{\lctx'}$.
%       Notice that $\ainc{\lctx \oc \atmL{i}}{n+1}$ and $\lctx \oc \atmL{i} \reduces \lctx'$; by preservation \parencref{??}, $\ainc{\lctx'}{n+1}$.
%       It is then trivial that $\octx \oc \atmL{i} \Reduces\simu{R} \lctx'$, as required.
%     \item Consider the case in which $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$ and $\ireduces{#1 \oc \atmL{d}}{\lctx}{\lctx'}$.
%       Notice that $\adec{\lctx \oc \atmL{d}}{n}$ and $\lctx \oc \atmL{d} \reduces \lctx'$; by preservation \parencref{??}, $\adec{\lctx'}{n}$.
%       It is then trivial that $\octx \oc \atmL{d} \Reduces\simu{R} \lctx'$, as required.
%     \end{itemize}

%   \item[Reduction bisimulation]
%     \begin{itemize}
%     \item Consider the case in which $\ainc{\octx}{n}$ and $\ainc{\lctx}{n}$ and $\lctx \reduces \lctx'$.
%       By preservation \parencref{??}, $\ainc{\lctx'}{n}$.
%       It is then trivial that $\octx \Reduces\simu{R} \lctx'$, as required.
%     \item Consider the case in which $\adec{\octx}{n}$ and $\adec{\lctx}{n}$ and $\lctx \reduces \lctx'$.
%       In this case, the proof is similar to the above increment case.
%     \item Consider the cases in which a binary counter $\octx$ reduces; these are analogous to the previous cases involving a unary counter that reduces.
%     \end{itemize}

%   \item[Emptiness bisimulation]
%     The only case involving empty contexts is that of $\octxe \simu{R} \octxe$.
%     In this case, indeed $\atmR{\lctx} \Reduces\rframe{\simu{R}}{\atmR{\lctx}} \atmR{\lctx}$ for all $\atmR{\lctx}$, and, symmetrically, $\atmL{\lctx} \Reduces\lframe{\atmL{\lctx}}{\simu{R}} \atmL{\lctx}$ for all $\atmL{\lctx}$.
%   \end{description}

%   % \begin{description}
%   % \item[Immediate output]
%   %   Vacuous
%   % \item[Immediate input] 
%   %   \begin{itemize}
%   %   \item Suppose that $\ainc{e}{0}$ and $\ainc{z}{0}$.
%   %     \begin{itemize}
%   %     \item Suppose that $\ireduces{#1 \oc \atmL{i}}{e}{e \fuse b_1}$.
%   %       $z \oc \atmL{i} \Reduces \ainc{z \oc s}{1}$.
%   %       Symmetrically involving transition on $z$.
%   %     \item Suppose that $\ireduces{#1 \oc \atmL{d}}{e}{\atmR{z}}$.
%   %       $z \oc \atmL{d} \Reduces \adec{\atmR{z}}{0}$.
%   %       Symmetrically.
%   %     \end{itemize}
%   %   \item $\ainc{\octx \oc b_0}{0}$ and$\ainc{z}{0}$
%   %     \begin{itemize}
%   %     \item $\octx \oc b_1$ and $z \fuse s$
%   %     \item $\octx \oc (d \fuse b'_0)$ and $\atmR{z}$
%   %     \end{itemize}
%   %   \end{itemize}
%   % \item[Reduction] 
%   %   Preservation
%   % \item[Emptiness] 
%   %   Vacuous
%   % \end{description}

%   % \begin{description}
%   % \item[Immediate output]
%   %   \begin{itemize}
%   %   \item $\atmR{z}$ and $\atmR{z}$
%   %   \item $\octx \oc \atmR{s}$ and $\lctx \oc \atmR{s}$
%   %   \end{itemize}
%   % \item[Immediate input] 
%   %   Vacuous
%   % \item[Reduction] 
%   %   Preservation
%   % \item[Emptiness] 
%   %   Vacuous
%   % \end{description}
% \end{proof}


% \section{Without using the adequacy relations}

% \begin{inferences}
%   \infer{e \simu{R}_v z}{}
%   \and
%   \infer{\octx \oc b_0 \simu{R}_v \lctx}{
%     \octx \simu{R}_v\simu{D} \lctx}
%   \and
%   \infer{\octx \oc b_1 \simu{R}_v \lctx \oc s}{
%     \octx \simu{R}_v\simu{D} \lctx}
%   \\
%   \infer{z \simu{D} z}{}
%   \and
%   \infer{\lctx \oc s \simu{D} \lctx' \oc s \oc s}{
%     \lctx \simu{D} \lctx'}
% \end{inferences}

% \begin{inferences}
%   \infer{e \simu{R}_i z}{}
%   \and
%   \infer{\octx \oc b_0 \simu{R}_i \lctx}{
%     \octx \simu{R}_i\simu{D} \lctx}
%   \and
%   \infer{\octx \oc b_1 \simu{R}_i \lctx \oc s}{
%     \octx \simu{R}_i\simu{D} \lctx}
%   \and
%   \infer{\octx \oc \atmL{i} \simu{R}_i \lctx \oc s}{
%     \octx \simu{R}_i \lctx}
%   \\
%   \infer{e \fuse b_1 \simu{R}_i \lctx}{
%     e \oc b_1 \simu{R}_i \lctx}
%   \and
%   \infer{\octx \oc (\atmL{i} \fuse b_0) \simu{R}_i \lctx}{
%     \octx \oc \atmL{i} \oc b_0 \simu{R}_i \lctx}
%   \\
%   \infer{\octx \simu{R}_i z \fuse s}{
%     \octx \simu{R}_i z \oc s}
%   \and
%   \infer{\octx \simu{R}_i \lctx \oc (s \fuse s)}{
%     \octx \simu{R}_i \lctx \oc s \oc s}
% \end{inferences}

% \begin{inferences}
%   \infer{\octx \oc \atmL{d} \simu{R}_d \lctx \oc \atmL{d}}{
%     \octx \simu{R}_i \lctx}
%   \and
%   \infer{\atmR{z} \simu{R}_d \atmR{z}}{}
%   \and
%   \infer{\octx \oc \atmR{s} \simu{R}_d \lctx \oc \atmR{s}}{
%     \octx \simu{R}_i \lctx}
%   \and
%   \infer{\octx \oc b'_0 \simu{R}_d \lctx}{
%     \octx \simu{R}_d\simu{D}_d \lctx}
%   \\
%   \infer{\octx \oc (\atmL{d} \fuse b'_0) \simu{R}_d \lctx}{
%     \octx \oc \atmL{d} \oc b'_0 \simu{R}_d \lctx}
%   \and
%   \infer{\octx \oc (b_1 \fuse \atmR{s}) \simu{R}_d \lctx}{
%     \octx \oc b_1 \oc \atmR{s} \simu{R}_d \lctx}
%   \and
%   \infer{\octx \oc (b_0 \fuse \atmR{s}) \simu{R}_d \lctx}{
%     \octx \oc b_0 \oc \atmR{s} \simu{R}_d \lctx}
% \end{inferences}

% \begin{inferences}
%   \infer{\atmR{z} \simu{D}_d \atmR{z}}{}
%   \and
%   \infer{\lctx \oc \atmR{s} \simu{D}_d \lctx' \oc s \oc \atmR{s}}{
%     \lctx \simu{D} \lctx'}
% \end{inferences}

% \begin{description}
% \item[Immediate output bisimulation]
%   Consider the case in which 
% \end{description}


% \begin{description}
% \item[Immediate input]
%   \begin{itemize}
%   \item $z \oc \atmL{i} \Reduces\simu{R} e \fuse b_1$
%   \item $\lctx \oc \atmL{i} \Reduces\simu{R} \octx \oc b_1$ when $\octx \simu{R}\simu{D} \lctx$
%   \item $\lctx \oc s \oc \atmL{i} \Reduces\simu{R} \octx \oc (\atmL{i} \fuse b_0)$ when $\octx \simu{R}\simu{D} \lctx$
%   \item $e \oc \atmL{i} \Reduces\simu{R} z \fuse s$
%   \item $\octx \oc b_0 \oc \atmL{i} \Reduces\simu{R} z \fuse s$ when $\octx \simu{R} z$
%   \item $\octx \oc b_0 \oc \atmL{i} \Reduces\simu{R} \lctx \oc s \oc (s \fuse s)$ when $\octx \simu{R}\simu{D} \lctx \oc s \oc s$
%   \item $\octx \oc b_1 \oc \atmL{i} \Reduces\simu{R} \lctx \oc (s \fuse s)$ when $\octx \simu{R}\simu{D} \lctx$.
%     In the case, $\octx \oc \atmL{i} \oc b_0 \simu{R} \lctx \oc s \oc s$.
%   \end{itemize}
% \item[Reduction] 
%   \begin{itemize}
%   \item $\lctx \Reduces\simu{R} \octx' \oc b_0$ when $\lctx \simu{D}^{-1}\Reduces\simu{R} \octx'$
%   \item $\lctx \oc s \Reduces\simu{R} \octx' \oc b_1$ when $\lctx \simu{D}^{-1}\Reduces\simu{R} \octx'$
%   \item $\lctx \oc s \Reduces\simu{R} \octx' \oc \atmL{i}$ when $\lctx \Reduces\simu{R} \octx'$
%   \item $\lctx \Reduces\simu{R} e \oc b_1$ when $\lctx \simu{R} e \oc b_1$
%   \item $z \fuse s \Reduces\simu{R} \octx'$ when $z \oc s \Reduces\simu{R} \octx'$
%   \item $\octx \oc b_0 \Reduces\simu{R} \lctx'$ when $\octx \simu{R}\simu{D}\reduces \lctx'$
%   \item $\octx \oc b_1 \Reduces\simu{R} \lctx'$ when $\octx \simu{R}\simu{D}\reduces \lctx'$
%   \item $\octx \oc \atmL{i} \Reduces\simu{R} \lctx' \oc s$ when $\octx \Reduces\simu{R} \lctx'$
%   \item $e \fuse b_1 \Reduces\simu{R} \lctx'$ when $e \oc b_1 \Reduces\simu{R} \lctx'$
%   \item $\octx \oc (\atmL{i} \fuse b_0) \Reduces\simu{R} \lctx'$ when $\octx \oc \atmL{i} \oc b_0 \Reduces\simu{R} \lctx'$
%   \item $\octx \Reduces\simu{R} z \oc s$ when $\octx \simu{R} z \oc s$
%   \item $\octx \Reduces\simu{R} \lctx' \oc (s \fuse s)$ when $\octx \Reduces\simu{R} \lctx' \oc s \oc s$
%   \item $\octx \Reduces\simu{R} \lctx \oc s \oc s$ when $\octx \simu{R} \lctx \oc s \oc s$
%   \end{itemize}
% \end{description}


% \begin{equation*}
%   \begin{lgathered}
%     c \defd (i \fuse c \pmir \atmL{i}) \with (d \fuse \atmL{u} \pmir \atmL{d}) \\
%     z \defd (\up \dn z \pmir \atmL{b}'_0) \with (\atmR{z} \pmir \atmL{u}) \\
%     s \defd (\atmR{b}_1 \fuse s \pmir \atmL{b}'_0) \with (c \fuse \atmR{s} \pmir \atmL{u})
%   \end{lgathered}
% \end{equation*}

% \begin{inferences}
%   \infer{\iainc{\atmR{e}}{0}}{}
%   \and
%   \infer{\iainc{\lctx \oc \atmR{b}_0}{2n}}{
%     \iainc{\lctx}{n}}
%   \and
%   \infer{\iainc{\lctx \oc \atmR{b}_1}{2n+1}}{
%     \iainc{\lctx}{n}}
%   \and
%   \infer{\iainc{\lctx \oc i}{n+1}}{
%     \iainc{\lctx}{n}}
%   \\
%   \infer{\iainc{\atmR{e} \fuse \atmR{b}_1}{1}}{}
%   \and
%   \infer{\iainc{\lctx \oc (i \fuse \atmR{b}_0)}{2(n+1)}}{
%     \iainc{\lctx}{n}}
% \end{inferences}

% \begin{inferences}
%   \infer{\eainc{\lctx \oc c}{n}}{
%     \iainc{\lctx}{n}}
%   \and
%   \infer{\eainc{\lctx \oc \atmL{i}}{n+1}}{
%     \eainc{\lctx}{n}}
%   \and
%   \infer{\eainc{\lctx \oc (i \fuse c)}{n+1}}{
%     \iainc{\lctx}{n}}
% \end{inferences}

% \begin{theorem}[small-step adequacy of increments]
%   \leavevmode
%   \begin{thmdescription}
%   \item[Value soundness]

%   \item[Preservation]
%     If $\eainc{\lctx}{n}$ and $\lctx \reduces \lctx'$, then $\eainc{\lctx'}{n}$.

%   \item[Progress]
%     If $\eainc{\lctx}{n}$, then either:
%     \begin{itemize*}
%     \item $\lctx \reduces \lctx'$, for some $\lctx'$; or
%     \item $\eaval{\lctx}{n}$.
%     \end{itemize*}

%   \item[Termination]
%     If $\eainc{\lctx}{n}$, then every rewriting sequence from $\lctx$ is finite.
%   \end{thmdescription}
% \end{theorem}

% \begin{inferences}
%   \infer{\iadec{\lctx \oc d}{n}}{
%     \iainc{\lctx}{n}}
%   \and
%   \infer{\iadec{\lctx \oc \atmL{b}'_0}{2n}}{
%     \iadec{\lctx}{n}}
%   \and
%   \infer{\iadec{z}{0}}{}
%   \and
%   \infer{\iadec{\lctx \oc s}{n+1}}{
%     \iainc{\lctx}{n}}
%   \\
%   \infer{\iadec{\lctx \oc (d \fuse \atmL{b}'_0)}{2n}}{
%     \iainc{\lctx}{n}}
%   \and
%   \infer{\iadec{\lctx \oc (\atmR{b}_0 \fuse s)}{2n+1}}{
%     \iainc{\lctx}{n}}
%   \and
%   \infer{\iadec{\lctx \oc (\atmR{b}_1 \fuse s)}{2n+2}}{
%     \iainc{\lctx}{n}}
% \end{inferences}

% \begin{inferences}
%   \infer{\eadec{\lctx \oc \atmL{d}}{n}}{
%     \eainc{\lctx}{n}}
%   \and
%   \infer{\eadec{\lctx \oc \atmL{u}}{n}}{
%     \iadec{\lctx}{n}}
%   \and
%   \infer{\eadec{\atmR{z}}{0}}{}
%   \and
%   \infer{\eadec{\lctx \oc c \oc \atmR{s}}{n+1}}{
%     \iainc{\lctx}{n}}
%   \\
%   \infer{\eadec{\lctx \oc (d \fuse \atmL{u})}{n}}{
%     \iainc{\lctx}{n}}
%   \and
%   \infer{\eadec{\lctx \oc (c \fuse \atmR{s})}{n+1}}{
%     \iainc{\lctx}{n}}
% \end{inferences}


% \begin{theorem}[Small-step adequacy of decrements]
%   \leavevmode
%   \begin{thmdescription}
%   \item[Preservation]
%     If $\eadec{\lctx}{n}$ and $\lctx \reduces \lctx'$, then $\eadec{\lctx'}{n}$.

%   \item[Progress]
%     If $\eadec{\lctx}{n}$, then either:
%     \begin{itemize}[nosep]
%     \item $\lctx \reduces \lctx'$ for some $\lctx'$;
%     \item $n = 0$ and $\lctx = \atmR{z}$;
%     \item $n > 0$ and $\lctx = \lctx' \oc c \oc \atmR{s}$, for some $\lctx'$ such that $\iainc{\lctx'}{n-1}$.
%     \end{itemize}

%   \item[Termination]
%     If $\eadec{\lctx}{n}$, then every rewriting sequence from $\lctx$ is finite.
%   \end{thmdescription}
% \end{theorem}

% \begin{theorem}[Big-step adequacy of decrements]
%   If $\eadec{\lctx}{n}$, then:
%   \begin{itemize}[nosep]
%   \item $\lctx \Reduces \atmL{\lctx}'_L \oc \lctx' \oc \atmR{\lctx}'_R$ only if either: $\atmL{\lctx}'_L = \atmR{\lctx}'_R = \octxe$; or $n = 0$ and $\atmL{\lctx}'_L = \octxe$ and $\atmR{\lctx}'_R = \atmR{z}$; or $n > 0$ and $\atmL{\lctx}'_L = \octxe$ and $\atmR{\lctx}'_R = \atmR{s}$;
%   \item $\lctx \Reduces \atmR{z}$ if $n = 0$;
%   \item $\lctx \Reduces \lctx' \oc c \oc \atmR{s}$ for some $\lctx'$ such that $\iainc{\lctx'}{n-1}$, if $n > 0$; and 
%   \item $\lctx \Reduces \lctx' \oc \atmR{s}$ only if $n > 0$ and $\lctx' = \lctx' \oc c$ for some $\lctx'$ such that $\iainc{\lctx'}{n-1}$.
%   \end{itemize}
% \end{theorem}

% \begin{theorem}[Big-step adequacy of decrements]
%   If $\eadec{\lctx}{n}$, then:
%   \begin{itemize}[nosep]
%   \item $\lctx \Reduces \atmR{z}$ if, and only if, $n = 0$;
%   \item $\lctx \Reduces \lctx' \oc c \oc \atmR{s}$ for some $\lctx'$ such that $\iainc{\lctx'}{n-1}$, if $n > 0$; and 
%   \item $\lctx \Reduces \lctx' \oc \atmR{s}$ only if $n > 0$ and $\lctx' = \lctx' \oc c$ for some $\lctx'$ such that $\iainc{\lctx'}{n-1}$.
%   \end{itemize}
% \end{theorem}

% \begin{theorem}
%   If $\ainc{\octx}{n}$ and $\eainc{\lctx}{n'}$, then $\octx \osim \lctx$ if, and only if, $n = n'$.
%   Similarly, if $\adec{\octx}{n}$ and $\eadec{\lctx}{n'}$, then $\octx \osim \lctx$ if, and only if, $n = n'$.
% \end{theorem}

% \begin{proof}
%   \begin{itemize}
%   \item
%     $\adec{\octx}{0}$ and $\eadec{\atmR{z}}{0}$.
%     $\octx \Reduces \atmR{z}$
%   \item 
%     $\adec{\octx}{n+1}$ and $\eadec{\lctx \oc c \oc \atmR{s}}{n+1}$.
%     $\octx \Reduces \octx' \oc \atmR{s}$ and $\ainc{\octx'}{n}$.
%     $\octx' \simu{R} \lctx \oc c$
%   \end{itemize}
% \end{proof}


% \begin{theorem}\leavevmode
% \begin{itemize}[nosep]
% \item If $\ainc{\octx}{n}$ and $\eainc{\lctx}{n}$, then $\octx \osim \lctx$.
% \item If $\adec{\octx}{n}$ and $\eadec{\lctx}{n}$, then $\octx \osim \lctx$.
% \end{itemize}
% \end{theorem}
% %
% \begin{proof}
%   \begin{description}
%   \item[Immediate output bisimulation]
%     \begin{itemize}
%     \item Consider the case in which $\adec{\octx}{0}$ and $\eadec{\atmR{z}}{0}$.
%       By decrement adequacy, $\octx \Reduces \atmR{z}$.
%       It is trivial that $\octx \Reduces\rframe{\simu{R}}{\atmR{z}} \atmR{z}$.

%     \item Consider the case in which $\adec{\octx}{n+1}$ and $\eadec{\lctx \oc p \oc \atmR{s}}{n+1}$ where $\iainc{\lctx}{n}$.
%       By decrement adequacy, $\octx \Reduces \octx' \oc \atmR{s}$ for some $\ainc{\octx'}{n}$.
%       Notice that $\eainc{\lctx \oc p}{n}$.
%       It follows that $\octx \Reduces\rframe{\simu{R}}{\atmR{s}} \lctx \oc p \oc \atmR{s}$.
      
%     \item Consider the case in which $\adec{\atmR{z}}{0}$ and $\eadec{\lctx}{0}$.
%       By decrement adequacy, $\lctx \Reduces \atmR{z}$.
%       It is trivial that $\lctx \Reduces\rframe{\simu{R}}{\atmR{z}} \atmR{z}$.

%     \item
%       Consider the case in which $\adec{\octx' \oc \atmR{s}}{n+1}$ because $\ainc{\octx'}{n}$ and $\eadec{\lctx}{n+1}$.
%       By decrement adequacy, $\lctx \Reduces \lctx' \oc p \oc \atmR{s}$ for some $\iainc{\lctx'}{n}$.
%       Notice that $\eainc{\lctx' \oc p}{n}$.
%       It follows that $\lctx \Reduces\rframe{\simu{R}}{\atmR{s}} \octx' \oc \atmR{s}$.
%     \end{itemize}
%   \item[Immediate input bisimulation]
%     \begin{itemize}
%     \item Consider the case in which $\ainc{\octx}{n}$ and $\eainc{\lctx}{n}$ and $\ireduces{#1 \oc \atmL{i}}{\lctx}{\lctx'}$.
%       Notice that $\eainc{\lctx \oc \atmL{i}}{n+1}$ and $\lctx \oc \atmL{i} \reduces \lctx'$;
%       by preservation\parencref{??}, $\eainc{\lctx'}{n+1}$.
%       Also, notice that $\ainc{\octx \oc \atmL{i}}{n+1}$, so it is trivial that $\octx \oc \atmL{i} \Reduces\simu{R} \lctx'$, as required.
%       %
%     \item Consider the case in which $\ainc{\octx}{n}$ and $\eainc{\lctx}{n}$ and $\ireduces{#1 \oc \atmL{i}}{\octx}{\octx'}$.
%       Notice that $\ainc{\octx \oc \atmL{i}}{n+1}$ and $\octx \oc \atmL{i} \reduces \octx'$;
%       by preservation\parencref{??}, $\ainc{\octx'}{n+1}$.
%       Also, notice that $\ainc{\lctx \oc \atmL{i}}{n+1}$, so it is trivial that $\lctx \oc \atmL{i} \Reduces\simu{R} \octx'$, as required.
%     \end{itemize}

%   \item[Reduction bisimulation]
%     \begin{itemize}
%     \item Consider the case in which $\ainc{\octx}{n}$ and $\eainc{\lctx}{n}$ and $\lctx \reduces \lctx'$.
%       By preservation\parencref{??}, $\eainc{\lctx'}{n}$.
%       So it is trivial that $\octx \Reduces\simu{R} \lctx'$, as required.
%       %
%     \item Consider the case in which $\ainc{\octx}{n}$ and $\eainc{\lctx}{n}$ and $\octx \reduces \octx'$.
%       By preservation\parencref{??}, $\eainc{\octx'}{n}$.
%       So it is trivial that $\lctx \Reduces\simu{R} \octx'$, as required.
%       %
%     \end{itemize}
%   \end{description}
% \end{proof}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "thesis"
%%% End:
