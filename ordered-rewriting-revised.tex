\chapter{Ordered rewriting}\label{ch:ordered-rewriting}

In the previous \lcnamecref{ch:string-rewriting}, we reviewed a framework for string rewriting specifications of concurrent systems.
In terms of the primitive operations on strings that it supports, that framework is rather spartan, containing only concatenation and its unit.

Over this \lcnamecref{ch:ordered-rewriting} and the next, we increase the expressive power of string rewriting by 


In this \lcnamecref{ch:ordered-rewriting}, we develop a rewriting interpretation of the ordered sequent calculus from the previous \lcnamecref{ch:ordered-logic}.

In \citeyear{Lambek:AMM58}, \citeauthor{Lambek:AMM58} developed a syntactic calculus, now known as the Lambek calculus, for formally describing the structure of sentences.\autocite{Lambek:AMM58}
Words are assigned syntactic types, which roughly correspond to grammatical parts of speech.
From a logical perspective, the Lambek calculus can [also] be viewed as a precursor to (and generalization of) \citeauthor{Girard:TCS87}'s linear logic\autocite{Girard:TCS87}\relax.\autocites{Polakow+Pfenning:MFPS99}{Polakow+Pfenning:TLCA99}
Implicit in \citeauthor{Lambek:AMM58}'s original article is a third perspective of the calculus: string rewriting.

In this \lcnamecref{ch:ordered-rewriting}, we review the Lambek calculus from a [string] rewriting perspective.

\newthought{The previous \lcnamecref{ch:string-rewriting}} showed how to use string rewriting to specify, on a global level, the [...] of concurrent systems that have a linear topology.
Although useful for [...], these string rewriting specifications lack a clear notion of local, decentralized execution -- for each step of rewriting, the entire string is rewritten as a monolithic whole by a central conductor.

Keeping in mind our ultimate goal of decentralized\fixnote{distributed?} implementations of concurrent systems, these string rewriting specifications are too abstract.
Instead, we need to expose local interactions that are left implicit in the string rewriting specifications.

As an example, recall from \cref{ch:string-rewriting} the string rewriting specification of a system that may transform strings that end with $b$ into the empty string:
\begin{equation}
  \infer{a \oc b \reduces b}{}
  \qquad
  \infer{b \reduces \octxe}{}
  \:.
\end{equation}
This specification is non-local in two ways:
the central conductor must identify those substrings that can be rewritten according to one of the axioms.
In the [...] axiom, for example, there is no description of how the symbols $a$ and $b$ would identify each other and coordinate to effect a rewriting to $b$.

To [...], we introduce \vocab{choreographies}, which refine string rewriting specifications by consistently assigning each symbol one of two roles: message or process.
\begin{equation*}
  \infer{\atmR{a} \oc \proc{b} \reduces \proc{b}}{}
  \qquad\text{and}\qquad
  \infer{\proc{b} \reduces \octxe}{}
\end{equation*}

a recursively defined ordered proposition, such as
\begin{equation*}
  \proc{b} \defd (\atmR{a} \limp \up \dn \proc{b}) \with \one
\end{equation*}
for the process $\proc{b}$.

The remainder of this \lcnamecref{ch:ordered-rewriting} presents a formulation of the Lambek calculus from the ordered sequent calculus of \cref{ch:ordered-logic}.

Then, in 


One valid choreography for this specification views each symbol $b$ as a process that nondeterministically receives some number of messages $a$ before terminating.

If we annotate messages with an underbar and processes with a circumflex, then $\atm{a} \oc \hat{b} \reduces \hat{b}$ and $\hat{b} \reduces \octxe$.


\section{Ordered resource decomposition as rewriting}

\subsection{Most left rules decompose ordered resources}

Recall two of the ordered sequent calculus's left rules, the $\lrule{\fuse}$ and $\lrule{\with}_1$ rules shown in the margin.%
\marginnote{%
\begin{gather*}
  \infer[\lrule{\fuse}]{\oseq{\octx'_L \oc (A \fuse B) \oc \octx'_R |- C}}{
    \oseq{\octx'_L \oc A \oc B \oc \octx'_R |- C}}
  \\\text{and}\hphantom{\lrule{\with}_1}\\
  \infer[\lrule{\with}_1]{\oseq{\octx'_L \oc (A \with B) \oc \octx'_R |- C}}{
    \oseq{\octx'_L \oc A \oc \octx'_R |- C}}
  % \,.
\end{gather*}}
Both rules decompose the principal resource: in the $\lrule{\fuse}$ rule, $A \fuse B$ into the separate resources $A \oc B$; and, in the $\lrule{\with}_1$ rule, $A \with B$ into $A$.
However, in both cases, the resource decomposition is somewhat obscured by boilerplate.
The framed contexts $\octx'_L$ and $\octx'_R$ and goal $C$ serve to enable the rules to be applied anywhere in the list of resources, without restriction;
these concerns are not specific to the $\lrule{\fuse}$ and $\lrule{\with}_1$ rules, but are general boilerplate that arguably should be factored out.
Let us develop a variant of the sequent calculus that factors out this boilerplate.

To decouple the resource decomposition from the surrounding boilerplate, we will introduce a new judgment, $\octx \reduces \octx'$, meaning \enquote{Resources $\octx$ may be decomposed into resources $\octx'$.}
The choice of notation for this judgment is not coincidental:
resource decomposition is, in some dimensions\fixnote{Is this enough of a qualifier?}, a generalization of the string rewriting shown in \cref{ch:string-rewriting}.

% With this judgment in hand, the boilerplate can be factored into a uniform left rule, $\lrule{\star}$:
With this new decomposition judgment comes a cut principle, $\jrule{CUT}^{\reduces}$, into which all of the boilerplate is factored:
\begin{equation*}
  \infer[\jrule{CUT}\smash{^{\reduces}}]{\oseq{\octx'_L \oc \octx \oc \octx'_R |- C}}{
    \octx \reduces \octx' &
    \oseq{\octx'_L \oc \octx' \oc \octx'_R |- C}}
  .
\end{equation*}
Using this cut principle, the standard left rules can then be recovered from resource decomposition rules.
For example, the decomposition of $A \fuse B$ into $A \oc B$ is captured by
\begin{equation*}
  \infer[\jrule{$\fuse$D}]{A \fuse B \reduces A \oc B}{}
  \,,
\end{equation*}
and the standard $\lrule{\fuse}$ rule can then be recovered as shown in the adjacent \lcnamecref{fig:ordered-rewriting:fuse-refactoring}.%
\begin{marginfigure}
  \begin{equation*}
    \begin{gathered}[t]
      \infer[\mathrlap{\lrule{\fuse}}]{\oseq{\octx'_L \oc (A \fuse B) \oc \octx'_R |- C}}{
        \oseq{\octx'_L \oc A \oc B \oc \octx'_R |- C}}
      % 
      \\\leftrightsquigarrow\\
      % 
      \infer[\mathrlap{\jrule{CUT}\smash{^{\reduces}}}]{\oseq{\octx'_L \oc (A \fuse B) \oc \octx'_R |- C}}{
        \infer[\jrule{$\fuse$D}]{A \fuse B \reduces A \oc B}{} &
        \oseq{\octx'_L \oc A \oc B \oc \octx'_R |- C}}
    \end{gathered}
    \phantom{\jrule{CUT}\smash{^{\reduces}}}
  \end{equation*}
  \caption{Refactoring the $\lrule{\fuse}$ rule in terms of resource decomposition}\label{fig:ordered-rewriting:fuse-refactoring}
\end{marginfigure}
The left rules for $\one$ and $A \with B$ can be similarly refactored into the resource decomposition rules
\begin{inferences}
  \infer[\jrule{$\one$D}]{\one \reduces \octxe}{}
  \and
  \infer[\jrule{$\with$D}_1]{A \with B \reduces A}{}
  \and\text{and}\and
  \infer[\jrule{$\with$D}_2]{A \with B \reduces B}{}
  \,.
\end{inferences}

Even the left rules for left- and right-handed implications can be refactored in this way, despite the additional, minor premises that those rules carry.
To keep the correspondence between resource decomposition rules and left rules as close as possible, we could introduce the decomposition rules
\begin{equation}\label{eq:ordered-rewriting:limp-pmir-decomposition}
  \infer[\jrule{$\limp$D}']{\octx \oc (A \limp B) \reduces B}{
    \oseq{\octx |- A}}
  \qquad\text{and}\qquad
  \infer[\jrule{$\pmir$D}']{(B \pmir A) \oc \octx \reduces B}{
    \oseq{\octx |- A}}
  \,.
\end{equation}
Just as for ordered conjunction, the left rules for left- and right-handed implication would then be recoverable via the $\jrule{CUT}^{\reduces}$ rule~(see adjacent \lcnamecref{fig:ordered-rewriting:limp-refactoring-1}).%
\begin{marginfigure}
  \begin{equation*}
    \begin{gathered}
      \infer[\mathrlap{\lrule{\limp}}]{\oseq{\octx'_L \oc \octx \oc (A \limp B) \oc \octx'_R |- C}}{
        \oseq{\octx |- A} &
        \oseq{\octx'_L \oc B \oc \octx'_R |- C}}
      % 
      \\\leftrightsquigarrow\\
      % 
      \infer[\mathrlap{\jrule{CUT}\smash{^{\reduces}}}]{\oseq{\octx'_L \oc \octx \oc (A \limp B) \oc \octx'_R |- C}}{
        \infer[\jrule{$\limp$D}']{\octx \oc (A \limp B) \reduces B}{
          \oseq{\octx |- A}} &
        \oseq{\octx'_L \oc B \oc \octx'_R |- C}}
    \end{gathered}
    \phantom{\jrule{CUT}\smash{^{\reduces}}}
  \end{equation*}
  \caption{A possible refactoring of the $\lrule{\limp}$ rule in terms of resource decomposition}\label{fig:ordered-rewriting:limp-refactoring-1}
\end{marginfigure}

Although these
% $\jrule{$\limp$D}'$ and $\jrule{$\pmir$D}'$
rules keep the correspondence between resource decomposition rules and left rules close, they differ from the other decomposition rules in two significant ways.
First, the above $\jrule{$\limp$D}'$ and $\jrule{$\pmir$D}'$ rules have premises, and those premises create a dependence of the decomposition judgment upon general provability.
Second, the above $\jrule{$\limp$D}'$ and $\jrule{$\pmir$D}'$ rules do not decompose the principal proposition into \emph{immediate} subformulas since $\octx$ is involved.
This contrasts with, for example, the $\jrule{$\fuse$D}$ rule that decomposes $A \fuse B$ into the immediate subformulas $A \oc B$.

For these reasons, the above $\jrule{$\limp$D}'$ and $\jrule{$\pmir$D}'$ rules are somewhat undesirable.
Fortunately, there is an alternative.
Filling in the $\oseq{\octx |- A}$ premises with the $\jrule{ID}^A$ rule, we arrive at the derivable rules
\begin{equation}\label{eq:ordered-rewriting:limp-pmir-decomposition-nullary}
  \infer[\jrule{$\limp$D}]{A \oc (A \limp B) \reduces B}{}
  \qquad\text{and}\qquad
  \infer[\jrule{$\pmir$D}]{(B \pmir A) \oc A \reduces B}{}
  \,,
\end{equation}
which we adopt as decomposition rules in place of those in \cref{eq:ordered-rewriting:limp-pmir-decomposition}.
The standard $\lrule{\limp}$ and $\lrule{\pmir}$ rules can still be recovered from these more specific decomposition rules, thanks to $\jrule{CUT}$ (see adjacent \lcnamecref{fig:ordered-rewriting:limp-refactoring-2}).%
\begin{marginfigure}[-10\baselineskip]
  \begin{gather*}
    \infer[\lrule{\limp}]{\oseq{\octx'_L \oc \octx \oc (A \limp B) \oc \octx'_R |- C}}{
      \oseq{\octx |- A} &
      \oseq{\octx'_L \oc B \oc \octx'_R |- C}}
    %
    \\\leftrightsquigarrow\\
    %
    \infer[\jrule{CUT}\smash{^A}]{\oseq{\octx'_L \oc \octx \oc (A \limp B) \oc \octx'_R |- C}}{
      \oseq{\octx |- A} &
      \infer[\jrule{CUT}\smash{^{\reduces}}]{\oseq{\octx'_L \oc A \oc (A \limp B) \oc \octx'_R |- C}}{
        \infer[\jrule{$\limp$D}]{A \oc (A \limp B) \reduces B}{} &
        \oseq{\octx'_L \oc B \oc \octx'_R |- C}}}
  \end{gather*}
  \caption{Refactoring the $\lrule{\limp}$ rule in terms of resource decomposition, via $\jrule{$\limp$D}$ and $\jrule{CUT}\smash{^{\reduces}}$}\label{fig:ordered-rewriting:limp-refactoring-2}
\end{marginfigure}
These revised, nullary decomposition rules correct the earlier drawbacks: like the other decomposition rules, they now have no premises and only refer to immediate subformulas.
Moreover, these rules have the advantage of matching two of the axioms from \citeauthor{Lambek:AMM58}'s original article\autocite{Lambek:AMM58}.

\newthought{%
For most
ordered logical connectives}, this approach works perfectly.
Unfortunately, the left rules for additive disjunction, $A \plus B$, and its unit, $\zero$, are resistant to this kind of refactoring.
The difficulty with additive disjunction isn't that its left rule, $\lrule{\plus}$,%
\marginnote{%
  \begin{equation*}
    \infer[\lrule{\plus}]{\oseq{\octx'_L \oc (A \plus B) \oc \octx'_R |- C}}{
      \oseq{\octx'_L \oc A \oc \octx'_R |- C} &
      \oseq{\octx'_L \oc B \oc \octx'_R |- C}}
  \end{equation*} 
}
doesn't decompose the resource $A \plus B$.
The $\lrule{\plus}$ rule certainly does decompose $A \plus B$, but it does so by branching on the two possible futures: unwrapping the $A \plus B$ package will result in either $A$ or $B$.
% If the resource package $A \plus B$ contains $A$, then the $\lrule{\plus}$ rule's first premise is used and the other branch is pruned away.
% Otherwise, if the resource package $A \plus B$ contains $B$, then the first branch is pruned away and the second premise is used.
Just as $A \plus B$ has two futures, $\zero$, as its nullary analogue, has no future.

The straight-line nature of the $\octx \reduces \octx'$ judgment seems incompatible with this branching behavior, so we choose to retain the standard $\lrule{\plus}$ and $\lrule{\zero}$ rules.%
\footnote{It might be possible to introduce a branching judgment, something like $\octx \reduces \octx'_1 \mid \octx'_2$, but we will not pursue that here.}

\begin{figure}[tbp]
  \vspace*{\dimexpr-\abovedisplayskip-\abovecaptionskip\relax}
  \begin{inferences}
    \infer[\jrule{CUT}\smash{^A}]{\oseq{\octx'_L \oc \octx \oc \octx'_R |- C}}{
      \oseq{\octx |- A} & \oseq{\octx'_L \oc A \oc \octx'_R |- C}}
    \and 
    \infer[\jrule{ID}\smash{^A}]{\oseq{A |- A}}{}
    \\
    \infer[\jrule{CUT}\smash{^{\reduces}}]{\oseq{\octx'_L \oc \octx \oc \octx'_R |- C}}{
      \octx \reduces \octx' & \oseq{\octx'_L \oc \octx' \oc \octx'_R |- C}}
    \\
    \infer[\rrule{\fuse}]{\oseq{\octx_1 \oc \octx_2 |- A \fuse B}}{
      \oseq{\octx_1 |- A} & \oseq{\octx_2 |- B}}
    \and
    \infer[\jrule{$\fuse$D}]{A \fuse B \reduces A \oc B}{}
    \\
    \infer[\rrule{\one}]{\oseq{\octxe |- \one}}{}
    \and
    \infer[\jrule{$\one$D}]{\one \reduces \octxe}{}
    \\
    \infer[\rrule{\with}]{\oseq{\octx |- A \with B}}{
      \oseq{\octx |- A} & \oseq{\octx |- B}}
    \and
    \infer[\jrule{$\with$D}_1]{A \with B \reduces A}{}
    \and
    \infer[\jrule{$\with$D}_2]{A \with B \reduces B}{}
    \\
    \infer[\rrule{\top}]{\oseq{\octx |- \top}}{}
    \and
    \text{(no $\jrule{$\top$D}$ rule)}
    \\
    \infer[\rrule{\limp}]{\oseq{\octx |- A \limp B}}{
      \oseq{A \oc \octx |- B}}
    \and
    \infer[\jrule{$\limp$D}]{A \oc (A \limp B) \reduces B}{}
    \\
    \infer[\rrule{\pmir}]{\oseq{\octx |- B \pmir A}}{
      \oseq{\octx \oc A |- B}}
    \and
    \infer[\jrule{$\pmir$D}]{(B \pmir A) \oc A \reduces B}{}
    \\
    \infer[\rrule{\plus}_1]{\oseq{\octx |- A \plus B}}{
      \oseq{\octx |- A}}
    \and
    \infer[\rrule{\plus}_2]{\oseq{\octx |- A \plus B}}{
      \oseq{\octx |- B}}
    \and
    \infer[\lrule{\plus}]{\oseq{\octx'_L \oc (A \plus B) \oc \octx'_R |- C}}{
      \oseq{\octx'_L \oc A \oc \octx'_R |- C} &
      \oseq{\octx'_L \oc B \oc \octx'_R |- C}}
    \\
    \text{(no $\rrule{\zero}$ rule)}
    \and
    \infer[\lrule{\zero}]{\oseq{\octx'_L \oc \zero \oc \octx'_R |- C}}{}
  \end{inferences}
  \caption{A refactoring of the ordered sequent calculus to emphasize that most left rules amount to resource decomposition}\label{fig:ordered-rewriting:decompose-seq-calc}
\end{figure}

\newthought{\Cref{fig:ordered-rewriting:decompose-seq-calc} presents} the refactored sequent calculus for ordered logic in its entirety.
This calculus is sound and complete with respect to the ordered sequent calculus~\parencref{fig:ordered-logic:sequent-calculus}.
%
\begin{theorem}[Soundness and completeness]
  $\oseq{\octx |- A}$ is derivable in the refactored calculus of \cref{fig:ordered-rewriting:decompose-seq-calc} if, and only if $\oseq{\octx |- A}$ is derivable in the usual ordered sequent calculus~\parencref{fig:ordered-logic:sequent-calculus}.
\end{theorem}
%
\begin{proof}
  Soundness, the right-to-left direction, can be proved by structural induction on the given derivation.
  The key lemma is the admissibility of $\jrule{CUT}^{\reduces}$ in the usual ordered sequent calculus:
  \begin{quotation}
    \normalsize If $\octx \reduces \octx'$ and $\oseq{\octx'_L \oc \octx' \oc \octx'_R |- C}$, then $\oseq{\octx'_L \oc \octx \oc \octx'_R |- C}$.
  \end{quotation}
  This lemma can be proved by case analysis of the decomposition $\octx \reduces \octx'$, reconstituting the corresponding left rule along the lines of the sketches from \cref{fig:ordered-rewriting:fuse-refactoring,fig:ordered-rewriting:limp-refactoring-2}.

% \end{proof}
%
% \begin{theorem}[Completeness]
%   If\/ $\oseq{\octx |- A}$ is derivable in the usual ordered sequent calculus~\parencref{fig:ordered-logic:sequent-calculus}, then $\oseq{\octx |- A}$ is derivable in the refactored calculus of \cref{fig:ordered-rewriting:decompose-seq-calc}.
% \end{theorem}
%
% \begin{proof}
  Completeness, the left-to-right direction, can be proved by structural induction on the given derivation.
  The critical cases are the left rules; they are resolved along the lines of the sketches shown in \cref{fig:ordered-rewriting:fuse-refactoring,fig:ordered-rewriting:limp-refactoring-2}.
\end{proof}

\subsection{An ordered rewriting framework}\label{sec:ordered-rewriting:unfocused}

Thus far, we have used the decomposition judgment, $\octx \reduces \octx'$, and its rules as the basis for a reconfigured sequent-like calculus for ordered logic.
% But this refactoring also leads naturally to a rewriting system grounded in ordered logic.
% 
% Instead,
Alternatively,
% of taking the resource decomposition rules as a basis for a reconfigured sequent calculus,
we can view decomposition as the foundation of a rewriting system grounded in ordered logic.
For example, the decomposition of resource $A \fuse B$ into $A \oc B$ by the $\jrule{$\fuse$D}$ rule
% \marginnote{%
%   \begin{equation*}
%     \infer[\jrule{$\fuse$D}]{A \fuse B \reduces A \oc B}{}
%   \end{equation*}
% }%
can also be seen as \emph{rewriting} $A \fuse B$ into $A \oc B$.
More generally, the decomposition judgment $\octx \reduces \octx'$ can be read as \enquote{$\octx$ rewrites to $\octx'$}, where contexts $\octx$ are states that are subject to rewriting.

\Cref{fig:ordered-rewriting:rewriting} summarizes the ordered rewriting system that we obtain from the refactored sequent-like calculus of \cref{fig:ordered-rewriting:decompose-seq-calc}.
%
\begin{figure}[tbp]
  \vspace{\dimexpr-\abovedisplayskip-\abovecaptionskip\relax}
  \begin{inferences}
    \infer[\jrule{$\fuse$D}]{A \fuse B \reduces A \oc B}{}
    \and
    \infer[\jrule{$\one$D}]{\one \reduces \octxe}{}
    \\
    \infer[\jrule{$\with$D}_1]{A \with B \reduces A}{}
    \and
    \infer[\jrule{$\with$D}_2]{A \with B \reduces B}{}
    \and
    \text{(no $\jrule{$\top$D}$ rule)}
    \\
    \infer[\jrule{$\limp$D}]{A \oc (A \limp B) \reduces B}{}
    \and
    \infer[\jrule{$\pmir$D}]{(B \pmir A) \oc A \reduces B}{}
    \and
    \text{(no $\jrule{$\plus$D}$ and $\jrule{$\zero$D}$ rules)}
    \\
    \infer[\jrule{$\reduces$C}]{\octx_L \oc \octx \oc \octx_R \reduces \octx_L \oc \octx' \oc \octx_R}{
      \octx \reduces \octx'}
  \end{inferences}
  \begin{inferences}
    \infer[\jrule{$\Reduces$R}]{\octx \Reduces \octx}{}
    \and
    \infer[\jrule{$\Reduces$T}]{\octx \Reduces \octx''}{
      \octx \reduces \octx' & \octx' \Reduces \octx''}
  \end{inferences}
  \caption{The rewriting fragment of ordered logic, based on resource decomposition}\label{fig:ordered-rewriting:rewriting}
\end{figure}
%
% ; we dub this ordered rewriting system \acs{OR}.
Essentially, the ordered rewriting framework is obtained by discarding all rules except for the decomposition rules.
However, if only the decomposition rules are used, rewritings cannot occur within a larger context.
For example, the $\jrule{$\limp$D}$ decomposition rule derives $A \oc (A \limp B) \reduces B$, but $\octx'_L \oc A \oc (A \limp B) \oc \octx'_R \reduces \octx'_L \oc B \oc \octx'_R$ would not be derivable in general.
In the refactored calculus of \cref{fig:ordered-rewriting:decompose-seq-calc}, this kind of framing is taken care of by the cut principle for decomposition, $\jrule{CUT}^{\reduces}$.
To express framing at the level of the $\octx \reduces \octx'$ judgment itself, we ensure that rewriting is compatible with concatenation of ordered contexts:
\begin{equation*}
  \infer[\jrule{$\reduces$C}]{\octx_L \oc \octx \oc \octx_R \reduces \octx_L \oc \octx' \oc \octx_R}{
    \octx \reduces \octx'}
  \,.
\end{equation*}
This is analogous to the compatibility rule for string rewriting within substrings.

Also like in string rewriting, we can form the reflexive, transitive closure of $\reduces$, as a multi-step rewriting relation; we again choose to write the reflexive, transitive closure as $\Reduces$.
%
% \footnote{% [][0.5\baselineskip]{%
%   Usually written as $\reduces^*$, we instead chose $\Reduces$ for the reflexive, transitive closure because of its similarity with process calculus notation for weak transitions, $\Reduces[\smash{\alpha}]$.
%   Our reasons will become clearer in subsequent \lcnamecrefs{ch:ordered-bisimilarity}.%
% }
% Consistent with its monoidal structure, there are two equivalent formulations of this reflexive, transitive closure: each rewriting sequence $\octx \Reduces \octx'$ can be viewed as either a list or tree of individual rewriting steps.\fixnote{rewrite with reference to string rewriting}
We prefer the list-like formulation of $\Reduces$ shown in \cref{fig:ordered-rewriting:rewriting} because it tends to streamline proofs by structural induction, but, on the basis of the following \lcnamecref{fact:ordered-rewriting:transitivity}, we allow ourselves to freely switch to a tree-like formulation as needed.
%
\begin{lemma}[Transitivity of $\Reduces$]\label{fact:ordered-rewriting:transitivity}
  If \kern0.15em$\octx \Reduces \octx'$ and\/ $\octx' \Reduces \octx''$, then\/ $\octx \Reduces \octx''$.
\end{lemma}
%
\begin{proof}
  By induction on the structure of the first trace, $\octx \Reduces \octx'$.
\end{proof}

\newthought{A few remarks} about these rewriting relations are in order.
%
First, interpreting the resource decomposition rules as rewriting only confirms our preference for the nullary $\jrule{$\limp$D}$ and $\jrule{$\pmir$D}$ rules~(eq.~\ref{eq:ordered-rewriting:limp-pmir-decomposition-nullary}).
% [over the $\jrule{$\limp$D}'$ and $\jrule{$\pmir$D}'$ rules.]
The $\jrule{$\limp$D}'$ and $\jrule{$\pmir$D}'$ rules~(eq.~\ref{eq:ordered-rewriting:limp-pmir-decomposition}), with their $\oseq{\octx |- A}$ premises, would be problematic as rewriting rules because they would introduce a dependence of rewriting upon general provability
% By instead using the $\jrule{$\limp$D}$ and $\jrule{$\pmir$D}$ rules, we ensures that ordered rewriting is a syntactic procedure that
% Instead, we want ordered rewriting to be a syntactic procedure, withou 
 and the accompanying proof search would take ordered rewriting too far afield from traditional, syntactic notions of string and multiset rewriting.

Second, multi-step rewriting, $\Reduces$, is incomplete with respect to the usual ordered sequent calculus~\parencref{fig:ordered-logic:sequent-calculus} because all right rules have been discarded.%
%
 \begin{falseclaim}[Completeness]
  If \kern0.15em$\oseq{\octx |- A}$, then\/ $\octx \Reduces A$.
\end{falseclaim}
%
\begin{proof}[Counterexample]
  The sequent $\oseq{A \limp (C \pmir B) |- (A \limp C) \pmir B}$ is provable, and yet $A \limp (C \pmir B) \Longarrownot\Reduces (A \limp C) \pmir B$ (even though $A \oc (A \limp (C \pmir B)) \oc B \Reduces C$ does hold).
\end{proof}
\noindent
As expected from the way in which it was developed, ordered rewriting is, however, sound.
To state and prove soundness, we must first define an operation $\bigfuse \octx$ that reifies an ordered context as a single proposition (see adjacent \lcnamecref{fig:ordered-rewriting:bigfuse}).\fixnote{fix}%
%
\begin{marginfigure}
  \begin{align*}
    \bigfuse (\octx_1 \oc \octx_2) &= (\bigfuse \octx_1) \fuse (\bigfuse \octx_2) \\
    \bigfuse (\octxe) &= \one \\
    \bigfuse A &= A
  \end{align*}
  \caption{From ordered contexts to propositions}\label{fig:ordered-rewriting:bigfuse}
\end{marginfigure}%
%
\begin{lemma}
  For all $\octx$ and $C$, if $\oseq{\octx |- C}$, then $\oseq{\bigfuse \octx |- C}$.
  Also, $\oseq{\octx |- \bigfuse \octx}$ for all $\octx$.
\end{lemma}
\begin{proof}
  By induction on the structure of the given context, $\octx$.
\end{proof}
%
\begin{theorem}[Soundness]
  If \kern0.15em$\octx \reduces \octx'$, then\/ $\oseq{\octx |- \bigfuse \octx'}$.
  Also, if \kern0.15em$\octx \Reduces \octx'$, then\/ $\oseq{\octx |- \bigfuse \octx'}$.
\end{theorem}
%
\begin{proof}
  By induction on the structure of the given step or trace.
\end{proof}



\subsection{Properties of the ordered rewriting framework}\label{sec:ordered-rewriting:concurrency}

As we did for the string rewriting framework, we can evaluate the above ordered rewriting framework for confluence, termination, and, most importantly, concurrency.

\paragraph*{Concurrency}

Like string rewriting, ordered rewriting admits concurrency.
As an example of concurrent ordered rewriting, observe that, as shown in the adjacent \lcnamecref{fig:ordered-rewriting:concurrent-example},%
\begin{marginfigure}
  \begin{equation*}
  \begin{tikzcd}[row sep=large, column sep=tiny]
    &
    \makebox[1em][c]{$a \oc (a \limp b) \oc (c \pmir a) \oc a$}
      \dlar \drar \arrow[Reduces]{dd}
    &
    \\
    b \oc (c \pmir a) \oc a
      \drar
    &&
    a \oc (a \limp b) \oc c
      \dlar
    \\
    &
    b \oc c
    &
  \end{tikzcd}
\end{equation*}
  \caption{An example of concurrency in ordered rewriting}\label{fig:ordered-rewriting:concurrent-example}
\end{marginfigure}
%
two sequences witness $  % \octx = 
  a \oc (a \limp b) \oc (c \pmir a) \oc a \Reduces b \oc c
  % = \octx''
$: either
\begin{itemize*}[
  mode=unboxed,
  label=, afterlabel=
]
\item the initial state's left half, $a \oc (a \limp b)$, is first rewritten to $b$ and then its right half, $(c \pmir a) \oc a$, is rewritten to $c$; or
\item \textit{vice versa}, the right half is first rewritten to $c$ and then the left half is rewritten to $b$
\end{itemize*}.

These two sequences differ only in how non-overlapping, and therefore independent, rewritings of the initial state's two halves are interleaved.
And so, just as in string rewriting, the two sequences can be -- and indeed should be -- considered essentially equivalent.
% In differing only by the order in which the non-overlapping left and right halves are rewritten, these two rewriting sequences are essentially equivalent.
The details of how the small-step rewrites are interleaved are irrelevant, so that
conceptually, at least, only the big-step trace from $a \oc (a \limp b) \oc (c \pmir a) \oc a$ to $b \oc c$ remains.
% The details of how the small-step rewrites are interleaved are -- and indeed should be -- swept away, so that conceptually only the big-step trace from $\alpha_1 \oc (\alpha_1 \limp \alpha_2) \oc (\beta_2 \pmir \beta_1) \oc \beta_1$ to $\alpha_2 \oc \beta_2$ remains.

% More generally, this idea that the interleaving of independent actions is irrelevant is known as \vocab{concurrent equality}\autocite{Watkins+:CMU02}, and it forms the basis of concurrency.\autocite{??}
% Concurrent equality also endows traces $\octx \Reduces \octx'$ with a free partially commutative monoid structure, \ie, traces form a trace monoid.


% Because the two indivisual rewriting steps are independent, 
% Nothing about the final result, $\alpha_2 \oc \beta_2$, suggests which rewriting sequence 


% The rewritings of the left and right halves are not overlapping and therefore independent.
% Their independence means that we may view the two rewriting sequences as equivalent -- the two rewriting steps

% More generally, any non-overlapping rewritings are independent and may occur in any order.
% Rewriting sequences that differ only by the order in which independent rewritings occur may be seen as equivalent sequences.
% This equivalence relation, \vocab{concurrent equality}\autocite{Watkins+:CMU02}

% because the left half of $\octx$ may be rewritten by the $\jrule{$\limp$D}$ rule to $\alpha_2$, and then the right half may be rewritten to $\beta_2$:


\paragraph*{Non-confluence}

Although it admits concurrency, ordered rewriting is not confluent.
Confluence would require that all states with a common ancestor, \ie, states $\octx'_1$ and $\octx'_2$ such that $\octx'_1 \secudeR\Reduces \octx'_2$, be joinable, \ie, $\octx'_1 \Reduces\secudeR \octx'_2$.
% Because ordered rewriting is directional\fixnote{Is this phrasing correct?} and the relation $\Reduces$ is not symmetric, some nondeterministic choices are irreversible.%
%
\begin{falseclaim}[Confluence]
  If\/ $\octx'_1 \secudeR\Reduces \octx'_2$, then $\octx'_1 \Reduces\secudeR \octx'_2$.
\end{falseclaim}
%
\begin{proof}[Counterexamples]
  Consider $a \with b$.
  By the rewriting rules for additive conjunction, $a \secuder a \with b \reduces b$, and hence $a \secudeR a \with b \Reduces b$.
  However, being atoms, neither $a$ nor $b$ reduces.
  And $a \neq b$, so $a \Reduces\secudeR b$ does \emph{not} hold.
  %
  Even in the $\with$-free fragment, ordered rewriting is not confluent:
  for example,
  % consider the state $(\beta_1 \pmir \alpha) \oc \alpha \oc (\alpha \limp \beta_2)$.
  % By the rewriting rules for right- and left-handed implications,
  \begin{equation*}
    \nsecuder c \oc (a \limp b) \secudeR (c \pmir a) \oc a \oc (a \limp b) \Reduces (c \pmir a) \oc b \nreduces
    .
    \qedhere
  \end{equation*}
\end{proof}


% Viewing the resource decomposition rules for left- and right-handed implications as rewriting rules is slightly problematic, however.%
% Notice that the premises of these rules both require proofs of $\oseq{\octx |-  A}$.
% In the refactored sequent calculus of \cref{fig:ordered-rewriting:decompose-seq-calc}, that dependence of judgments is fine.
% But for a rewriting system, including arbitrary[/general] proofs would be odd -- rewriting should be a syntax-directed process and should not depend on provability.



% We write the reflexive, transitive closure of $\reduces$ as $\Reduces$.%
% \footnote{This notation is adopted for its similarity with the standard $\pi$-calculus notation for weak transitions, $\cramped{\Reduces[\alpha]}$.}

% This rewriting system is a proper fragment of ordered logic.
% \begin{equation*}
%   \oseq{A \limp (C \pmir B) \dashv|- (A \limp C) \pmir B}
%   \enspace\text{but}\enspace
%   A \limp (C \pmir B) \Longarrownot\Reduces (A \limp C) \pmir B
% \end{equation*}


\paragraph*{Termination}

Notice that every rewriting step, $\octx \reduces \octx'$, strictly decreases the number of logical connectives that occur in the ordered context.
More formally, let $\card{\octx}_{\star}$ be a measure of the number of logical connectives that occur in $\octx$, as defined in the adjacent \lcnamecref{fig:ordered-rewriting:measure}.
%
\begin{marginfigure}
  \begin{align*}
    \card{\octx_1 \oc \octx_2}_{\star} &= \card{\octx_1}_{\star} + \card{\octx_2}_{\star} \\
    \card{\octxe}_{\star} &= 0 \\
    \card{A \star B}_{\star} &= \begin{tabular}[t]{@{}l@{}}
                          $1 + \card{A}_{\star} + \card{B}_{\star}$ \\
                          \quad if $\mathord{\star} = \mathord{\fuse}$, $\mathord{\with}$, $\mathord{\limp}$, $\mathord{\pmir}$, or $\mathord{\plus}$
                         \end{tabular} \\
    \card{A}_{\star} &= \mathrlap{1}
                    \quad \text{if $A = a$, $\one$, $\top$, or $\zero$}
  \end{align*}
  \caption{A measure of the number of logical connectives within an ordered context}\label{fig:ordered-rewriting:measure}
\end{marginfigure}%
%
We may then prove the following \lcnamecref{lem:ordered-rewriting:reduction}.%
%
\begin{lemma}\label{lem:ordered-rewriting:reduction}
  If \kern0.15em$\octx \reduces \octx'$, then $\card{\octx}_{\star} > \card{\octx'}_{\star}$.
  If \kern0.15em$\octx \Reduces \octx'$, then $\card{\octx}_{\star} \geq \card{\octx'}_{\star}$.
\end{lemma}
%
\begin{proof}
  By induction on the structure of the rewriting step.
\end{proof}
%
\noindent
On the basis of this \lcnamecref{lem:ordered-rewriting:reduction}, we will frequently refer to the rewriting relation, $\reduces$, as the \vocab{reduction relation}.
We may use this \lcnamecref{lem:ordered-rewriting:reduction} to prove that ordered rewriting is terminating.
% 
% Because each rewriting step reduces the number of logical connectives present in the state~\parencref{lem:ordered-rewriting:reduction}, ordered rewriting is terminating.
%
\begin{theorem}[Termination]\label{thm:ordered-rewriting:termination}
  For all ordered contexts $\octx$, every rewriting sequence from $\octx$ is finite.
  % $\octx_0 \reduces \octx_1 \reduces \octx_2 \reduces \dotsb$ exists.
\end{theorem}
%
\begin{proof}
  Let $\octx$ be an arbitrary ordered context.
  Beginning from state $\octx_0 = \octx$, some state $\octx_i$ will eventually be reached such that either: $\octx_i \nreduces$; or $\card{\octx_i}_{\star} = 0$ and $\octx_i \reduces \octx_{i+1}$.
  In the latter case, \cref{lem:ordered-rewriting:reduction} establishes $\card{\octx_{i+1}}_{\star} < 0$, which is impossible because $\card{}_{\star}$ is a measure and hence nonnegative.
\end{proof}




\section{A \emph{focused} ordered rewriting framework}

The above ordered rewriting framework is based upon decomposition rules that are very fine-grained.
Each step of rewriting decomposes a proposition into only its immediate subformulas, and no further, such as in the very fine-grained step $a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr) \reduces a \oc (a \limp c \fuse a)$.
% \begin{marginfigure}
%   \begin{equation*}
%     \begin{tikzcd}[sep=small]
%       & a \mathrlap{\oc (a \limp b) \reduces b}
%       \\
%       \mathllap{a \oc \bigl((a \limp b) \with (c \pmir a)\bigr)}
%         \urar[reduces] \drar[reduces]
%       \\
%       & a \mathrlap{\oc (c \pmir a) \nreduces}
%     \end{tikzcd}
%     \hphantom{\oc (a \limp b) \reduces b}
%   \end{equation*}
%   \caption{}
% \end{marginfigure}%
It is not possible to rewrite $a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr)$ into $c \oc a$ (or even $c \fuse a$) in a single step, although it is possible in several steps:% $a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr) \Reduces c \oc a$, because
\begin{equation*}
  a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr) \reduces a \oc (a \limp c \fuse a) \reduces c \fuse a \reduces c \oc a
  \,.
\end{equation*}

The decomposition rules are so fine-grained that rewriting may even get stuck in undesirable and unintended ways.
For instance, in the previous example, we might have instead nondeterministically committed to rewriting $a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr)$ into $a \oc (b \limp \one)$ as the first step, and then $a \oc (b \limp \one)$ is stuck, with no further rewritings possible:
\begin{equation*}
  a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr)
    \reduces a \oc (b \limp \one)
    \nreduces
    \!\,.
\end{equation*}
Instead, we would rather have a coarser notion of decomposition so that $a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr) \reduces c \oc a$ is a single step%
\footnote{Or so that $a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr) \reduces c \fuse a$, at least, is a single step.}
and, conversely, so that $a \oc \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr) \reduces \octx'$ only if $\octx' = c \oc a$.

\newthought{Focusing, as developed by} \textcite{Andreoli:JLC92}, provides just the right coarse-grained decomposition through its complementary inversion and chaining strategies for proof search.
An inversion phase groups together successive invertible rules, and a chaining phase groups together successive noninvertible rules that are applied to a single \emph{in-focus} proposition;
together, a chaining phase followed by an inversion phase constitutes a \emph{bipole}.
Rather than having each of these rules give rise to a separate step, we can treat the entire bipole as an atomic step of rewriting.

The rewriting framework described above might be termed \emph{unfocused} ordered rewriting; we will now describe a focused ordered rewriting framework.

This idea of using focusing to increase the granularity of rewriting steps dates back to, at least, the \acf{CLF}\autocites{??}{??} and was later streamlined in linear logic by \textcite{Cervesato+Scedrov:IC09}.
\Textcite{Simmons:CMU12} has studied a focused ordered rewriting framework, though in a somewhat different formulation than the one we present here.


\newthought{The ordered propositions} are now polarized into positive and negative classes, or \vocab{polarities}\autocite{??}, according to the invertibility of their sequent calculus rules; two \enquote*{shift} operators, $\dn$ and $\up$, mediate between the two classes.
\begin{align*}
  % Positive props. &
    \p{A} &\Coloneqq \p{a} \mid \p{A} \fuse \p{B} \mid \one \mid \dn \n{A}
  \\
  % Negative props. &
    \n{A} &\Coloneqq \p{A} \limp \n{B} \mid \n{B} \pmir \p{A} \mid \n{A} \with \n{B} \mid \top \mid \up \p{A}
\end{align*}
The positive propositions, $\p{A}$, are those propositions that have invertible left rules, such as ordered conjunction; the negative propositions, $\n{A}$, are those that have invertible right rules, such as the left- and right-handed implications.
For reasons that will become clear in \cref{ch:formula-as-process}, we choose to assign a positive polarity to all atomic propositions, $\p{a}$.

To streamline the syntax, we will often make two elisions.
Because all atomic propositions have positive polarity, we will often write $a$ instead of $\p{a}$.
We will also often elide any $\dn$ and $\up$ shifts that are necessitated by the polarities of the remaining connectives; we call such shifts the minimal shifts.
For example, we might write $a \fuse (b \limp \one)$ in place of the more verbose, implied $\p{a} \fuse \dn (\p{b} \limp \up \one)$.

Ordered contexts are formed as the free monoid over negative propositions and positive atoms:
\begin{equation*}
  \np{\octx} , \np{\lctx} \Coloneqq \np{\octx}_1 \oc \np{\octx}_2 \mid \octxe \mid \n{A} \mid \p{a}
  \,.
\end{equation*}
As usual, we do not distinguish those ordered contexts that are equivalent up to the monoid laws.
Notice that we use the same metavariables for these polarized ordered contexts as we did for the unpolarized contexts of the preceding (unfocused) ordered rewriting framework -- the intended context, either polarized or not, will always be clear from context.

We may also reify an ordered context $\np{\octx}$ as a positive proposition, $\bigfuse \np{\octx}$, using the operation defined in the neighboring \lcnamecref{fig:ordered-rewriting:bigfuse}%
%
\begin{marginfigure}
  \begin{align*}
    \bigfuse (\np{\octx}_1 \oc \np{\octx}_2) &= (\bigfuse \np{\octx}_1) \fuse (\bigfuse \np{\octx}_2) \\
    \bigfuse (\octxe) &= \one \\
    \bigfuse \n{A} &= \dn \n{A} \\
    \bigfuse \p{a} &= \p{a}
  \end{align*}
  \caption{Reifying an ordered context as a positive proposition}\label{fig:ordered-rewriting:polarized-bigfuse}
\end{marginfigure}%
%
.
This operation is the polarized analogue of the operation shown in \cref{fig:ordered-rewriting:bigfuse}.

\newthought{Each class of propositions} is then equipped with its own focusing judgment: a \vocab{left-focus judgment}, $\lfocus{\np{\octx}_L}{\n{A}}{\np{\octx}_R}{\p{C}}$, that focuses on a negative proposition, $\n{A}$, that occurs to the left of the turnstile; and a \vocab{right-focus judgment}, $\rfocus{\np{\octx}}{\p{A}}$, that focuses on a positive proposition, $\p{A}$, that occurs to the right of the turnstile.%
\footnote{We choose a left-facing turnstile for the right-focus judgment to emphasize its input/output mode; see the next paragraph.}

Following \textcite{Zeilberger:POPL08}, each of these judgments can be read as a function that provides a form of extended decomposition -- the in-focus proposition is decomposed beyond its immediate subformulas, until subformulas of the opposite polarity are reached.
% The judgment $\rfocus{\octx}{\p{A}}$ decomposes the in-focus proposition $\p{A}$ into the ordered context $\octx$ of negative subformulas,
% and $\lfocus{\octx_L}{\n{A}}{\octx_R}{\p{C}}$ decomposes the in-focus proposition $\n{A}$ into the ordered contexts $\octx_L$ and $\octx_R$ and the positive subformula $\p{C}$.
% 
The two focusing judgments are defined inductively on the structure of the in-focus proposition, with the left-focus judgment depending on the right-focus judgment (though not \emph{vice versa}).

The right-focus judgment, $\rfocus{\np{\octx}}{\p{A}}$, decomposes $\p{A}$ into the ordered context $\np{\octx}$ of its nearest negative subformulas, treating $\p{A}$ as input and $\np{\octx}$ as output.
% \footnote{This input/output behavior explains why we choose to write the \emph{right}-focus judgment as $\rfocus{\np{\octx}}{\p{A}}$ with a \emph{left}-facing turnstile:
  % when written this way, the judgment's input is followed by its output.}
% The right-focus judgment, $\rfocus{\np{\octx}}{\p{A}}$, decomposes $\p{A}$ into the ordered context $\np{\octx}$ of its nearest negative subformulas;
% this judgment therefore takes an in-focus proposition, $\p{A}$, as an input and produces an ordered context, $\np{\octx}$, as output.
The judgment is given by the following rules.
\begin{inferences}
  \infer[\rrule{\fuse}]{\rfocus{\np{\octx}_1 \oc \np{\octx}_2}{\p{A} \fuse \p{B}}}{
    \rfocus{\np{\octx}_1}{\p{A}} & \rfocus{\np{\octx}_2}{\p{B}}}
  \and
  \infer[\rrule{\one}]{\rfocus{\octxe}{\one}}{}
  \\
  \infer[\jrule{ID}\smash{^{\p{a}}}]{\rfocus{\p{a}}{\p{a}}}{}
  \and
  \infer[\rrule{\dn}]{\rfocus{\n{A}}{\dn \n{A}}}{}
\end{inferences}
% This right-focus judgment decomposes a positive proposition until its [largest] negative subformulas are reached.
Ordered conjunctions $\p{A} \fuse \p{B}$ are decomposed into $\np{\octx}_1 \oc \np{\octx}_2$ by inductively decomposing $\p{A}$ and $\p{B}$ into $\np{\octx}_1$ and $\np{\octx}_2$, respectively, and $\one$ is decomposed into the empty context.
Atoms $\p{a}$ are not decomposed further%
\footnote{Alternatively, following \textcite{Simmons:CMU12}, atoms $\p{a}$ could be decomposed to suspensions $\langle\p{a}\rangle$, but we choose not to do that here.}%
, and $\dn \n{A}$ is decomposed into its immediate subformula of negative polarity, $\n{A}$.

This right-focus judgment is a left inverse of the $\bigfuse (-)$ operation:
\begin{lemma}
  $\rfocus{\np{\octx'{}}}{\bigfuse \np{\octx}}$ if, and only if, $\np{\octx} = \np{\octx'{}}$.
\end{lemma}
\begin{proof}
  Each direction is separately proved by structural induction on the context $\np{\octx}$.
\end{proof}

The left-focus judgment, $\lfocus{\np{\octx}_L}{\n{A}}{\np{\octx}_R}{\p{C}}$, decomposes $\n{A}$ into the ordered contexts $\np{\octx}_L$ and $\np{\octx}_R$ and positive subformula $\p{C}$, treating $\n{A}$ as input and $\np{\octx}_L$, $\np{\octx}_R$, and $\p{C}$ as outputs.
The judgment is given by the following rules.
\begin{inferences}
  \infer[\lrule{\limp}]{\lfocus{\np{\octx}_L \oc \np{\octx}_A}{\p{A} \limp \n{B}}{\np{\octx}_R}{\p{C}}}{
    \rfocus{\np{\octx}_A}{\p{A}} &
    \lfocus{\np{\octx}_L}{\n{B}}{\np{\octx}_R}{\p{C}}}
  \and
  \infer[\lrule{\pmir}]{\lfocus{\np{\octx}_L}{\n{B} \pmir \p{A}}{\np{\octx}_A \oc \np{\octx}_R}{\p{C}}}{
    \rfocus{\np{\octx}_A}{\p{A}} &
    \lfocus{\np{\octx}_L}{\n{B}}{\np{\octx}_R}{\p{C}}}
  \\
  \infer[\lrule{\with}_1]{\lfocus{\np{\octx}_L}{\n{A} \with \n{B}}{\np{\octx}_R}{\p{C}}}{
    \lfocus{\np{\octx}_L}{\n{A}}{\np{\octx}_R}{\p{C}}}
  \quad\enspace%\and\!
  \infer[\lrule{\with}_2]{\lfocus{\np{\octx}_L}{\n{A} \with \n{B}}{\np{\octx}_R}{\p{C}}}{
    \lfocus{\np{\octx}_L}{\n{B}}{\np{\octx}_R}{\p{C}}}
  \quad\enspace%\and\!
  \text{(no $\lrule{\top}$ rule)}
  \\
  \infer[\lrule{\up}]{\lfocus{}{\up \p{A}}{}{\p{A}}}{}
\end{inferences}
The left-focus judgment's rules parallel the usual sequent calculus rules, but maintaining focus on the immediate subformulas -- left focus for subformulas of negative polarity and right focus for subformulas of positive polarity.
The $\lrule{\up}$ rule ends left focus by decomposing an $\up \p{A}$ antecedent into an $\p{A}$ consequent.

Unlike the right-focus judgment, the left-focus judgment describes a relation (or nondeterministic function), owing to the two rules, $\lrule{\with}_1$ and $\lrule{\with}_2$, that may apply to alternative conjunctions.
For example, both 
\begin{gather*}
  \lfocus{\p{a}}{(\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)}{}{\p{c} \fuse \p{a}}
\shortintertext{and}
  \lfocus{\hphantom{\p{a}}\mathllap{\p{b}}}{(\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)}{}{\mathrlap{\one}\hphantom{\p{c} \fuse \p{a}}}
\end{gather*}
are both derivable.
% when the negative proposition $(\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{a} \limp \up \one)$ is in focus.

\newthought{A focused rewriting step arises} when a negative proposition, $\n{A}$, is put into focus and the resulting consequent, $\p{C}$, is subsequently decomposed into the ordered context.%
\footnote{Writing $\rfocus{\np{\octx'{}}}{\p{B}}$ for the right-focus judgment gives this rule the flavor of a cut principle.}
In addition, the compatibility rule $\jrule{$\reduces$C}$ is retained.
\begin{inferences}
  \infer[\jrule{$\reduces$I}]{\np{\octx}_L \oc \n{A} \oc \np{\octx}_R \reduces \np{\octx'{}}}{
    \lfocus{\np{\octx}_L}{\n{A}}{\np{\octx}_R}{\p{C}} &
    \rfocus{\np{\octx'{}}}{\p{C}}}
  \and
  \infer[\jrule{$\reduces$C}]{\np{\octx}_L \oc \np{\octx} \oc \np{\octx}_R \reduces \np{\octx}_L \oc \np{\octx'{}} \oc \np{\octx}_R}{
    \np{\octx} \reduces \np{\octx'{}}}
\end{inferences}

With this $\jrule{$\reduces$I}$ rule, it is indeed possible to rewrite\fixnote{fix}
\begin{equation*}
  \p{a} \oc \bigl((\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)\bigr)
    \reduces \p{c} \oc \p{a}
\end{equation*}
in a single, atomic step because both $\lfocus{\p{a}}{(\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)}{}{\p{c} \fuse \p{a}}$ and $\rfocus{\p{c} \oc \p{a}}{\p{c} \fuse \p{a}}$ are derivable.
Moreover, the larger granularity afforded by the left- and right-focus judgments precludes the small steps that led to unintended stuck states.
For example:
\begin{equation*}
  \p{a} \oc \bigl((\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)\bigr)
    \reduces \np{\octx'{}}
  \enspace\text{only if}\enspace
  \np{\octx'{}} = \p{c} \oc \p{a}
  \,.
\end{equation*}
and so 
\begin{equation*}
  \p{a} \oc \bigl((\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)\bigr)
    \nreduces \p{a} \oc (\p{b} \limp \up \one)
  \,.
\end{equation*}

% \subsection{Recursively defined propositions and focused ordered rewriting}\label{sec:ordered-rewriting:focused:recursive}

% With the revisions to the granularity of rewriting steps that the focused rewriting framework brings, we should pause to consider how recursively defined propositions interact with focused rewriting.

% Previously, in the unfocused rewriting framework, recursively defined propostions such as $\defp{p} \defd (a \limp \defp{p} \fuse a) \with (b \limp \one)$ were permitted.
% With the fine granularity of rewriting imposed in that framework, it took three steps to rewrite $a \oc \defp{p}$ into $\defp{p} \oc a$:
% \begin{equation*}
%   a \oc \defp{p} = a \oc \bigl((a \limp \defp{p} \fuse a) \with (b \limp \one)\bigr) \reduces a \oc (a \limp \defp{p} \fuse a) \reduces \defp{p} \fuse a \reduces \defp{p} \oc a
%   \,.
% \end{equation*}
% % Consider the recursively defined proposition $p \defd (a \limp p \fuse a) \with (b \limp \one)$.
% % Previously, in the unfocused rewriting framework, it took three steps to rewrite $a \oc p$ into $p \oc a$:
% % \begin{equation*}
% %   a \oc p = a \oc \bigl((a \limp p \fuse a) \with (b \limp \one)\bigr) \reduces a \oc (a \limp p \fuse a) \reduces p \fuse a \reduces p \oc a
% %   \,.
% % \end{equation*}

% In the polarized, focused rewriting framework, the analogous definition with only the minimally necessary shifts is $\n{\defp{p}} \defd (\p{a} \limp \up (\dn \n{\defp{p}} \fuse \p{a})) \with (\p{b} \limp \up \one)$.
% With the coarser granularity of rewriting now afforded by focusing, it takes only one focused step to rewrite $\p{a} \oc \n{\defp{p}}$ into $\n{\defp{p}} \oc \p{a}$:
% \begin{gather*}
%   \p{a} \oc \n{\defp{p}} = \p{a} \oc \bigl((\p{a} \limp \up (\dn \n{\defp{p}} \fuse \p{a})) \with (\p{b} \limp \up \one)\bigr) \reduces \n{\defp{p}} \oc \p{a}
% \shortintertext{because}
%   \lfocus{\p{a}}{\n{\defp{p}}}{}{\dn \n{\defp{p}} \fuse \p{a}}
%   \qquad\text{and}\qquad
%   \rfocus{\n{\defp{p}} \oc \p{a}}{\dn \n{\defp{p}} \fuse \p{a}}
%   \,.
% \end{gather*}

% \newthought{Because the left-focus judgment} is defined inductively, not coinductively, there are some recursively defined negative propositions that cannot successfully be put into focus.
% Under the definition $\n{\defp{p}} \defd \p{a} \limp \n{\defp{p}}$, for example, there are no contexts $\np{\octx}_L$ and $\np{\octx}_R$ and positive consequent $\p{C}$ for which $\lfocus{\np{\octx}_L}{\n{\defp{p}}}{\np{\octx}_R}{\p{C}}$ is derivable.
% To derive a left-focus judgment on $\n{\defp{p}}$, the finite context $\octx_L$ would need to hold an infinite stream of $\p{a}$ atoms, which is impossible in an inductively defined context.

% However, by inserting a double shift, $\up \dn$, which allows focus to be blurred at the $\up$, the definition can be revised to one that admits left-focusing: when $\n{\defp{p}}$ is defined by $\n{\defp{p}} \defd \p{a} \limp \up \dn \n{\defp{p}}$, the judgment $\lfocus{\p{a}}{\n{\defp{p}}}{}{\dn \n{\defp{p}}}$ is derivable.
% It follows that $\p{a} \oc \n{\defp{p}} \reduces \n{\defp{p}}$.

% More generally, any recursively defined proposition that does not pass through an $\up$ shift along a main branch cannot be successfully put into focus.




\begin{figure}[tbp]
  \vspace*{\dimexpr-\abovedisplayskip-\abovecaptionskip\relax}
  \begin{syntax*}
    Positive props. &
      \p{A} & \p{A} \fuse \p{B} \mid \one \mid \p{a} \mid \dn \n{A}
    \\
    Negative props. &
      \n{A} & \p{A} \limp \n{B} \mid \n{B} \pmir \p{A} \mid \n{A} \with \n{B} \mid \top \mid \n{\defp{p}} \mid \up \p{A}
    \\
    Contexts &
      \np{\octx} & \np{\octx}_1 \oc \np{\octx}_2 \mid \octxe \mid \n{A} \mid \p{a}
    % \\
    % Signatures &
    %   \orsig & \orsige \mid \orsig, \n{\defp{p}} \defd \n{A}
  \end{syntax*}
  \begin{inferences}
    \infer[\rrule{\fuse}]{\rfocus{\np{\octx}_1 \oc \np{\octx}_2}{\p{A} \fuse \p{B}}}{
      \rfocus{\np{\octx}_1}{\p{A}} & \rfocus{\np{\octx}_2}{\p{B}}}
    \and
    \infer[\rrule{\one}]{\rfocus{\octxe}{\one}}{}
    \\
    \infer[\jrule{ID}\smash{^{\p{a}}}]{\rfocus{\p{a}}{\p{a}}}{}
    \and
    \infer[\rrule{\dn}]{\rfocus{\n{A}}{\dn \n{A}}}{}
  \end{inferences}
  \begin{inferences}
    \infer[\lrule{\limp}]{\lfocus{\np{\octx}_L \oc \np{\octx}_A}{\p{A} \limp \n{B}}{\np{\octx}_R}{\p{C}}}{
      \rfocus{\np{\octx}_A}{\p{A}} &
      \lfocus{\np{\octx}_L}{\n{B}}{\np{\octx}_R}{\p{C}}}
    \and
    \infer[\lrule{\pmir}]{\lfocus{\np{\octx}_L}{\n{B} \pmir \p{A}}{\np{\octx}_A \oc \np{\octx}_R}{\p{C}}}{
      \rfocus{\np{\octx}_A}{\p{A}} &
      \lfocus{\np{\octx}_L}{\n{B}}{\np{\octx}_R}{\p{C}}}
    \\
    \infer[\lrule{\with}_1]{\lfocus{\np{\octx}_L}{\n{A} \with \n{B}}{\np{\octx}_R}{\p{C}}}{
      \lfocus{\np{\octx}_L}{\n{A}}{\np{\octx}_R}{\p{C}}}
    \and
    \infer[\lrule{\with}_2]{\lfocus{\np{\octx}_L}{\n{A} \with \n{B}}{\np{\octx}_R}{\p{C}}}{
      \lfocus{\np{\octx}_L}{\n{B}}{\np{\octx}_R}{\p{C}}}
    \and
    \text{(no $\lrule{\top}$ rule)}
    \\
    \infer[\lrule{\up}]{\lfocus{}{\up \p{A}}{}{\p{A}}}{}
  \end{inferences}
  \begin{inferences}
    \infer[\jrule{$\reduces$I}]{\octx_L \oc \n{A} \oc \octx_R \reduces \octx'}{
      \lfocus{\octx_L}{\n{A}}{\octx_R}{\p{C}} &
      \rfocus{\octx'}{\p{C}}}
    \and
    \infer[\jrule{$\reduces$C}]{\octx_L \oc \octx \oc \octx_R \reduces \octx_L \oc \octx' \oc \octx_R}{
      \octx \reduces \octx'}
  \end{inferences}
  \begin{inferences}
    \infer[\jrule{$\Reduces$R}]{\octx \Reduces \octx}{}
    \and
    \infer[\jrule{$\Reduces$T}]{\octx \Reduces \octx''}{
      \octx \reduces \octx' & \octx' \Reduces \octx''}
  \end{inferences}
  \caption{A framework for focused ordered rewriting}
\end{figure}

\section{Using shifts to control focusing}

With careful placement of shifts, it is possible to control the behavior of focused rewriting.
It is even possible to embed the unfocused ordered rewriting framework of \cref{sec:ordered-rewriting:unfocused} and a weakly focused ordered rewriting framework within focused ordered rewriting in an operationally faithful way, as we now show.
% in \cref{sec:ordered-rewriting:embed-unfocused,sec:ordered-rewriting:embed-weakly-focused}.
% But first, we discuss a minimal polarization strategy for propositions.

% \subsection{A minimal polarization strategy}

% Because the unpolarized and polarized propositions share the same logical connectives and constants, there is an obvious polarization strategy:
% Given an unpolarized proposition, insert an $\up$ in front of each positive proposition that occurs where a negative subformula is required; symmetrically, insert a $\dn$ in front of each negative proposition that occurs where a positive subformula is required.
% %
% For example, the unpolarized proposition $a \fuse \bigl((a \limp c \fuse a) \with (b \limp \one)\bigr)$ becomes $\p{a} \fuse \dn \bigl((\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)\bigr)$ under the minimal polarization strategy.

% In other words, the minimal polarization is one that adds $\up$ and $\dn$ shifts only as required.
% We will frequently elide these shifts because they can be easily inferred.

% % Focused ordered rewriting is sound with respect to the unfocused rewriting framework of \cref{??}, in the sense that every focused rewriting step possible
% % The neighboring \lcnamecref{fig:ordered-rewriting:minimal-polarization}%
% % %
% % \begin{marginfigure}
% %   \begin{equation*}
% %     \begin{aligned}
% %       \embedp{a} &= \p{a} \\
% %       \embedp*{A \fuse B}
% %         &= \embedp{A} \fuse \embedp{B} \\
% %       \embedp{\one} &= \one \\
% %       \embedp{A} &= \dn \embedn{A} \quad\text{otherwise}
% %     \\[2\jot]
% %       \embedn*{A \limp B}
% %         &= \embedp{A} \limp \embedn{B} \\
% %       \embedn*{B \pmir A}
% %         &= \embedn{B} \pmir \embedp{A} \\
% %       \embedn*{A \with B}
% %         &= \embedn{A} \with \embedn{B} \\
% %       \embedn{\top} &= \top \\
% %       \embedn{A} &= \up \embedp{A} \quad\text{otherwise}
% %     \\[2\jot]
% %       \embed*{\octx_1 \oc \octx_2}
% %         &= \embed{\octx_1} \oc \embed{\octx_2} \\
% %       \embed*{\octxe} &= \octxe \\
% %       \embed{A} &=
% %         \begin{cases*}
% %           \p{a} & if $A = a$ \\
% %           \embedn{A} & otherwise
% %         \end{cases*}
% %     \end{aligned}
% %   \end{equation*}
% %   \caption{A minimal polarization strategy}\label{fig:ordered-rewriting:minimal-polarization}
% % \end{marginfigure}%
% % %



% % \begin{equation*}
% %   \begin{aligned}
% %     \embedp*{A} &=
% %       \begin{cases*}
% %         \p{a} & if $A = a$ \\
% %         \embedp{A_1} \fuse \embedp{A_2} & if $A = A_1 \fuse A_2$ \\
% %         \one & if $A = \one$ \\
% %         \dn \embedn{A} & otherwise
% %       \end{cases*}
% %     \\
% %     \embedn*{A} &=
% %       \begin{cases*}
% %         \embedp{A_1} \limp \embedn{A_2} & if $A = A_1 \limp A_2$ \\
% %         \embedn{A_2} \pmir \embedp{A_1} & if $A = A_2 \pmir A_1$ \\
% %         \embedn{A_1} \with \embedn{A_2} & if $A = A_1 \with A_2$ \\
% %         \top & if $A = \top$ \\
% %         \up \embedp{A} & otherwise
% %       \end{cases*}
% %     \\
% %     \embed{\octx} &=
% %       \begin{cases*}
% %         \embed{\octx_1} \oc \embed{\octx_2} & if $\octx = \octx_1 \oc \octx_2$ \\
% %         \octxe & if $\octx = \octxe$ \\
% %         \embedn{A} & if $\octx = A \neq a$ \\
% %         \p{a} & if $\octx = a$
% %       \end{cases*}
% %   \end{aligned}
% % \end{equation*}

% % \begin{theorem}
% %   If $\embed{\octx_1} \reduces \np{\octx}_2$, then $\octx_1 \Reduces \octx_2$ for some $\octx_2$ such that $\embed{\octx_2} = \np{\octx}_2$.
% % \end{theorem}

\subsection{Embedding unfocused ordered rewriting}\label{sec:ordered-rewriting:embed-unfocused}

With careful placement of additional, non-minimal shifts, it is possible to embed unfocused ordered rewriting within the focused ordered rewriting framework in a operationally faithful way.
Specifically, we can define a mapping, $\embed*{}$, from contexts of unpolarized propositions to contexts of negative propositions and positive atoms in a way that strongly respects the operational behavior of unfocused ordered rewriting:
\begin{itemize}[noitemsep]
\item $\octx \reduces \octx'$ implies $\embed{\octx} \reduces \embed{\octx'{}}$; and
\item $\embed{\octx} \reduces \np{\lctx'{}}$ implies $\octx \reduces \octx'$, for some $\octx'$ such that $\np{\lctx'{}} = \embed{\octx'{}}$.
\end{itemize}
Because $\embed*{}$ is a total function, these properties thus establish it as a \emph{strong reduction\fixnote{or just \enquote*{strong bisimulation}?} bisimulation}\autocite{Sangiorgi+Walker:CUP03}.
% By appropriately placing double shifts, $\dn \up$ or $\up \dn$, between each pair of 

Essentially, this embedding inserts a double shift, $\dn \up$, in front of each proper, nonatomic subformula.
These double shifts cause chaining and inversion to be interrupted after each step, forcing the focused rewriting to mimic the small-step behavior of unfocused rewriting.

More specifically, $\embed{A}$ prepends an $\up$ shift whenever the top-level connective of $A$ has positive polarity.
Consequently, $\embed{A}$ is either: a positive atom, exactly when $A$ is atomic; or otherwise a negative proposition.
Also, the mapping $\embed*{}$ relies on the $\bigfuse$ operation on contexts -- thus, $\bigfuse \embed{A}$ inserts a $\dn$ shift in front of $\embed{A}$ exactly when $\embed{A}$ and hence $A$ are nonatomic.
Together, these features serve to insert a double shift, $\dn \up$, in front of each proper, nonatomic subformula of $A$.

% % $\embed*{}$, from unpolarized propositions to negative propositions and positive atoms;
% $\embedn*{}$ and $\embedp*{}$, from unpolarized propositions to negative and positive propositions, respectively.
% $\embedn{A}$ and $\embedp{A}$ produce negative and positive polarizations of $A$ that insert a $\dn \up$ shift in front of every proper, nonatomic subformula of $A$.
% In addition, $\embedn{A}$ prepends an $\up$ shift whenever the top-level connective of $A$ has positive polarity, whereas $\embedn{A}$ prepends a $\dn$ shift whenever $A$ is not atomic.
% % $\embed{A}$ produces either a positive atom or a negative polarization of $A$, according to wheter $A$ is atomic.
%
% \begin{marginfigure}
% \begin{equation*}
%   \begin{aligned}
%     \embedp{A} &= \begin{cases*}
%                     \p{a} & if $A = a$ \\
%                     \dn \embedn{A} & otherwise
%                \end{cases*}
%     \\
%     \embedn{A} &= \begin{cases*}
%                     \up (\embedp{A_1} \fuse \embedp{A_2}) & if $A = A_1 \fuse A_2$ \\
%                     \up \one & if $A = \one$ \\
%                     \embedp{A_1} \limp \up \embedp{A_2} & if $A = A_1 \limp A_2$ \\
%                     \up \embedp{A_2} \pmir \embedp{A_1} & if $A = A_2 \pmir A_1$ \\
%                     \up \embedp{A_1} \with \up \embedp{A_2} & if $A = A_1 \with A_2$ \\
%                     \top & if $A = \top$
%                   \end{cases*}
%     \\
%     \embed{A} &= \begin{cases*}
%                    \p{a} & if $A = a$ \\
%                    \embedn{A} & otherwise
%                  \end{cases*}
%     \\
%     \embed{\octx} &= \begin{cases*}
%                        \embed{\octx_1} \oc \embed{\octx_2} & if $\octx = \octx_1 \oc \octx_2$ \\
%                        (\octxe) & if $\octx = \octxe$ \\
%                        \embed{A} & if $\octx = A$
%                      \end{cases*}
%   \end{aligned}
% \end{equation*}
% % \caption{An embedding of unfocused ordered rewriting within the focused ordered rewriting framework}
% \end{marginfigure}
\begin{marginfigure}
  \begin{align*}
    \embed*{\octx_1 \oc \octx_2} &= \embed{\octx_1} \oc \embed{\octx_2} \\
    \embed*{\octxe} &= \octxe \\
    \embed{a} &= \p{a} \\
    \embed*{A \fuse B} &= \up ((\bigfuse \embed{A}) \fuse (\bigfuse \embed{B})) \\
    \embed{\one} &= \up \one \\
    \embed*{A \limp B} &= (\bigfuse \embed{A}) \limp \up (\bigfuse \embed{B}) \\
    \embed*{B \pmir A} &= \up (\bigfuse \embed{B}) \pmir (\bigfuse \embed{A}) \\
    \embed*{A \with B} &= \up (\bigfuse \embed{A}) \with \up (\bigfuse \embed{B}) \\
    \embed{\top} &= \top
  \end{align*}
  \caption{An embedding of unfocused ordered rewriting within focused ordered rewriting}
\end{marginfigure}

\begin{theorem}
  The embedding $\embed{(-)}$ satisfies the following properties.
  \begin{itemize}[nosep]
  \item If $\octx \reduces \octx'$, then $\embed{\octx} \reduces \embed{\octx'{}}$.
  \item If $\embed{\octx} = \np{\lctx} \reduces \np{\lctx'{}}$, then $\octx \reduces \octx'$ for some $\octx'$ such that $\np{\lctx'{}} = \embed{\octx'{}}$.
  \end{itemize}
\end{theorem}
\begin{proof}
  The proofs of these properties require a straightforward lemma:
  for all unpolarized propositions $A$, 
  \begin{equation*}
    \rfocus{\np{\lctx}}{\bigfuse \embed{A}} \text{\ if, and only if, } \np{\lctx} = \embed{A}
    \,.
  \end{equation*}

  The first property is then proved by induction over the structure of the given rewriting step, $\octx \reduces \octx'$.
  As an example, consider the case in which $\octx = A \oc (A \limp B) \reduces B = \octx'$.
  By definition, $\embed{\octx} = \embed{A} \oc ((\bigfuse \embed{A}) \limp \up (\bigfuse \embed{B}))$ and $\embed{\octx'{}} = \embed{B}$; we can indeed derive $\lfocus{\embed{A}}{(\bigfuse \embed{A}) \limp \up (\bigfuse \embed{B})}{}{\bigfuse \embed{B}}$ and $\rfocus{\embed{B}}{\bigfuse \embed{B}}$.
  So, as required, $\embed{\octx} = \embed{A} \oc ((\bigfuse \embed{A}) \limp \up (\bigfuse \embed{B})) \reduces \embed{B} = \embed{\octx'{}}$.

  The second property is also proved by induction over the structure of the given rewriting step, this time $\embed{\octx} = \np{\lctx} \reduces \np{\lctx'{}}$.
  As an example, consider the case in which $\lfocus{\embed{\octx_L}}{(\bigfuse \embed{A}) \limp \up (\bigfuse \embed{B})}{\embed{\octx_R}}{\p{C}}$ and $\rfocus{\np{\lctx'{}}}{\p{C}}$, for some $\octx_L$, $A$, $B$, $\octx_R$, and $\p{C}$ such that $\octx = \octx_L \oc (A \limp B) \oc \octx_R$.
  By inversion and the aforementioned lemma, we have $\octx_L = A$, $\octx_R = (\octxe)$, $\p{C} = \bigfuse \embed{B}$, and $\np{\lctx'{}} = \embed{B}$.
  Indeed, as required, $\octx = A \oc (A \limp B) \reduces B = \octx'$ and $\np{\lctx'{}} = \embed{\octx'{}}$.
\end{proof}

\subsection{Embedding weakly focused ordered rewriting}

It is similarly possible to embed \emph{weakly} focused ordered rewriting, a rewriting discipline based on weak focusing\autocites{Laurent:??}{??} in which the granularity of steps lies between that of the unfocused and (strongly\footnote{Commonly known as fully focused.}) focused ordered rewriting frameworks.
More specifically, weak focusing differs from (strong) focusing in that it retains chaining but abandons eager inversion.
For example, with weakly focused rewriting,
\begin{equation*}
  \p{a} \oc \dn \bigl((\p{a} \limp \up (\p{c} \fuse \p{a})) \with (\p{b} \limp \up \one)\bigr)
    \reduces \p{c} \fuse \p{a}
    \reduces \p{c} \oc \p{a}
  \,,
\end{equation*}
where the inversion of $\p{c} \fuse \p{a}$ is now an atomic step of its own.

This weakly focused rewriting discipline could be achieved as an independent system with the rules shown in \cref{fig:ordered-rewriting:weak-focusing}.
Notice that weakly focused rewriting restricts the left- and right-handed implications to have only atomic premises.
Although weak focusing is well-defined for arbitrary implications\autocite{??}, it is not clear how to give a rewriting interpretation of weak focusing unless this restriction is made.

\begin{figure}[tbp]
  \vspace*{\dimexpr-\abovedisplayskip-\abovecaptionskip\relax}
  \begin{syntax*}
    Contexts &
      \p{\octx} & \p{\octx}_1 \oc \p{\octx}_2 \mid \octxe \mid \p{A}
  \end{syntax*}
\begin{inferences}
  \infer[\lrule{\limp}]{\lfocus{\p{\octx}_L \oc \p{a}}{\p{a} \limp \n{B}}{\p{\octx}_R}{\p{C}}}{
    \lfocus{\p{\octx}_L}{\n{B}}{\p{\octx}_R}{\p{C}}}
  \and
  \infer[\lrule{\pmir}]{\lfocus{\p{\octx}_L}{\n{B} \pmir \p{a}}{\p{a} \oc \p{\octx}_R}{\p{C}}}{
    \lfocus{\p{\octx}_L}{\n{B}}{\p{\octx}_R}{\p{C}}} 
  \\
  \infer[\lrule{\with}_1]{\lfocus{\p{\octx}_L}{\n{A} \with \n{B}}{\p{\octx}_R}{\p{C}}}{
    \lfocus{\p{\octx}_L}{\n{A}}{\p{\octx}_R}{\p{C}}}
  \and
  \infer[\lrule{\with}_2]{\lfocus{\p{\octx}_L}{\n{A} \with \n{B}}{\p{\octx}_R}{\p{C}}}{
    \lfocus{\p{\octx}_L}{\n{B}}{\p{\octx}_R}{\p{C}}}
  \and
  \text{(no $\lrule{\top}$ rule)}
  \\
  \infer[\lrule{\up}]{\lfocus{}{\up \p{A}}{}{\p{A}}}{}
\end{inferences}
\begin{inferences}
  \infer[\jrule{$\dn$D}]{\p{\octx}_L \oc \dn \n{A} \oc \p{\octx}_R \reduces \p{C}}{
    \lfocus{\p{\octx}_L}{\n{A}}{\p{\octx}_R}{\p{C}}}
  \and
  \infer[\jrule{$\fuse$D}]{\p{A} \fuse \p{B} \reduces \p{A} \oc \p{B}}{}
  \and
  \infer[\jrule{$\one$D}]{\one \reduces \octxe}{}
  \\
  \infer[\jrule{$\reduces$C}]{\p{\octx}_L \oc \p{\octx} \oc \p{\octx}_R \reduces \p{\octx}_L \oc \p{\octx'{}} \oc \p{\octx}_R}{
    \p{\octx} \reduces \p{\octx'{}}}
\end{inferences}
\caption{A framework for \emph{weakly} focused ordered rewriting}\label{fig:ordered-rewriting:weak-focusing}
\end{figure}

In fact, there is a better approach than using weakly focused ordered rewriting as yet another independent rewriting system.
Instead of using weakly focused rewriting directly, we can embed it within (strongly) focused ordered rewriting by inserting shifts at specific locations and then use that embedding.
From here on, we will exclusively use this embedding when weakly focused ordered rewriting is needed.%
\begin{marginfigure}
\begin{equation*}
  \begin{aligned}
    \embed*{\p{\octx}_1 \oc \p{\octx}_2}
      &= \embed*{\p{\octx}_1} \oc \embed*{\p{\octx}_2} \\
    \embed*{\octxe} &= \octxe \\
    \embed*{\p{A}} &= \embedp*{\p{A}}
  \\[\jot] \midrule
    \embedp*{\p{a}} &= \p{a} \\
    \embedp*{\p{A} \fuse \p{B}}
      &= \up ((\bigfuse \embedp*{\p{A}}) \fuse (\bigfuse \embedp*{\p{B}})) \\
    \embedp{\one} &= \up \one \\
    \embedp*{\dn \n{A}} &= \embedn*{\n{A}}
  \\[\jot] \midrule
    \embedn*{\p{a} \limp \n{B}}
      &= \p{a} \limp \embedn*{\n{B}} \\
    \embedn*{\n{B} \pmir \p{a}}
      &= \embedn*{\n{B}} \pmir \p{a} \\
    \embedn*{\n{A} \with \n{B}}
      &= \embedn*{\n{A}} \with \embedn*{\n{B}} \\
    \embedn{\top} &= \top \\
    \embedn*{\up \p{A}} &= \up (\bigfuse \embedp*{\p{A}})
  \end{aligned}
\end{equation*}
  \caption{An embedding of weakly focused ordered rewriting within (strongly) focused ordered rewriting}
\end{marginfigure}

% \begin{equation*}
%   \begin{aligned}
%     \embedp*{\p{A}} &= \begin{cases*}
%                     \p{a} & if $\p{A} = \p{a}$ \\
%                     \dn \up (\embedp*{\p{A}_1} \fuse \embedp*{\p{A}_2}) & if $\p{A} = \p{A}_1 \fuse \p{A}_2$ \\
%                     \dn \up \one & if $\p{A} = \one$ \\
%                     \dn \embedn*{\n{A}_0} & if $\p{A} = \dn \n{A}_0$
%                \end{cases*}
%     \\
%     \embedn*{\n{A}} &= \begin{cases*}
%                          \embedp*{\p{A}_1} \limp \embedn*{\n{A}_2} & if $\n{A} = \p{A}_1 \limp \n{A}_2$ \\
%                     \embedn*{\n{A}_2} \pmir \embedp*{\p{A}_1} & if $\n{A} = \n{A}_2 \pmir \p{A}_1$ \\
%                     \embedn*{\n{A}_1} \with \embedn*{\n{A}_2} & if $\n{A} = \n{A}_1 \with \n{A}_2$ \\
%                     \top & if $\n{A} = \top$ \\
%                     \up \embedp*{\p{A}_0} & if $\n{A} = \up \p{A}_0$
%                   \end{cases*}
%     \\
%     \embed*{\p{A}} &=
%       \begin{cases*}
%         \p{a} & if $\p{A} = \p{a}$ \\
%         \up (\embedp*{\p{A}_1} \fuse \embedp*{\p{A}_2}) & if $\p{A} = \p{A}_1 \fuse \p{A}_2$ \\
%         \up \one & if $\p{A} = \one$ \\
%         \embedn*{\n{A}_0} & if $\p{A} = \dn \n{A}_0$
%       \end{cases*}
%     \\
%     \embed*{\p{\octx}} &=
%       \begin{cases*}
%         \embed*{\p{\octx}_1} \oc \embed*{\p{\octx}_2} & if $\p{\octx} = \p{\octx}_1 \oc \p{\octx}_2$ \\
%         (\octxe) & if $\octx = \octxe$ \\
%         \embed*{\p{A}} & if $\octx = \p{A}$
%       \end{cases*}
%   \end{aligned}
% \end{equation*}

\begin{theorem}
  The embedding $\embed{(-)}$ satisfies the following properties.
  \begin{itemize}[nosep]
  \item If $\p{\octx} \reduces \p{\octx'{}}$, then $\embed*{\p{\octx}} \reduces \embed*{\p{\octx'{}}}$.
  \item If $\embed*{\p{\octx}} \reduces \np{\lctx'{}}$, then $\p{\octx} \reduces \p{\octx'{}}$ for some $\p{\octx'{}}$ such that $\np{\lctx'{}} = \embed*{\p{\octx'{}}}$.
  \end{itemize}
\end{theorem}
\begin{proof}
  The proofs of these properties require two relatively straightforward lemmas:
  for all polarized propositions $\p{A}$ and $\n{A}$,
  \begin{itemize}
  \item $\rfocus{\np{\lctx}}{\bigfuse \embedp*{\p{A}}}$ if, and only if, $\np{\lctx} = \embed*{\p{A}}$; and
  \item $\lfocus{\np{\lctx}_L}{\embedn*{\n{A}}}{\np{\lctx}_R}{\p{B}}$ if, and only if,
    $\lfocus{\p{\octx}_L}{\n{A}}{\p{\octx}_R}{\p{C}}$ and
    $\np{\lctx}_L = \embed*{\p{\octx}_L}$,
    $\np{\lctx}_R = \embed*{\p{\octx}_R}$, and
    $\p{B} = \bigfuse \embedp*{\p{C}}$.
  \end{itemize}
  Both lemmas are proved by structural induction on the polarized proposition, $\p{A}$ and $\n{A}$, respectively.

  The first of the above properties is then proved by induction over the structure of the given weakly focused rewriting step, $\p{\octx} \reduces \p{\octx'}$.
  As an example, consider the case in which $\p{\octx}_L \oc \dn \n{A} \oc \p{\octx}_R \reduces \p{C}$ because $\lfocus{\p{\octx}_L}{\n{A}}{\p{\octx}_R}{\p{C}}$.
  By the above lemmas, $\lfocus{\embed*{\p{\octx}_L}}{\embedn*{\n{A}}}{\embed*{\p{\octx}_R}}{\bigfuse \embedp*{\p{C}}}$ and $\rfocus{\embed*{\p{C}}}{\bigfuse \embedp*{\p{C}}}$ hold in the fully focused calculus.
  And so, $\embed*{\p{\octx}_L} \oc \embed*{\dn \n{A}} \oc \embed*{\p{\octx}_R} \reduces \embed*{\p{C}}$.

  The second property is also proved by induction over the structure of the given rewriting step, this time the fully focused $\embed*{\p{\octx}} \reduces \np{\lctx'{}}$.
  As an example, consider the case in which $\lfocus{\np{\lctx}_L}{\p{a}_1 \limp \embedn*{\n{A}_2}}{\np{\lctx}_R}{\p{B}}$ and $\rfocus{\np{\lctx'{}}}{\p{B}}$.
  Inversion yields $\lfocus{\np{\lctx'_L{}}}{\embedn*{\n{A}_2}}{\np{\lctx}_R}{\p{B}}$ for some $\np{\lctx'_L{}}$ such that $\np{\lctx}_L = \np{\lctx'_L{}} \oc \p{a}_1$.
  Then, by the above lemma, $\lfocus{\p{\octx}_L}{\n{A}_2}{\p{\octx}_R}{\p{C}}$ holds in the weakly focused calculus, with $\np{\lctx'_L{}} = \embed*{\p{\octx}_L}$, $\np{\lctx}_R = \embed*{\p{\octx}_R}$, and $\p{B} = \bigfuse \embedp*{\p{C}}$.
  Appending the $\lrule{\limp}$ rule, it follows that $\lfocus{\p{\octx}_L \oc \p{a}_1}{\p{a}_1 \limp \n{A}_2}{\p{\octx}_R}{\p{C}}$, and so $\p{\octx}_L \oc \p{a}_1 \oc \dn (\p{a}_1 \limp \n{A}_2) \oc \p{\octx}_R \reduces \p{C}$.
  Also notice that $\np{\lctx}_L = \embed*{\p{\octx}_L \oc \p{a}_1}$ and $\np{\lctx'{}} = \embed*{\p{C}}$, as required.
\end{proof}


% \clearpage
% \clearpage

% \subsection{Recursively defined propositions and unbounded ordered rewriting}

% Although a seemingly pleasant property, termination~\parencref{thm:ordered-rewriting:termination} significantly limits the expressiveness of ordered rewriting.
% For example, without unbounded rewriting, we cannot even use ordered rewriting to describe producer-consumer systems or finite automata.

% As the proof of termination shows, rewriting is bounded
% % $\card{\octx_0}$ is an upper bound on the length of any trace from state $\octx_0$,
% precisely because
% % $\octx_0$
% states
% consist of finitely many finite propositions.
% One way to admit unbounded rewriting is therefore to permit circular propositions in the form of mutually recursive definitions, $\defp{p} \defd A$, where the grammar of ordered propositions now includes these recursively defined propositions $\defp{p}$:
% \begin{equation*}
%   A,B \Coloneqq a \mid A \fuse B \mid \one \mid A \limp B \mid B \pmir A \mid A \with B \mid \top \mid \defp{p}
%   \,.
% \end{equation*}
% Sequent calculi with definitions of this kind have previously been studied by \textcites{Hallnas:??}{Erikkson:??}{Schroeder-Heister:??}{McDowell+Miller:??}{Tiu+Momigliano:??}, among others.

% To rule out definitions like $\defp{p} \defd \defp{p}$ that do not correspond to sensible infinite propositions, we require that definitions be \vocab{contractive}\autocite{Gay+Hole:AI05} -- \ie, that the body of each recursive definition begin with a logical connective (or constant or atom) at the top level.

% % could either permit states consisting of infinitely many finite propositions or states consisting of finitely many infinite propositions.
% % We choose the latter route [...].
% %%
% %%
% % Infinite propositions are described by mutually recursive definitions $\alpha \defd A$.
% The recursive definitions are collected into a signature, $\orsig$, which indexes the rewriting relations: $\reduces_{\orsig}$ and $\Reduces_{\orsig}$.%
% \footnote{We nearly always elide the index, as it is usually clear from context.} 
% Syntactically, these signatures are given by
% \begin{equation*}
%   \orsig \Coloneqq \orsige \mid \orsig , (\defp{p} \defd A)
%   \,.
% \end{equation*}


% \newthought{By analogy with} recursive types from functional programming\autocite{??}, we must now decide whether to treat definitions \emph{iso}\-re\-cur\-sively or \emph{equi}\-re\-cur\-sively.
% Under an equirecursive interpretation, definitions $\defp{p} \defd A$ may be silently unrolled or rolled at will;
% in other words, $\defp{p}$ is literally \emph{equal} to its unrolling -- $\defp{p} = A$.
% In contrast, under an isorecursive interpretation, unrolling a recursively defined proposition would count as an explicit step of rewriting -- $\defp{p} \neq A$ but $\defp{p} \reduces A$, for example.

% % Under the isorecursive interpretation, unrolling a recursively defined prop\-o\-sition counts as an explicit step of rewriting.
% % We introduce the $\jrule{$\defd$D}$ rule to account for this unrolling:
% % \begin{equation*}
% %   \infer[\jrule{$\defd$D}]{\alpha \reduces_{\sig} A}{
% %     \text{$(\alpha \defd A) \in \sig$}}
% % \end{equation*}
% % Because $A$ is seen as a proper subformula of [the recursively defined] $\alpha$, this unrolling rule aligns well with the rewriting-as-decomposition philosophy.%
% % \footnote{In fact, we could have chosen to include recursive definitions in the sequent calculus, following \textcites{SchroederHeister:LICS93}{Tiu+Momigliano:JAL12} and others.
% %   Had we done so, the $\jrule{$\defd$D}$ rule would be seen as the decomposition counterpart to the left rule
% %   \begin{equation*}
% %     \infer[\lrule{\defd}]{\oseq{\octx'_L \oc \alpha \oc \octx'_R |-_{\sig} C}}{
% %       \bigl((\alpha \defd A) \in \sig\bigr) &
% %       \oseq{\octx'_L \oc A \oc \octx'_R |-_{\sig} C}}
% %   \end{equation*}
% % }
% % Conversely, there is no rule that permits the rolling of $A$ into $\alpha$, because such a rule would not be a decomposition.

% We choose to interpret definitions equirecursively
% because the equirecursive treatment, with its generous notion of equality, helps to minimize the overhead of recursively defined propositions.
% As a simple example, under the equirecursive definition $\defp{p} \defd a \limp \defp{p}$, we have the trace
% \begin{equation*}
%   a \oc a \oc \defp{p} = a \oc a \oc (a \limp \defp{p}) \reduces a \oc \defp{p} = a \oc (a \limp \defp{p}) \reduces \defp{p}
% \end{equation*}
% or, more concisely, $a \oc a \oc \defp{p} \reduces a \oc \defp{p} \reduces \defp{p}$.
% Had we chosen
% % With
%  an isorecursive treatment of the same definition, we would have only the more laborious
% \begin{equation*}
%   a \oc a \oc \defp{p} \reduces a \oc a \oc (a \limp \defp{p}) \reduces a \oc \defp{p} \reduces a \oc (a \limp \defp{p}) \reduces \defp{p}
%   \,.
% \end{equation*}
% This choice differs from the aforementioned works on definitions, which use an isorecursive treatment with explicit right and left rules for recursively defined propositions.


% \paragraph*{Replication}

% In Milner's development of the $\pi$-calculus, there are two avenues to unbounded process behavior: recursive process definitions and replication.

% \autocite{Aranda+:FMCO06}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "thesis"
%%% End:
